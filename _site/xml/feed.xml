<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Kyo Harada — Visage AI / Data Scientist</title>
    <description>Founder &amp; Data Scientist building on-device AI for skin analytics and finance-grade data products.</description>
    <link>https://kyo1988.github.io/</link>
    <atom:link href="https://kyo1988.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Thu, 18 Sep 2025 11:37:18 +0900</pubDate>
    <lastBuildDate>Thu, 18 Sep 2025 11:37:18 +0900</lastBuildDate>
    <generator>Jekyll v3.10.0</generator>
    
      <item>
        <title>RAGミニ監査チェックリスト（無料DL）</title>
        <description>&lt;div class=&quot;tldr&quot;&gt;
  &lt;strong&gt;TL;DR&lt;/strong&gt;
  &lt;p&gt;RAGの善し悪しは再現性×リーン運用。まずはこのA4一枚から。2週間で現状把握→改善提案まで。&lt;/p&gt;
&lt;/div&gt;

&lt;h2 id=&quot;評価観点と最小セット&quot;&gt;評価観点と最小セット&lt;/h2&gt;

&lt;h3 id=&quot;1-データ品質data-quality&quot;&gt;1. データ品質（Data Quality）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;文書の一貫性&lt;/strong&gt;: フォーマット・構造の統一性&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;重複排除&lt;/strong&gt;: 同一内容の重複文書の特定&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;更新頻度&lt;/strong&gt;: データの鮮度と更新プロセス&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;権限管理&lt;/strong&gt;: アクセス制御とセキュリティ&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-検索性能retrieval-performance&quot;&gt;2. 検索性能（Retrieval Performance）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;検索精度&lt;/strong&gt;: 関連文書の検索率（Recall）&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;検索適合性&lt;/strong&gt;: 検索結果の関連性（Precision）&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;検索速度&lt;/strong&gt;: クエリ応答時間&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;スケーラビリティ&lt;/strong&gt;: 文書数増加への対応&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-生成品質generation-quality&quot;&gt;3. 生成品質（Generation Quality）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;事実正確性&lt;/strong&gt;: 生成内容の事実関係の正確性&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;一貫性&lt;/strong&gt;: 文脈との整合性&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;完全性&lt;/strong&gt;: 回答の完全性と詳細度&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;安全性&lt;/strong&gt;: 有害・不適切な内容の生成回避&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;評価ダッシュボード&quot;&gt;評価ダッシュボード&lt;/h2&gt;

&lt;div class=&quot;key-takeaways&quot;&gt;
  &lt;strong&gt;Key Takeaways&lt;/strong&gt;
  &lt;ul&gt;
    
    
      &lt;li&gt;検索精度: 80%以上&lt;/li&gt;
    
      &lt;li&gt;生成品質: 85%以上&lt;/li&gt;
    
      &lt;li&gt;応答時間: 3秒以内&lt;/li&gt;
    
      &lt;li&gt;コスト効率: $0.01/クエリ以下&lt;/li&gt;
    
      &lt;li&gt;ユーザー満足度: 4.0/5.0以上&lt;/li&gt;
    
  &lt;/ul&gt;
&lt;/div&gt;

&lt;h2 id=&quot;チェックリスト項目&quot;&gt;チェックリスト項目&lt;/h2&gt;

&lt;h3 id=&quot;データ管理&quot;&gt;データ管理&lt;/h3&gt;
&lt;ul class=&quot;task-list&quot;&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;文書の前処理が適切に実行されている&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;埋め込みベクトルの品質が保証されている&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;データの更新プロセスが自動化されている&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;バージョン管理が適切に行われている&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;検索システム&quot;&gt;検索システム&lt;/h3&gt;
&lt;ul class=&quot;task-list&quot;&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;適切な検索アルゴリズムが選択されている&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;検索結果のランキングが最適化されている&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;検索クエリの前処理が実装されている&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;検索結果のフィルタリングが機能している&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;生成システム&quot;&gt;生成システム&lt;/h3&gt;
&lt;ul class=&quot;task-list&quot;&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;プロンプトエンジニアリングが最適化されている&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;生成内容の検証プロセスが実装されている&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;エラーハンドリングが適切に設計されている&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;生成内容のログが記録されている&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;改善提案テンプレート&quot;&gt;改善提案テンプレート&lt;/h2&gt;

&lt;section class=&quot;qa&quot;&gt;
  &lt;h2&gt;Q&amp;amp;A&lt;/h2&gt;
  
  &lt;dl&gt;
  
    
    
    
    
      &lt;dt&gt;現状の課題は？&lt;/dt&gt;
      &lt;dd&gt;検索精度が70%と目標の80%を下回っている&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;根本原因は？&lt;/dt&gt;
      &lt;dd&gt;埋め込みモデルの性能不足と文書前処理の不備&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;改善策は？&lt;/dt&gt;
      &lt;dd&gt;埋め込みモデルの更新と文書前処理の最適化&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;期待効果は？&lt;/dt&gt;
      &lt;dd&gt;検索精度85%向上、ユーザー満足度4.2/5.0達成&lt;/dd&gt;
    
  
  &lt;/dl&gt;
&lt;/section&gt;

&lt;h2 id=&quot;無料ダウンロード&quot;&gt;無料ダウンロード&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;RAG監査チェックリスト（PDF）&lt;/strong&gt;を無料でダウンロードできます：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;📋 &lt;strong&gt;A4版チェックリスト&lt;/strong&gt;: 印刷して使用可能&lt;/li&gt;
  &lt;li&gt;📊 &lt;strong&gt;評価ダッシュボード&lt;/strong&gt;: Excel形式で数値管理&lt;/li&gt;
  &lt;li&gt;📝 &lt;strong&gt;改善提案テンプレート&lt;/strong&gt;: Word形式でレポート作成&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;https://forms.gle/REPLACE&quot;&gt;ダウンロードはこちら&lt;/a&gt; （Google Forms）&lt;/p&gt;

&lt;h2 id=&quot;監査スケジュール&quot;&gt;監査スケジュール&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Week 1&lt;/strong&gt;: 現状調査・データ収集&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Week 2&lt;/strong&gt;: 分析・評価・改善提案作成&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Deliverable&lt;/strong&gt;: 評価レポート + 改善ロードマップ&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;参考資料&quot;&gt;参考資料&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://arxiv.org/abs/2312.10997&quot;&gt;RAG Evaluation Best Practices&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://arxiv.org/abs/2312.10997&quot;&gt;Retrieval-Augmented Generation Survey&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/huggingface/evaluate&quot;&gt;LLM Evaluation Framework&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;cta&quot;&gt;
  &lt;h3&gt;相談・見積りのご依頼&lt;/h3&gt;
  &lt;p&gt;小さく速く、成果物ベースでご一緒します。&lt;/p&gt;
  &lt;p&gt;
    &lt;a class=&quot;btn&quot; href=&quot;/work-with-me/&quot;&gt;Work with me&lt;/a&gt;
    &lt;a class=&quot;btn ghost&quot; href=&quot;/newsletter/&quot;&gt;無料ニュースレター&lt;/a&gt;
  &lt;/p&gt;
&lt;/div&gt;

&lt;div class=&quot;related&quot;&gt;
  &lt;h3&gt;次に読む&lt;/h3&gt;
  &lt;ul&gt;
  
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/edinet-db-howto.html&quot;&gt;EDINET XBRLで作る投資家級データベース&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/coreml-optimization-playbook.html&quot;&gt;CoreML最適化プレイブック（受託）&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/coreml-optimization-playbook-en.html&quot;&gt;CoreML Optimization Playbook (Consulting)&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  &lt;/ul&gt;
&lt;/div&gt;

</description>
        <pubDate>Sun, 19 Jan 2025 00:00:00 +0900</pubDate>
        <link>https://kyo1988.github.io/2025/01/19/rag-audit-checklist.html</link>
        <guid isPermaLink="true">https://kyo1988.github.io/2025/01/19/rag-audit-checklist.html</guid>
        
        <category>LLM</category>
        
        <category>RAG</category>
        
        <category>Evaluation</category>
        
        <category>Case-Study</category>
        
        <category>AI</category>
        
        
      </item>
    
      <item>
        <title>Founder&apos;s Log #01 — 週報</title>
        <description>&lt;div class=&quot;tldr&quot;&gt;
  &lt;strong&gt;TL;DR&lt;/strong&gt;
  &lt;p&gt;今週の決定：Jekyll 3互換パッチでビルド安定化。数字の動き：20回連続失敗→成功。次週は新機能段階的復活。&lt;/p&gt;
&lt;/div&gt;

&lt;h2 id=&quot;built&quot;&gt;Built&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Jekyll 3互換パッチ&lt;/strong&gt;: 配列引数includeを区切り文字方式に変更&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ビルド安定化&lt;/strong&gt;: 20回連続失敗を解決、GitHub Pagesで正常動作&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Liquid構文最適化&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;absolute_url&lt;/code&gt;、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strip_newlines&lt;/code&gt;フィルターを削除&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;JSON-LD実装&lt;/strong&gt;: Jekyll 3.10.0互換の構造化データ&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;learned&quot;&gt;Learned&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Jekyll 3.10.0の制限&lt;/strong&gt;: GitHub Pagesの制約を事前調査の重要性&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;段階的アプローチ&lt;/strong&gt;: 最小構成→機能復活の順序が重要&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Liquid互換性&lt;/strong&gt;: 配列引数は不安定、区切り文字が確実&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;one-chart&quot;&gt;One-chart&lt;/h2&gt;

&lt;figure&gt;
  

&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/f_auto,q_auto,w_1200/charts/build-success.png&quot; alt=&quot;ビルド成功の推移&quot; loading=&quot;lazy&quot; /&gt;

  &lt;figcaption&gt;20回連続失敗から安定ビルドへの改善。Jekyll 3互換パッチの効果。&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&quot;qa&quot;&gt;Q&amp;amp;A&lt;/h2&gt;

&lt;section class=&quot;qa&quot;&gt;
  &lt;h2&gt;Q&amp;amp;A&lt;/h2&gt;
  
  &lt;dl&gt;
  
    
    
    
    
      &lt;dt&gt;目的は？&lt;/dt&gt;
      &lt;dd&gt;20回連続ビルド失敗の根本解決&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;どう評価？&lt;/dt&gt;
      &lt;dd&gt;ローカルビルド成功＋GitHub Pages自動ビルド成功&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;次の一手は？&lt;/dt&gt;
      &lt;dd&gt;新機能の段階的復活とコンテンツ拡充&lt;/dd&gt;
    
  
  &lt;/dl&gt;
&lt;/section&gt;

&lt;h2 id=&quot;sources&quot;&gt;Sources&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/3.10.0/&quot;&gt;Jekyll 3.10.0 Documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://pages.github.com/versions/&quot;&gt;GitHub Pages Jekyll Version&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://shopify.github.io/liquid/&quot;&gt;Liquid Template Language&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;cta&quot;&gt;
  &lt;h3&gt;相談・見積りのご依頼&lt;/h3&gt;
  &lt;p&gt;小さく速く、成果物ベースでご一緒します。&lt;/p&gt;
  &lt;p&gt;
    &lt;a class=&quot;btn&quot; href=&quot;/work-with-me/&quot;&gt;Work with me&lt;/a&gt;
    &lt;a class=&quot;btn ghost&quot; href=&quot;/newsletter/&quot;&gt;無料ニュースレター&lt;/a&gt;
  &lt;/p&gt;
&lt;/div&gt;

&lt;div class=&quot;related&quot;&gt;
  &lt;h3&gt;次に読む&lt;/h3&gt;
  &lt;ul&gt;
  
    
      
      
      
    
  
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/founders-log-01-en.html&quot;&gt;Founder&apos;s Log #01 — Weekly Update&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
  &lt;/ul&gt;
&lt;/div&gt;

</description>
        <pubDate>Sun, 19 Jan 2025 00:00:00 +0900</pubDate>
        <link>https://kyo1988.github.io/2025/01/19/founders-log-01.html</link>
        <guid isPermaLink="true">https://kyo1988.github.io/2025/01/19/founders-log-01.html</guid>
        
        <category>Log</category>
        
        <category>Founder</category>
        
        <category>Jekyll</category>
        
        <category>GitHub-Pages</category>
        
        
      </item>
    
      <item>
        <title>Founder&apos;s Log #01 — Weekly Update</title>
        <description>&lt;div class=&quot;tldr&quot;&gt;
  &lt;strong&gt;TL;DR&lt;/strong&gt;
  &lt;p&gt;This week&apos;s decisions: Jekyll 3 compatibility patch for build stabilization. Numbers: 20 consecutive failures → success. Next week: gradual feature restoration.&lt;/p&gt;
&lt;/div&gt;

&lt;h2 id=&quot;built&quot;&gt;Built&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Jekyll 3 Compatibility Patch&lt;/strong&gt;: Changed array parameter includes to delimiter-based approach&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Build Stabilization&lt;/strong&gt;: Resolved 20 consecutive failures, normal operation on GitHub Pages&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Liquid Syntax Optimization&lt;/strong&gt;: Removed absolute_url and strip_newlines filters&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;JSON-LD Implementation&lt;/strong&gt;: Jekyll 3.10.0 compatible structured data&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;learned&quot;&gt;Learned&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Jekyll 3.10.0 Limitations&lt;/strong&gt;: Importance of pre-investigating GitHub Pages constraints&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Incremental Approach&lt;/strong&gt;: Order of minimal configuration → feature restoration is crucial&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Liquid Compatibility&lt;/strong&gt;: Array parameters are unstable, delimiters are reliable&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;one-chart&quot;&gt;One-chart&lt;/h2&gt;

&lt;figure&gt;
  

&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/f_auto,q_auto,w_1200/charts/build-success.png&quot; alt=&quot;Build success progression&quot; loading=&quot;lazy&quot; /&gt;

  &lt;figcaption&gt;Improvement from 20 consecutive failures to stable builds. Effect of Jekyll 3 compatibility patch.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&quot;qa&quot;&gt;Q&amp;amp;A&lt;/h2&gt;

&lt;section class=&quot;qa&quot;&gt;
  &lt;h2&gt;Q&amp;amp;A&lt;/h2&gt;
  
  &lt;dl&gt;
  
    
    
    
    
      &lt;dt&gt;What was the goal?&lt;/dt&gt;
      &lt;dd&gt;Resolve the root cause of 20 consecutive build failures&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;How was it evaluated?&lt;/dt&gt;
      &lt;dd&gt;Local build success + GitHub Pages automatic build success&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;What&apos;s the next step?&lt;/dt&gt;
      &lt;dd&gt;Gradual restoration of new features and content expansion&lt;/dd&gt;
    
  
  &lt;/dl&gt;
&lt;/section&gt;

&lt;h2 id=&quot;sources&quot;&gt;Sources&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/3.10.0/&quot;&gt;Jekyll 3.10.0 Documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://pages.github.com/versions/&quot;&gt;GitHub Pages Jekyll Version&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://shopify.github.io/liquid/&quot;&gt;Liquid Template Language&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;cta&quot;&gt;
  &lt;h3&gt;相談・見積りのご依頼&lt;/h3&gt;
  &lt;p&gt;小さく速く、成果物ベースでご一緒します。&lt;/p&gt;
  &lt;p&gt;
    &lt;a class=&quot;btn&quot; href=&quot;/work-with-me/&quot;&gt;Work with me&lt;/a&gt;
    &lt;a class=&quot;btn ghost&quot; href=&quot;/newsletter/&quot;&gt;無料ニュースレター&lt;/a&gt;
  &lt;/p&gt;
&lt;/div&gt;

&lt;div class=&quot;related&quot;&gt;
  &lt;h3&gt;次に読む&lt;/h3&gt;
  &lt;ul&gt;
  
    
      
      
      
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/founders-log-01.html&quot;&gt;Founder&apos;s Log #01 — 週報&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
  &lt;/ul&gt;
&lt;/div&gt;

</description>
        <pubDate>Sun, 19 Jan 2025 00:00:00 +0900</pubDate>
        <link>https://kyo1988.github.io/2025/01/19/founders-log-01-en.html</link>
        <guid isPermaLink="true">https://kyo1988.github.io/2025/01/19/founders-log-01-en.html</guid>
        
        <category>Log</category>
        
        <category>Founder</category>
        
        <category>Jekyll</category>
        
        <category>GitHub-Pages</category>
        
        
      </item>
    
      <item>
        <title>EDINET XBRLで作る投資家級データベース</title>
        <description>&lt;div class=&quot;tldr&quot;&gt;
  &lt;strong&gt;TL;DR&lt;/strong&gt;
  &lt;p&gt;投資家が使える粒度にするための設計と運用の実際。EDINET XBRLから投資家級データベースを構築する完全ガイド。&lt;/p&gt;
&lt;/div&gt;

&lt;h2 id=&quot;スキーマ設計&quot;&gt;スキーマ設計&lt;/h2&gt;

&lt;h3 id=&quot;1-基本テーブル構造&quot;&gt;1. 基本テーブル構造&lt;/h3&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;-- 企業マスタ&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;companies&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;company_id&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;company_name&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;industry_code&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;listing_date&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;DATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;created_at&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;TIMESTAMP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CURRENT_TIMESTAMP&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;-- 財務データ&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;financial_data&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;BIGINT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AUTO_INCREMENT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;company_id&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fiscal_year&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fiscal_period&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;account_code&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;account_name&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;amount&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;DECIMAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;unit&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;created_at&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;TIMESTAMP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CURRENT_TIMESTAMP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;FOREIGN&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;company_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;REFERENCES&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;companies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;company_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-インデックス設計&quot;&gt;2. インデックス設計&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;複合インデックス&lt;/strong&gt;: (company_id, fiscal_year, account_code)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;パーティション&lt;/strong&gt;: fiscal_yearでパーティション分割&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;圧縮&lt;/strong&gt;: InnoDB圧縮でストレージ効率化&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;etlパイプライン&quot;&gt;ETLパイプライン&lt;/h2&gt;

&lt;h3 id=&quot;1-データ取得&quot;&gt;1. データ取得&lt;/h3&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;zipfile&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;xml.etree.ElementTree&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ET&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;EDINETDownloader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;api_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;api_key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;api_key&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;base_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;https://disclosure.edinet-fsa.go.jp/api/v1&quot;&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;download_xbrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;doc_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;XBRLファイルをダウンロード&quot;&quot;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;base_url&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/documents/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;doc_id&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# XBRL形式
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-API-KEY&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;api_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status_code&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-データ変換&quot;&gt;2. データ変換&lt;/h3&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;XBRLParser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parse_financial_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xbrl_content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;XBRLから財務データを抽出&quot;&quot;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fromstring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xbrl_content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;financial_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;# 勘定科目の抽出
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;findall&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.//{http://www.xbrl.org/2003/instance}context&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;context_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;period&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extract_period&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            
            &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;findall&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.//{http://www.xbrl.org/2003/instance}item&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;contextRef&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;account_code&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;amount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
                    
                    &lt;span class=&quot;n&quot;&gt;financial_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
                        &lt;span class=&quot;s&quot;&gt;&quot;context_id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;s&quot;&gt;&quot;period&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;s&quot;&gt;&quot;account_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;account_code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;s&quot;&gt;&quot;amount&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;amount&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;financial_data&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;欠損対処&quot;&gt;欠損対処&lt;/h2&gt;

&lt;h3 id=&quot;1-データクリーニング&quot;&gt;1. データクリーニング&lt;/h3&gt;
&lt;div class=&quot;key-takeaways&quot;&gt;
  &lt;strong&gt;Key Takeaways&lt;/strong&gt;
  &lt;ul&gt;
    
    
      &lt;li&gt;欠損値の特定: 勘定科目の存在確認&lt;/li&gt;
    
      &lt;li&gt;補完方法: 前年同期値または業界平均値&lt;/li&gt;
    
      &lt;li&gt;異常値検出: 統計的異常値の特定と除外&lt;/li&gt;
    
      &lt;li&gt;データ整合性: 貸借対照表のバランス確認&lt;/li&gt;
    
  &lt;/ul&gt;
&lt;/div&gt;

&lt;h3 id=&quot;2-品質管理&quot;&gt;2. 品質管理&lt;/h3&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DataQualityChecker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;check_balance_sheet_balance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;貸借対照表のバランス確認&quot;&quot;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;assets&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;account_type&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Assets&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;amount&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;liabilities&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;account_type&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Liabilities&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;amount&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;equity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;account_type&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Equity&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;amount&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;balance&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assets&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;liabilities&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;equity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;balance&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.01&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# 1円未満の差は許容
&lt;/span&gt;    
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;detect_outliers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;amount&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;異常値の検出&quot;&quot;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Q1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Q3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.75&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;IQR&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Q3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Q1&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;lower_bound&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Q1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IQR&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;upper_bound&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Q3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IQR&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lower_bound&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upper_bound&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;ダッシュボード例&quot;&gt;ダッシュボード例&lt;/h2&gt;

&lt;h3 id=&quot;1-財務指標ダッシュボード&quot;&gt;1. 財務指標ダッシュボード&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;収益性&lt;/strong&gt;: ROE, ROA, 営業利益率&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;安全性&lt;/strong&gt;: 自己資本比率, 流動比率&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;効率性&lt;/strong&gt;: 総資産回転率, 売上高成長率&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;市場評価&lt;/strong&gt;: PER, PBR, EV/EBITDA&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-業界比較分析&quot;&gt;2. 業界比較分析&lt;/h3&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;create_industry_comparison&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;company_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;industry_code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;業界比較分析&quot;&quot;&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;
    SELECT 
        company_id,
        AVG(ROE) as avg_roe,
        AVG(ROA) as avg_roa,
        AVG(営業利益率) as avg_operating_margin
    FROM financial_metrics 
    WHERE industry_code = %s
    GROUP BY company_id
    ORDER BY avg_roe DESC
    &quot;&quot;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;industry_code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;運用監視&quot;&gt;運用監視&lt;/h2&gt;

&lt;section class=&quot;qa&quot;&gt;
  &lt;h2&gt;Q&amp;amp;A&lt;/h2&gt;
  
  &lt;dl&gt;
  
    
    
    
    
      &lt;dt&gt;データ更新頻度は？&lt;/dt&gt;
      &lt;dd&gt;四半期ごと（3月・6月・9月・12月）の決算発表後&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;監視すべき指標は？&lt;/dt&gt;
      &lt;dd&gt;データ取得成功率・処理時間・データ品質スコア&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;障害時の対応は？&lt;/dt&gt;
      &lt;dd&gt;アラート通知・自動再試行・手動復旧手順&lt;/dd&gt;
    
  
  &lt;/dl&gt;
&lt;/section&gt;

&lt;h2 id=&quot;成果物&quot;&gt;成果物&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;データベース&lt;/strong&gt;: MySQL/PostgreSQLで構築&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ETLパイプライン&lt;/strong&gt;: Python + Airflowで自動化&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ダッシュボード&lt;/strong&gt;: Grafana + InfluxDBで可視化&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;API&lt;/strong&gt;: RESTful APIでデータ提供&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;参考資料&quot;&gt;参考資料&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://disclosure.edinet-fsa.go.jp/api/v1/&quot;&gt;EDINET API Documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.xbrl.org/&quot;&gt;XBRL Specification&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://pandas.pydata.org/&quot;&gt;Financial Data Analysis&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;cta&quot;&gt;
  &lt;h3&gt;相談・見積りのご依頼&lt;/h3&gt;
  &lt;p&gt;小さく速く、成果物ベースでご一緒します。&lt;/p&gt;
  &lt;p&gt;
    &lt;a class=&quot;btn&quot; href=&quot;/work-with-me/&quot;&gt;Work with me&lt;/a&gt;
    &lt;a class=&quot;btn ghost&quot; href=&quot;/newsletter/&quot;&gt;無料ニュースレター&lt;/a&gt;
  &lt;/p&gt;
&lt;/div&gt;

&lt;div class=&quot;related&quot;&gt;
  &lt;h3&gt;次に読む&lt;/h3&gt;
  &lt;ul&gt;
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/rag-audit-checklist.html&quot;&gt;RAGミニ監査チェックリスト（無料DL）&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/coreml-optimization-playbook.html&quot;&gt;CoreML最適化プレイブック（受託）&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/coreml-optimization-playbook-en.html&quot;&gt;CoreML Optimization Playbook (Consulting)&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  &lt;/ul&gt;
&lt;/div&gt;

</description>
        <pubDate>Sun, 19 Jan 2025 00:00:00 +0900</pubDate>
        <link>https://kyo1988.github.io/2025/01/19/edinet-db-howto.html</link>
        <guid isPermaLink="true">https://kyo1988.github.io/2025/01/19/edinet-db-howto.html</guid>
        
        <category>EDINET</category>
        
        <category>Finance</category>
        
        <category>ETL</category>
        
        <category>Case-Study</category>
        
        <category>XBRL</category>
        
        <category>Database</category>
        
        
      </item>
    
      <item>
        <title>CoreML最適化プレイブック（受託）</title>
        <description>&lt;div class=&quot;tldr&quot;&gt;
  &lt;strong&gt;TL;DR&lt;/strong&gt;
  &lt;p&gt;オンデバイスで品質を落とさず軽量化する設計判断の要点を3分で。量子化→蒸留→アーキ設計の順序で最適化。&lt;/p&gt;
&lt;/div&gt;

&lt;h2 id=&quot;設計判断のフレームワーク&quot;&gt;設計判断のフレームワーク&lt;/h2&gt;

&lt;h3 id=&quot;1-量子化quantization&quot;&gt;1. 量子化（Quantization）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;INT8量子化&lt;/strong&gt;: 精度損失5%以内でモデルサイズ75%削減&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;動的量子化&lt;/strong&gt;: 推論時のみ量子化、学習時はFP32維持&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;静的量子化&lt;/strong&gt;: 事前キャリブレーション、より高い圧縮率&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-蒸留knowledge-distillation&quot;&gt;2. 蒸留（Knowledge Distillation）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Teacher-Student&lt;/strong&gt;: 大規模モデル→軽量モデルへの知識転移&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;温度パラメータ&lt;/strong&gt;: T=3-5でソフトラベル生成&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;損失関数&lt;/strong&gt;: ハードラベル + ソフトラベル + 特徴マップ&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-アーキテクチャ設計&quot;&gt;3. アーキテクチャ設計&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;MobileNet&lt;/strong&gt;: 深度分離畳み込みで計算量削減&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;EfficientNet&lt;/strong&gt;: 複合スケーリングで効率最大化&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;SqueezeNet&lt;/strong&gt;: Fire Moduleでパラメータ数削減&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;評価指標&quot;&gt;評価指標&lt;/h2&gt;

&lt;div class=&quot;key-takeaways&quot;&gt;
  &lt;strong&gt;Key Takeaways&lt;/strong&gt;
  &lt;ul&gt;
    
    
      &lt;li&gt;精度: Top-1/Top-5 Accuracy&lt;/li&gt;
    
      &lt;li&gt;推論速度: FPS (Frames Per Second)&lt;/li&gt;
    
      &lt;li&gt;モデルサイズ: MB単位&lt;/li&gt;
    
      &lt;li&gt;メモリ使用量: RAM/VRAM&lt;/li&gt;
    
      &lt;li&gt;バッテリー消費: mAh/推論&lt;/li&gt;
    
  &lt;/ul&gt;
&lt;/div&gt;

&lt;h2 id=&quot;落とし穴と対策&quot;&gt;落とし穴と対策&lt;/h2&gt;

&lt;h3 id=&quot;よくある失敗パターン&quot;&gt;よくある失敗パターン&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;過度な量子化&lt;/strong&gt;: 精度大幅低下&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;不適切な蒸留&lt;/strong&gt;: 温度設定ミス&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;アーキ選択ミス&lt;/strong&gt;: タスクとモデルの不適合&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;対策&quot;&gt;対策&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;段階的最適化&lt;/strong&gt;: 1つずつ適用して効果測定&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;A/Bテスト&lt;/strong&gt;: 複数手法の並行比較&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;実機検証&lt;/strong&gt;: シミュレータではなく実デバイスでテスト&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;成果物セット&quot;&gt;成果物セット&lt;/h2&gt;

&lt;section class=&quot;qa&quot;&gt;
  &lt;h2&gt;Q&amp;amp;A&lt;/h2&gt;
  
  &lt;dl&gt;
  
    
    
    
    
      &lt;dt&gt;どの手法をどう選ぶ？&lt;/dt&gt;
      &lt;dd&gt;精度要求と制約から逆算して選択。精度優先→蒸留、サイズ優先→量子化&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;評価指標は？&lt;/dt&gt;
      &lt;dd&gt;精度・速度・サイズ・メモリ・バッテリーの5軸で総合評価&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;納品物とスケジュールは？&lt;/dt&gt;
      &lt;dd&gt;最適化モデル・実装ガイド・性能レポート（2-6週間）&lt;/dd&gt;
    
  
  &lt;/dl&gt;
&lt;/section&gt;

&lt;h2 id=&quot;実装例&quot;&gt;実装例&lt;/h2&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// CoreML最適化の実装例&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CoreML&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;OptimizedModelManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loadOptimizedModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MLModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;modelURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Bundle&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;forResource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;optimized_model&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;withExtension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;mlmodelc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MLModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;contentsOf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;modelURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;predict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MLFeatureProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MLFeatureValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loadOptimizedModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;prediction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;featureValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;output&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;参考資料&quot;&gt;参考資料&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.apple.com/documentation/coreml&quot;&gt;CoreML Documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.apple.com/machine-learning/models/&quot;&gt;Model Optimization Guide&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.apple.com/videos/&quot;&gt;WWDC Sessions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;cta&quot;&gt;
  &lt;h3&gt;相談・見積りのご依頼&lt;/h3&gt;
  &lt;p&gt;小さく速く、成果物ベースでご一緒します。&lt;/p&gt;
  &lt;p&gt;
    &lt;a class=&quot;btn&quot; href=&quot;/work-with-me/&quot;&gt;Work with me&lt;/a&gt;
    &lt;a class=&quot;btn ghost&quot; href=&quot;/newsletter/&quot;&gt;無料ニュースレター&lt;/a&gt;
  &lt;/p&gt;
&lt;/div&gt;

&lt;div class=&quot;related&quot;&gt;
  &lt;h3&gt;次に読む&lt;/h3&gt;
  &lt;ul&gt;
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/rag-audit-checklist.html&quot;&gt;RAGミニ監査チェックリスト（無料DL）&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/edinet-db-howto.html&quot;&gt;EDINET XBRLで作る投資家級データベース&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/coreml-optimization-playbook-en.html&quot;&gt;CoreML Optimization Playbook (Consulting)&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  &lt;/ul&gt;
&lt;/div&gt;

</description>
        <pubDate>Sun, 19 Jan 2025 00:00:00 +0900</pubDate>
        <link>https://kyo1988.github.io/2025/01/19/coreml-optimization-playbook.html</link>
        <guid isPermaLink="true">https://kyo1988.github.io/2025/01/19/coreml-optimization-playbook.html</guid>
        
        <category>CoreML</category>
        
        <category>On-device</category>
        
        <category>Case-Study</category>
        
        <category>iOS</category>
        
        <category>Machine-Learning</category>
        
        
      </item>
    
      <item>
        <title>CoreML Optimization Playbook (Consulting)</title>
        <description>&lt;div class=&quot;tldr&quot;&gt;
  &lt;strong&gt;TL;DR&lt;/strong&gt;
  &lt;p&gt;Key design decisions for on-device optimization without quality loss in 3 minutes. Optimization sequence: quantization → distillation → architecture design.&lt;/p&gt;
&lt;/div&gt;

&lt;h2 id=&quot;design-decision-framework&quot;&gt;Design Decision Framework&lt;/h2&gt;

&lt;h3 id=&quot;1-quantization&quot;&gt;1. Quantization&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;INT8 Quantization&lt;/strong&gt;: 75% model size reduction with &amp;lt;5% accuracy loss&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Dynamic Quantization&lt;/strong&gt;: Quantize only during inference, maintain FP32 during training&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Static Quantization&lt;/strong&gt;: Pre-calibration for higher compression rates&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-knowledge-distillation&quot;&gt;2. Knowledge Distillation&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Teacher-Student&lt;/strong&gt;: Knowledge transfer from large to lightweight models&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Temperature Parameter&lt;/strong&gt;: Soft label generation with T=3-5&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Loss Function&lt;/strong&gt;: Hard labels + soft labels + feature maps&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-architecture-design&quot;&gt;3. Architecture Design&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;MobileNet&lt;/strong&gt;: Depthwise separable convolutions for computational reduction&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;EfficientNet&lt;/strong&gt;: Compound scaling for efficiency maximization&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;SqueezeNet&lt;/strong&gt;: Fire Module for parameter count reduction&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;evaluation-metrics&quot;&gt;Evaluation Metrics&lt;/h2&gt;

&lt;div class=&quot;key-takeaways&quot;&gt;
  &lt;strong&gt;Key Takeaways&lt;/strong&gt;
  &lt;ul&gt;
    
    
      &lt;li&gt;Accuracy: Top-1/Top-5 Accuracy&lt;/li&gt;
    
      &lt;li&gt;Inference Speed: FPS (Frames Per Second)&lt;/li&gt;
    
      &lt;li&gt;Model Size: MB units&lt;/li&gt;
    
      &lt;li&gt;Memory Usage: RAM/VRAM&lt;/li&gt;
    
      &lt;li&gt;Battery Consumption: mAh/inference&lt;/li&gt;
    
  &lt;/ul&gt;
&lt;/div&gt;

&lt;h2 id=&quot;common-pitfalls-and-solutions&quot;&gt;Common Pitfalls and Solutions&lt;/h2&gt;

&lt;h3 id=&quot;typical-failure-patterns&quot;&gt;Typical Failure Patterns&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Excessive Quantization&lt;/strong&gt;: Significant accuracy degradation&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Improper Distillation&lt;/strong&gt;: Temperature setting errors&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Architecture Mismatch&lt;/strong&gt;: Task and model incompatibility&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;solutions&quot;&gt;Solutions&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Incremental Optimization&lt;/strong&gt;: Apply one method at a time and measure effects&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;A/B Testing&lt;/strong&gt;: Parallel comparison of multiple approaches&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Real Device Validation&lt;/strong&gt;: Test on actual devices, not simulators&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;deliverables&quot;&gt;Deliverables&lt;/h2&gt;

&lt;section class=&quot;qa&quot;&gt;
  &lt;h2&gt;Q&amp;amp;A&lt;/h2&gt;
  
  &lt;dl&gt;
  
    
    
    
    
      &lt;dt&gt;How to choose methods?&lt;/dt&gt;
      &lt;dd&gt;Select based on accuracy requirements and constraints. Accuracy priority → distillation, size priority → quantization&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;What are the evaluation metrics?&lt;/dt&gt;
      &lt;dd&gt;Comprehensive evaluation across 5 axes: accuracy, speed, size, memory, battery&lt;/dd&gt;
    
  
    
    
    
    
      &lt;dt&gt;What are the deliverables and timeline?&lt;/dt&gt;
      &lt;dd&gt;Optimized model, implementation guide, performance report (2-6 weeks)&lt;/dd&gt;
    
  
  &lt;/dl&gt;
&lt;/section&gt;

&lt;h2 id=&quot;implementation-example&quot;&gt;Implementation Example&lt;/h2&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// CoreML optimization implementation example&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CoreML&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;OptimizedModelManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loadOptimizedModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MLModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;modelURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Bundle&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;forResource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;optimized_model&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;withExtension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;mlmodelc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MLModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;contentsOf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;modelURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;predict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MLFeatureProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MLFeatureValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loadOptimizedModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;prediction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;featureValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;output&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.apple.com/documentation/coreml&quot;&gt;CoreML Documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.apple.com/machine-learning/models/&quot;&gt;Model Optimization Guide&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.apple.com/videos/&quot;&gt;WWDC Sessions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;cta&quot;&gt;
  &lt;h3&gt;相談・見積りのご依頼&lt;/h3&gt;
  &lt;p&gt;小さく速く、成果物ベースでご一緒します。&lt;/p&gt;
  &lt;p&gt;
    &lt;a class=&quot;btn&quot; href=&quot;/work-with-me/&quot;&gt;Work with me&lt;/a&gt;
    &lt;a class=&quot;btn ghost&quot; href=&quot;/newsletter/&quot;&gt;無料ニュースレター&lt;/a&gt;
  &lt;/p&gt;
&lt;/div&gt;

&lt;div class=&quot;related&quot;&gt;
  &lt;h3&gt;次に読む&lt;/h3&gt;
  &lt;ul&gt;
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/rag-audit-checklist.html&quot;&gt;RAGミニ監査チェックリスト（無料DL）&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/edinet-db-howto.html&quot;&gt;EDINET XBRLで作る投資家級データベース&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/2025/01/19/coreml-optimization-playbook.html&quot;&gt;CoreML最適化プレイブック（受託）&lt;/a&gt;&lt;/li&gt;
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  &lt;/ul&gt;
&lt;/div&gt;

</description>
        <pubDate>Sun, 19 Jan 2025 00:00:00 +0900</pubDate>
        <link>https://kyo1988.github.io/2025/01/19/coreml-optimization-playbook-en.html</link>
        <guid isPermaLink="true">https://kyo1988.github.io/2025/01/19/coreml-optimization-playbook-en.html</guid>
        
        <category>CoreML</category>
        
        <category>On-device</category>
        
        <category>Case-Study</category>
        
        <category>iOS</category>
        
        <category>Machine-Learning</category>
        
        
      </item>
    
      <item>
        <title>SALES FORECASTING 2</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#sales-forecasting-2&quot; id=&quot;markdown-toc-sales-forecasting-2&quot;&gt;SALES FORECASTING 2&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#introduction&quot; id=&quot;markdown-toc-introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#reference&quot; id=&quot;markdown-toc-reference&quot;&gt;Reference&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This is a modified version of the report for Business Analyics in Bath Full Time MBA Class of 2020.&lt;/p&gt;

&lt;h1 id=&quot;sales-forecasting-2&quot;&gt;SALES FORECASTING 2&lt;/h1&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;In this section, it is assumed a pizza parlor business plan in the Bath University has lunched.  The vital issue of the plan is also done so to find one or two pizzas which might be appealed by the Bath University students based on the attributions such as type of topping and base.  Hence, it will be conducted an experiment to attempt diverse pizzas for the target consumers including the students.  However, there are some constrictions for the plan, one of which is the maximum budget of £100 to purchase the pizzas for this experiment.  One of the major tools to find the customer preferences can be conjoint analysis which assumed their preferences as a combination of the attributions having a certain degree &lt;cite&gt;(Janssens et al., 2008)&lt;/cite&gt;.  Therefore, it should be decided that which attributions might be the most relevant to the purpose that is to find the most preferred among the students.  The consideration relevant to the attributions was started from the research suggesting 5 attributions which are the crust, topping, cheese type, cheese quality and price &lt;cite&gt;(Lilien and Rangaswamy, 2002)&lt;/cite&gt;.  The crust has 3 levels which are thin, thick, pan.  Topping’s levels are pineapple, veggie, chicken, turkey.  The levels of cheese type are Romano, mixed, mozzarella.  These of cheese quality are 50g, 75g, 100g.  £4.99, £6.99, £8.99 are the level of price.  As a result, the total possible combinations of attribute levels are 324 (= 3 x 4 x 3 x 3 x 3).  All of them cannot be conducted due to the time and budget restrictions, however, some researchers argued the effective number of part worth parameters to be approximated from conjoint data, the number of which is less than the sum of all levels of each attribution (Wierenga, 2008).  Thus, if at most 16 (= 3 + 4 + 3 + 3 + 3) candidates are selected precisely, these alternatives can be represented all of the possible combinations of attribute levels (ibid).  The selection usually is done by SPSS from all of attribute levels and therefore, the data format to save 16 alternatives representing all possibilities should be suitable for the application.  Furthermore, the data structure of that should be 16 rows with at least 7 columns which are 5 attributions, the primary key and the preference score.  The most well-liked pizza should the maximum preference score (one hundred) and the minimum one (zero) should be rated to the least popular pizza.  Hence. Each pizza must have the preference score from 0 to 100.  Conjoint analysis assumes the preference score can be represented the weighted sum of the utilities for each attribution &lt;cite&gt;(Wierenga, 2008)&lt;/cite&gt;.  This means after collecting the score from the customers being tested, the software (SPSS) can discover weights and utilities of each attributions.  In addition, the key is required to identify each rows, however, it is automatically inserted (see the leftist column of figure 1) when the data is inputted in the data format and then also accordingly the column named ‘STATUS’ with ‘Design’ as the value is inserted as a result of using the function to generate the orthogonal design &lt;cite&gt;(Janssens et al., 2008)&lt;/cite&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1623989695/Figure_1_gtuehf.png&quot; alt=&quot;Figure 1&quot; title=&quot;Figure 1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Furthermore, although it should be tested 16 type of pizzas to collect the target customer preference as the score, there is the budged limitation which the pizzas only can be purchased less than 100 pounds.  This means if assumed the price of normal size pizza is 15 pounds, 6 pizzas are able to be bought for the experiment.  Supposed the shop selected to buy the pizzas can allow to consume at least 3 type of the alternatives among 16 of that in the same pizza, 18 different type of pizza is available for the test.  Therefore, all of alternatives are able to be examined with only 2 duplicates (16 = 18 - 2).  Because of the fact that 6 students are applicable for the evaluation, if each student can eat and rate all of alternatives to cut each piece into 6 parts, the preferable scores of them are able to be collected.  Figure 2 is assumed the result of the 16 alternative pizzas rating by 6 students (identified by id in the figure).  For instance, the column named ‘sco1’ means the students (identified by id in the figure 2) rating score for the top row in the figure 1 (Card ID 1 row).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1623989696/Figure_2_k2ig2k.png&quot; alt=&quot;Figure 2&quot; title=&quot;Figure 2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The utilities of each attributions are estimated by the software, SPSS.  In Figure 3, it is seen apparently that the attribution ‘thin’ (assigned to ‘Crust’ level) has the highest utility (5.708) and the lowest utility (-4.010) is earned by the attribution ‘pineapple’ (belonged to ‘Topping’ level). 
Utilities&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1623989695/Figure_3_bghixu.png&quot; alt=&quot;Figure 3&quot; title=&quot;Figure 3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In addition, Figure 4 shows the averaged importance for each levels of the attributions which mean which levels can earn the highest utility.  In the figure, the level ‘Topping’ has the highest one (22.503) and the lowest one (17.930) is gained by the level ‘Price’.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1623989695/Figure_4_qdicuj.png&quot; alt=&quot;Figure 4&quot; title=&quot;Figure 4&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Furthermore, Figure 5 indicates that both the Pearson’s R (.864) and the Kendall’s tau (.639) which mean the correlations between the recognized and forecasted preferences are high (ibid).  both correlations also are likely to be significant (respectively .000 and .000) because less than .05 significance means the null hypothesis of a null correlation is quite unlikely to be acceptable (ibid). 
Correlations2&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1623989695/Figure_5_qxihdw.png&quot; alt=&quot;Figure 5&quot; title=&quot;Figure 5&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally, Figures 6 through 10, the relative utility levels are demonstrated for each attribute and In Figure 11, the mean importance is displayed for each attribute (ibid).  From Figures 6 through 11, it could be seen that the pizza parlor that offers their customers a thin of crust, Veggie of topping, Romano of cheese type, 50g of cheese quantity and pricing £8.99 might achieve the highest utility.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1598684071/%E5%9B%B36.png&quot; alt=&quot;Figure 6&quot; title=&quot;Figure 6&quot; /&gt;
&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1598684178/%E5%9B%B37.png&quot; alt=&quot;Figure 7&quot; title=&quot;Figure 7&quot; /&gt;
&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1598684256/%E5%9B%B38.png&quot; alt=&quot;Figure 8&quot; title=&quot;Figure 8&quot; /&gt;
&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1598684355/%E5%9B%B39.png&quot; alt=&quot;Figure 9&quot; title=&quot;Figure 9&quot; /&gt;
&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1598685868/%E5%9B%B310.png&quot; alt=&quot;Figure 10&quot; title=&quot;Figure 10&quot; /&gt;
&lt;img src=&quot;https://res.cloudinary.com/djiyxp5ax/image/upload/v1598685920/%E5%9B%B311.png&quot; alt=&quot;Figure 11&quot; title=&quot;Figure 11&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Brownlee, J., 2016. How to Check if Time Series Data is Stationary with Python [Online]. Available from: &lt;a href=&quot;https://machinelearningmastery.com/time-series-data-stationary-python/&quot;&gt;https://machinelearningmastery.com/time-series-data-stationary-python/&lt;/a&gt; [Accessed 30 March 2020].&lt;/li&gt;
  &lt;li&gt;Brownlee, J., 2017. Long Short-Term Memory Networks with Python&lt;/li&gt;
  &lt;li&gt;Downey, A.B., 2011. Think Stats&lt;/li&gt;
  &lt;li&gt;Janert, P.K., 2010. Data Analysis with Open Source Tools&lt;/li&gt;
  &lt;li&gt;Janssens, W., Wijnen, K., Pelsmacker, P.D., Kenhove, P.V., 2008. Marketing Research with SPSS (FT Prentice Hall)&lt;/li&gt;
  &lt;li&gt;Lilien, G.L. and Rangaswamy, A., 2002. Marketing Engineering: Computer Assisted Marketing Analysis and Planning&lt;/li&gt;
  &lt;li&gt;Meulman, J.J. and Koopman, S.J., 2007. An Introduction to State Space Time Series Analysis&lt;/li&gt;
  &lt;li&gt;Palachy, S., 2019. Detecting stationarity in time series data [Online]. Available from: &lt;a href=&quot;https://towardsdatascience.com/detecting-stationarity-in-time-series-data-d29e0a21e638&quot;&gt;https://towardsdatascience.com/detecting-stationarity-in-time-series-data-d29e0a21e638&lt;/a&gt; [Accessed 30 March 2020].&lt;/li&gt;
  &lt;li&gt;Prabhakaran, S., 2019. ARIMA Model – Complete Guide to Time Series Forecasting in Python [Online]. Available from: &lt;a href=&quot;https://www.machinelearningplus.com/time-series/arima-model-time-series-forecasting-python/&quot;&gt;https://www.machinelearningplus.com/time-series/arima-model-time-series-forecasting-python/&lt;/a&gt; [Accessed 30 March 2020].&lt;/li&gt;
  &lt;li&gt;Prabhakaran, S., 2019. Time Series Analysis in Python – A Comprehensive Guide with Examples [Online]. Available from: &lt;a href=&quot;https://www.machinelearningplus.com/time-series/time-series-analysis-python/&quot;&gt;https://www.machinelearningplus.com/time-series/time-series-analysis-python/&lt;/a&gt; [Accessed 30 March 2020].&lt;/li&gt;
  &lt;li&gt;SINGH, A., 2018. A Gentle Introduction to Handling a Non-Stationary Time Series in Python [Online]. Available from: &lt;a href=&quot;https://www.analyticsvidhya.com/blog/2018/09/non-stationary-time-series-python/&quot;&gt;https://www.analyticsvidhya.com/blog/2018/09/non-stationary-time-series-python/&lt;/a&gt; [Accessed 30 March 2020].&lt;/li&gt;
  &lt;li&gt;Taylor, S.J. and Letham, B., 2017. Forecasting at scale. PeerJ Preprints 5:e3190v2 &lt;a href=&quot;https://doi.org/10.7287/peerj.preprints.3190v2&quot;&gt;https://doi.org/10.7287/peerj.preprints.3190v2&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;TensorFlow, 2020. Time series forecasting [Online]. Available from: &lt;a href=&quot;https://www.tensorflow.org/tutorials/structured_data/time_series&quot;&gt;https://www.tensorflow.org/tutorials/structured_data/time_series&lt;/a&gt; [Accessed 30 March 2020].&lt;/li&gt;
  &lt;li&gt;Tieleman, T. and Hinton, G., 2012. Lecture 6.5-rmsprop: Divide the Gradient by a Running Average of Its Recent Magnitude. COURSERA: Neural Networks for Machine Learning, 4, 26-31.&lt;/li&gt;
  &lt;li&gt;Wierenga, B., 2008. Handbook of Marketing Decision Models&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;cta&quot;&gt;
  &lt;h3&gt;相談・見積りのご依頼&lt;/h3&gt;
  &lt;p&gt;小さく速く、成果物ベースでご一緒します。&lt;/p&gt;
  &lt;p&gt;
    &lt;a class=&quot;btn&quot; href=&quot;/work-with-me/&quot;&gt;Work with me&lt;/a&gt;
    &lt;a class=&quot;btn ghost&quot; href=&quot;/newsletter/&quot;&gt;無料ニュースレター&lt;/a&gt;
  &lt;/p&gt;
&lt;/div&gt;

&lt;div class=&quot;related&quot;&gt;
  &lt;h3&gt;次に読む&lt;/h3&gt;
  &lt;ul&gt;
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        &lt;li&gt;&lt;a href=&quot;/Kyo.github.io/business/analyics/2021/05/08/sales-forecasting.html&quot;&gt;SALES FORECASTING&lt;/a&gt;&lt;/li&gt;
        
      
    
  
  &lt;/ul&gt;
&lt;/div&gt;
</description>
        <pubDate>Fri, 18 Jun 2021 00:00:00 +0900</pubDate>
        <link>https://kyo1988.github.io/business/analyics/2021/06/18/SALES-FORECASTING-2.html</link>
        <guid isPermaLink="true">https://kyo1988.github.io/business/analyics/2021/06/18/SALES-FORECASTING-2.html</guid>
        
        <category>Business Analyics</category>
        
        <category>Conjoint Analysis</category>
        
        <category>SPSS</category>
        
        <category>Marketing Research</category>
        
        
        <category>Business</category>
        
        <category>Analyics</category>
        
      </item>
    
      <item>
        <title>Organize and implement Hull and White (1994a) interest rate model</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#organize-and-implement-hull-and-white-1994a-interest-rate-model&quot; id=&quot;markdown-toc-organize-and-implement-hull-and-white-1994a-interest-rate-model&quot;&gt;Organize and implement Hull and White (1994a) interest rate model&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#derivation-of-hull-and-white-1994a-interest-rate-model-solutions-and-boundary-conditions&quot; id=&quot;markdown-toc-derivation-of-hull-and-white-1994a-interest-rate-model-solutions-and-boundary-conditions&quot;&gt;Derivation of Hull and White (1994a) interest rate model solutions and boundary conditions&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#hull-and-white-tree-formulation&quot; id=&quot;markdown-toc-hull-and-white-tree-formulation&quot;&gt;Hull and White Tree formulation&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#hull-and-white-tree-implementation&quot; id=&quot;markdown-toc-hull-and-white-tree-implementation&quot;&gt;Hull and White Tree Implementation&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#reference&quot; id=&quot;markdown-toc-reference&quot;&gt;Reference&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;organize-and-implement-hull-and-white-1994a-interest-rate-model&quot;&gt;Organize and implement Hull and White (1994a) interest rate model&lt;/h1&gt;
&lt;h2 id=&quot;derivation-of-hull-and-white-1994a-interest-rate-model-solutions-and-boundary-conditions&quot;&gt;Derivation of Hull and White (1994a) interest rate model solutions and boundary conditions&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Definition [Hull and White(1994a) interest rate model]
\begin{eqnarray}\label{HullandWhite1994a}
dr(t)=(\theta(t)-ar(t))dt+\sigma d\tilde{W}(t) ．
\end{eqnarray}&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;However, $\tilde{W}(t)$ is Brownian motion under the risk-neutral measure $\mathbb{P}$.
Also, $\theta (t)$, $a$, and $\sigma$ are positive-definite functions for time (Hull and White, 1994a).&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Definition [Discount bond price evaluation formula]
\begin{eqnarray}\label{DiscountBondPrice}
B(t,T)=\tilde{\mathbb{E}}[e^{-\int_{t}^{T}R(s)ds}|{\cal F}(t)] ．
\end{eqnarray}&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Here, a discount bond is a contract in which $1$ is paid for a certain fixed maturity of $T$, and no payment is made before the maturity.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Definition [Yield from time $t$ to $T$]
\begin{eqnarray}
Y(t,T)=-\frac{1}{T-t}\log B(t,T)．
\end{eqnarray}&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This is equivalent to the following equation.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
B(t,T)=e^{-Y(t,T)(T-t)}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore, $B(T, T) =1$.&lt;/p&gt;

&lt;p&gt;The random variable $e^{-\int_{t}^{T}R(s)ds}$ estimated in the equation \eqref{DiscountBondPrice} depends not only on $R(T)$ but also on the path. However, the path of $R$ to time $t$ depends only on $R(t)$ at time $t$. Therefore, since $R$ is a Markov process, the bond price $B(t, T)$ is considered to be a function of time $t$ and $R(t)$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
B(t,T)=f(t,R(t))．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;On the other hand, since the equation \eqref{DiscountBondPrice} is the expansion of $D(t)B(t,T)=\tilde{\Bbb{E}}[D(T)B(T,T))\lvert\cal{F}(t)]$, then $D(t)B(t,T)=D(t)f(t,T)$ is a martingale.&lt;/p&gt;

&lt;p&gt;Therefore, in order for the no arbitrage condition to hold, the drift $(dt)$ term obtained by differentiating $D(t)f(t,T)$ must appear as $0$.&lt;/p&gt;

&lt;p&gt;To find the derivative of $D(t)f(t,T)$, it is required first to find the discount process and its relational expression.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Definition [discount process]
\begin{eqnarray}
D(t)=e^{-\int_{0}^{t}R(s)ds}．
\end{eqnarray}&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Here, if $S(x)=e(-t)$ and $I(t)=\int_{0}^{t}R(s)ds$, then $D(t) = S(I(t))$.
At this time, since $dI(t)=R(t)dt$, $dI(t)dI (t)=0$ and $S’(x)=-S (x)$, $S’‘(x) =S(x)$ then from Ito’s lemma,&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
dD(t)=dS(I(t)) 
=S’(I(t))dI(t)+\frac{1}{2}S’‘(I(t))dI(t)dI(t) 
=-S(I(t))dI(t) 
=-D(t)R(t)dt．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;therefore,&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
dD(t)=-D(t)R(t)dt．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;If the interest rate process $R(t)$ in finding the derivative of $D(t)f(t,T)$ follows the equation \eqref{HullandWhite1994a}, then From $dtdt=0$, $dtd\tilde{W}=0$, $d\tilde{W}d\tilde{W}=dt$ and $drdr= \sigma^2dt$&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
d(D(t)f(t,T))
=f(t,T)dD(t)+D(t)df(t,T)
=f(t,T)(-D(t)R(t))+D(t){f_t(t,T)dt+f_r(t,T)dr+\frac{1}{2}f_rr(t,T)drdr} 
=D(t)(-rf(t,T)+f_t(t,T)+\frac{1}{2}\sigma^2 f_rr(t,T)+(\theta(t)-ar(t))f_r(t,T))dt+D(t)\sigma f_r(t,T)d\tilde{W}(t)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore, $f(t, T))$ must be met.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{HullWhitePDE}
f_t(t,T)+\frac{1}{2}\sigma^{2} f_rr(t,T)+(\theta(t)-ar(t))f_r(t,T)=rf(t,T)
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Also, since $1=B(T, T)=f(T, r)$, the terminal condition is obtained.&lt;/p&gt;

&lt;p&gt;For all $r$,
\begin{eqnarray}
f(T,r)=1
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Next, the partial differential equation of the equation \eqref{HullWhitePDE} is expanded to obtain an analytical solution.
If you set $f_t(t, T)=e^{-rC (t, T) -A (t, T)}$,&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
f_t(t,r)=(-rC’(t,T)-A’(t,T))f(t,r)． 
f_r(t,r)=-C(t,T)f(t,r)． 
f_rr(t,r)=-C^{2}(t,T)f(t,r)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Where $C’(t,T)=\frac{\partial C(t,T)}{\partial t}$，$A’(t,T)=\frac{\partial A(t,T)}{\partial t}$．
Therefore, the left side of the formula \eqref{HullWhitePDE} is&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
f_t(t,T)+\frac{1}{2}\sigma f_rr(t,T)+(\theta(t)-ar(t))f_r(t,T) 
=(-rC’(t,T)-A’(t,T)+\frac{1}{2}\sigma^{2}C^{2}(t,T)-(\theta(t)-ar(t))C(t,T))f(t,r)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore, by transposing the right side to the left side and enclosing it with $r$, the following relational expression is obtained.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
((-C’(t,T)+aC(t,T)-1)r-A’(t,T)-\theta(t)C(t,T)+\frac{1}{2}\sigma^{2}C^{2}(t,T))f(t,r)=0．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;From the assumption, $f_t(t, T)=e^{-rC(t, T)-A(t, T)}&amp;gt;0$, and this relation must hold for all $r$, then this term for $r$ must be $0$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
C’(t,T)=aC(t,T)-1．
A’(t,T)=-\theta(t)C(t,T)+\frac{1}{2}\sigma^{2}C^{2}(t,T)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Furthermore, $C(T, T)=A’(T, T)=A(T, T)=0$ is required to hold for the terminal condition.&lt;/p&gt;

&lt;p&gt;A function that satisfies $C’(t, T)=aC(t, T)-1$, $C(T, T)=0$&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
C(t,T)=\int_{t}^{T}e^{-\int_{t}^{s}a(v)dv}ds．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;It is shown that this is a unique solution to be obtained.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
\frac{d }{d s}(e^{-\int_{0}^{s}a(v)dv} C(s,T))
=e^{-\int_{0}^{s}a(v)dv}(-a(s)C(s,T)+C’(s,T) ) 
=e^{-\int_{0}^{s}a(v)dv}(-a(s)C(s,T)+aC(t,T)-1 ) 
=e^{-\int_{0}^{s}a(v)dv}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Integrating both sides of this equation from $t$ to $T$&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
e^{-\int_{0}^{T}a(v)dv}C(T,T)-e^{-\int_{0}^{t}a(v)dv}C(t,T)=-\int_{t}^{T}e^{-\int_{0}^{s}a(v)dv}ds 
\Leftrightarrow C(t,T)=e^{\int_{0}^{t}a(v)dv}\int_{t}^{T}e^{-\int_{0}^{s}a(v)dv}ds&lt;br /&gt;
=\int_{t}^{T}e^{-\int_{t}^{s}a(v)dv}ds．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;The expansion of this unique solution is as follows. However, $a(v)=a$ is set from the equation \eqref{HullandWhite1994a}.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
C(t,T)=\int_{t}^{T}e^{-\int_{t}^{s}a(v)dv}ds 
=\int_{t}^{T}e^{-as+at}ds 
=\frac{1}{a}(1-e^{-a(T-t)})．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Similarly, the function, that satisfies $A(T, T)=1$, $A’(t, T)=-\theta(t)C(t, T)+\frac{1}{2}\sigma^{2}C^{2}(t, T)$, is shown below as a unique solution.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
A(t,T)=\int_{t}^{T}(\theta(t)C(t,T)-\frac{1}{2}\sigma^{2}C^{2}(t,T) )ds．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Integrating both sides of this equation from $t$ to $T$
\begin{eqnarray}
A(T,T)-A(t,T)=-\int_{t}^{T}\theta(t)C(t,T)ds+\frac{1}{2}\int_{t}^{T}\sigma^{2}C^{2}(t,T)ds 
\Leftrightarrow A(t,T)=\int_{t}^{T}(\theta(t)C(t,T)-\frac{1}{2}\sigma^{2}C^{2}(t,T))ds．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;The expansion of this unique solution is as follows. However, $a(v)=a$ is set from the equation \eqref{HullandWhite1994a}.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
A(t,T)=\int_{t}^{T}(\theta(t)C(t,T)-\frac{1}{2}\sigma^{2}C^{2}(t,T) )ds 
=\int_{t}^{T}(\frac{\theta(t)}{a}(1-e^{-a(T-t)})-\frac{1}{2}\sigma^{2}\frac{1}{a^2}(1-e^{-a(T-t)} )^{2} )ds 
=\frac{\sigma^{2}}{2a^3}(-a(T-t)+2(1-e^{-a(T-t)})-\frac{1}{2}(1-e^{-2a(T-t)})) 
+\frac{1}{a}\int_{t}^{T}\theta(s)(1-e^{-a(T-s)})ds．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Next, the parameter $\theta(t)$ in the equation \eqref{HullandWhite1994a} means the speed of mean reversion. It is required to match this parameter to the term structure of the quoted interest rate.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Definition [Instantaneous Forward Rate]
Let $f^{M}(0, T)$ be the instantaneous forward rate of the market at maturity $T$ at time $0$.
\begin{eqnarray}
f^{M}(0,T)=-\frac{\partial \ln B^{M}(0,T)}{\partial T}．
\end{eqnarray}
Here, $B^{M}(0, T)$ is the discount bond price quoted in the market at maturity $T$.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Because it is $B(t,T)=f(t,r)=e^{-rC(t,T)-A(t,T)}$，&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
\ln B(0,T)=-rC(0,T)-A(0,T) 
=-\frac{r}{a}(1-e^{-aT} ) 
-\frac{\sigma^{2}}{2a^3}(-aT+2(1-e^{-aT})-\frac{1}{2}(1-e^{-2aT})) 
+\frac{1}{a}\int_{0}^{T}\theta(s)(1-e^{-a(T-s)})ds 
\Leftrightarrow \frac{\partial \ln B^{M}(0,T)}{\partial T}=re^{-aT}+\frac{\sigma^{2}}{2a^3}(-a+2ae^{-aT}+e^{-2aT})+\int_{t}^{T}\theta(s)e^{-a(T-s)}ds 
\Leftrightarrow f^{M}(0,T)=re^{-aT}+\frac{\sigma^{2}}{2a^3}(-a+2ae^{-aT}+e^{-2aT})+\int_{t}^{T}\theta(s)e^{-a(T-s)}ds．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;The following relationship is used to derive $\theta(T)$ from $f^{M}(0, T)$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
H(t)=\int_{0}^{t}h(s,t)dsarrow H’(t)=\int_{0}^{t}\frac{\partial h(s,t)}{\partial t}ds+h(t,t)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Here, $x(t)=re^{-at}+\int_{0}^{t}\theta(s)e^{-a(t-s)}ds$&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
x’(t)=-a(re^{-at}+\int_{0}^{t}\theta(s)e^{-a(t-s)}ds)+\theta(t) 
x’(t)=-ax(t)+\theta(t) 
\Leftrightarrow \theta(t)=x’(t)+ax(t) 
arrow \theta(T)=x’(T)+ax(T)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;On the other hand, if it is set $g(t)=\frac{\sigma^2}{2a^2}(-1+2e^{-at}+e^{-2at})$&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
f^{M}(0,T)=x(T)+g(T) 
\Leftrightarrow x(T)=f^{M}(0,T)-g(T)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore 
\begin{eqnarray}
\theta(T)=\frac{\partial f^{M}(0,T)}{\partial T}-\frac{\partial g(T)}{\partial T}+ax(t)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Here, since it is $\frac{\partial g(T)}{\partial T}=-\frac{\sigma^2}{a}(e^{-aT}+e^{-2aT})$, the following equation is obtained after all.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
\theta(T)=\frac{\partial f^{M}(0,T)}{\partial T}+\frac{\sigma^2}{a}(e^{-aT}+e^{-2aT})+af^{M}(0,T)-\frac{\sigma^2}{2a^2}(-1+2e^{-at}+e^{-2at})．
\end{eqnarray}&lt;/p&gt;

&lt;h2 id=&quot;hull-and-white-tree-formulation&quot;&gt;Hull and White Tree formulation&lt;/h2&gt;

&lt;p&gt;In the following, to represent the interest rate model as the $3$ term tree, it is derived the relational expression between the parameters of the continuous time process and the parameters of the $3$ term process.&lt;/p&gt;

&lt;p&gt;In the $3$ term process, it is expressed by $p_u$, $p_m$, and $p_d$, respectively, during the minute time $\Delta t$ as the interest rate rises by the spatial division width $\Delta x$, or stays at the same level, decreasing by $\Delta x$.&lt;/p&gt;

&lt;p&gt;Furthermore, $\Delta t$ and $\Delta x$ cannot be selected independently and must satisfy the conditions for stability and convergence of the finite difference method $\Delta x=\sigma \sqrt{3\Delta t}$ (Hull and White, 1994).&lt;/p&gt;

&lt;p&gt;Here, if the drift term of the formula \eqref{HullandWhite1994a} is set $\nu=\theta(t)-ar(t)$,&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{averrageA}
\mathbb{E}[\Delta x]=p_u(\Delta x)+p_m(0)+p_d(-\Delta x)=\nu\Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceA}
\mathbb{E}[\Delta x^2]=p_u(\Delta x^2)+p_m(0)+p_d(-\Delta x^2)=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}
\begin{eqnarray}\label{SumProA}
p_u+p_m+p_d=1．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;The expression \eqref{averrageA} and the expression \eqref{varianceA} are expanded as follows.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{averrageAA}
p_u\Delta x-p_d\Delta x=\nu \Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceAA}
p_u\Delta x^2-p_d\Delta x^2=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Multiply the expression \eqref{averrageAA} by $\Delta x$ and add the expression \eqref{varianceAA},&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{puA}
2p_u\Delta x^2=\nu^2\Delta t^2+\sigma^2\Delta t+\nu \Delta t\Delta x 
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Also, substituting the expression \eqref{puA} into the expression \eqref{averrageAA},&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
p_u\Delta x-p_d\Delta x=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )\Delta x-p_d\Delta x 
\Leftrightarrow p_d\Delta x=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )\Delta x&lt;br /&gt;
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;And if it is substituted the expression \eqref{puA} and the expression \eqref{puA} into the expression \eqref{SumProA}&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{pmA}
p_u+p_m+p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )+p_m+\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} ) 
=\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+p_m 
\Leftrightarrow p_m=1-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Hull And White (1994a) proposed a method for constructing an efficient and accurate short rate for the equation \eqref{HullandWhite1994a}. Also, it is assumed $\theta(t)=0$，$r(0)=0$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
dr(t)=ar(t)dt+\sigma d\tilde{W}(t) ．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore, note that $\nu=-ar$. In this simplified tree, the value of $r$ at the time $i\Delta t$ is $j\Delta t$. Since the tree is designed to reduce the amount of calculation, $j$ needs to be between $BottomNode[i]$ and $TopNode[i]$. The choice of which branching process to take at each node depends on the sign of $a$ and the size of $j$, and the range of change $\Delta x(=\Delta r)$ in the simplified $r$ process is chosen to match the expected value of $\mathbb{E}[\Delta x]$ and the variance $Var(\Delta x)$. Furthermore, when $a$ is positive, if $M$ is the expected value of the fluctuation range, when $j$ is the smallest integer larger than $-0.184/M$, the standard branching process is switched to the downward branching process. In order to maintain the symmetry, HW proposes to switch from the standard branching process to the upward branching process in the node $j$ with a negative sign for this node (Hull and White, 1994).&lt;/p&gt;

&lt;p&gt;Here，
\begin{eqnarray}
\mathbb{E}[\Delta x]=\nu \Delta t 
=-ar\Delta t 
=Mr 
\Leftrightarrow M=-a\Delta t．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Also，
\begin{eqnarray}
Var(\Delta x)=\mathbb{E}[\Delta x^2]-(\mathbb{E}[\Delta x])^2 
=(\nu^2\Delta t^2+\sigma^2\Delta t)-(\nu \Delta t)^2 
=\sigma^2\Delta t．
\end{eqnarray}
It becomes. Here,$M^2=a^2\Delta t^2$，$r=j\Delta r$,&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{ExForPb1}
\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}=\frac{(-ar)^2\Delta t^2+\sigma^2\Delta t}{ (\sigma \sqrt(3\Delta t))^2} 
=\frac{(-a\Delta t)^2r^2+\sigma^2\Delta t}{ 3\sigma^2 \Delta t} 
=\frac{M^2(j\Delta r)^2+\sigma^2\Delta t}{ 3\sigma^2 \Delta t} 
=\frac{1}{3}\frac{j^2 M^2 \Delta r^2+\sigma^2\Delta t}{ \sigma^2 \Delta t} 
=\frac{1}{3}\frac{j^2 M^2 \Delta r^2}{ \sigma^2 \Delta t}+\frac{1}{3} 
=\frac{1}{3}\frac{j^2 M^2 (3\sigma^2 \Delta t)}{ \sigma^2 \Delta t}+\frac{1}{3} 
=j^2M^2+\frac{1}{3}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore from the formula \eqref{ExForPb1},
\begin{eqnarray}
p_m=1-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=1-(j^2M^2+\frac{1}{3}) 
=\frac{2}{3}-j^2M^2．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;On the other hand,
\begin{eqnarray}\label{ExForPb2}
\frac{\nu\Delta t}{\Delta x}=\frac{(-ar)\Delta t}{\sigma\sqrt(3\Delta t)} 
=\frac{-Mr}{\sigma\sqrt(3\Delta t)} 
=\frac{-jr\Delta r}{\sigma\sqrt(3\Delta t)} 
=\frac{-jr(\sigma\sqrt(3\Delta t))}{\sigma\sqrt(3\Delta t)} 
=-jM．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore from the formula \eqref{ExForPb2},&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} ) 
=\frac{1}{2}( j^2M^2+\frac{1}{3} -jM ) 
=\frac{1}{6}+\frac{j^2M^2-jM}{2}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x}) 
=\frac{1}{2}(j^2M^2+\frac{1}{3}+jM) 
=\frac{1}{6}+\frac{j^2M^2+jM}{2}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Next, it is derived from the probabilities corresponding to the upward branching process.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{averrageB}
\mathbb{E}[\Delta x]=p_u(2\Delta x)+p_m(\Delta x)+p_d(0)=\nu\Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceB}
\mathbb{E}[\Delta x^2]=p_u(2\Delta x)^2+p_m(\Delta x^2)+p_d(0)=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}
\begin{eqnarray}\label{SumProB}
p_u+p_m+p_d=1．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;The expression \eqref{averrageB} and the expression \eqref{varianceB} are expanded as follows.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{averrageBB}
2p_u\Delta x+p_m\Delta x=\nu \Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceBB}
4p_u\Delta x^2+p_m\Delta x^2=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Subtracting the expression \eqref{averrageBB} from the expression \eqref{varianceBB} multiplied by $\Delta x$&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{puB}
2p_u\Delta x^2=\nu^2\Delta t^2+\sigma^2\Delta t-\nu \Delta t\Delta x 
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Also, if it is assigned the expression \eqref{puB} to the expression \eqref{averrageBB},
\begin{eqnarray}\label{pmB}
2p_u\Delta x+p_m\Delta x=\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x}+p_m\Delta x 
\Leftrightarrow p_m\Delta x=2\nu \Delta t-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}&lt;br /&gt;
\Leftrightarrow p_m=\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;And if it is substituted the expression \eqref{puB} and the expression \eqref{pmB} into the expression \eqref{SumProB}
\begin{eqnarray}\label{pdB}
p_u+p_m+p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )+\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+p_d 
=\frac{3}{2}\frac{\nu \Delta t}{\Delta x}-\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+p_d 
\Leftrightarrow p_d=1-\frac{1}{2}( \frac{3\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} ) ．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore from the formula \eqref{ExForPb1},
\begin{eqnarray}
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} ) 
=\frac{1}{2}( j^2M^2+\frac{1}{3}-(-jM)) 
=\frac{1}{6}-\frac{j^2M^2+jM}{2}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
p_m=\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=-2jM-(j^2M^2+\frac{1}{3}) 
=\frac{1}{3}-j^2M^2-2jM．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
p_d=1-\frac{1}{2}( \frac{3\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} ) 
=1-frac{1}{2}( -3jM-j^2M^2-\frac{1}{3}) 
=\frac{7}{6}+\frac{j^2M^2+3jM}{2}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Then, the probability corresponding to the downward branching process is derived.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{averrageC}
\mathbb{E}[\Delta x]=p_u(0)+p_m(-\Delta x)+p_d(-2\Delta x)=\nu\Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceC}
\mathbb{E}[\Delta x^2]=p_u(0)+p_m(-\Delta x)^2+p_d(-2\Delta x)^2=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}
\begin{eqnarray}\label{SumProC}
p_u+p_m+p_d=1．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;The expression \eqref{averrageC} and the expression \eqref{varianceC} are expanded as follows.
\begin{eqnarray}\label{averrageCC}
-p_m\Delta x-2p_d\Delta x=\nu \Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceCC}
p_m\Delta x^2+4p_d\Delta x^2=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Add the expression \eqref{varianceCC} multiplied by $\Delta x$ and the expression \eqref{averrageCC},
\begin{eqnarray}\label{pdC}
2p_d\Delta x^2=\nu^2\Delta t^2+\sigma^2\Delta t+\nu \Delta t\Delta x 
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Also, if it is assigned the expression \eqref{pdC} to the expression \eqref{averrageCC},
\begin{eqnarray}\label{pmC}
-p_m\Delta x-2p_d\Delta x=-p_m\Delta x-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} 
\Leftrightarrow -p_m\Delta x=2\nu \Delta t+\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}&lt;br /&gt;
\Leftrightarrow p_m=-\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;And if it is substituted the expression \eqref{pdC} and the expression \eqref{pmC} into the expression \eqref{SumProC},
\begin{eqnarray}\label{puC}
p_u+p_m+p_d=p_u-\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} ) 
=p_u-\frac{3}{2}\frac{\nu \Delta t}{\Delta x}-\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
\Leftrightarrow p_u=1+\frac{3}{2}\frac{\nu \Delta t}{\Delta x}+\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore from the formula \eqref{ExForPb1},
\begin{eqnarray}
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} ) 
=\frac{1}{2}( j^2M^2+\frac{1}{3}-jM) 
=\frac{1}{6}-\frac{j^2M^2-jM}{2}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
p_m=-\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=2jM-(j^2M^2+\frac{1}{3}) 
=-\frac{1}{3}-j^2M^2+2jM．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
p_u=1+\frac{3}{2}\frac{\nu \Delta t}{\Delta x}+\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=1+\frac{3}{2}(-jM)+\frac{1}{2}(j^2M^2+\frac{1}{3}) 
=\frac{7}{6}+\frac{j^2M^2-3jM}{2}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Finally, the short rate process is introduced into the drift term $a_i$, which fluctuates with time. This drift term is chosen to be consistent with the discount bonds market quoted.
\begin{eqnarray}
P(0,i+1)=\int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{(-a_i+j\Delta r)\Delta t}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Here, $Q_{i,j}$ is a security that pays $1$ when the node $(i,j)$ is reached, and pays nothing at other times.
Therefore, the drift term $ a_i $ is given as follows.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
\ln P(0,i+1)=\ln \int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{j\Delta r\Delta t}-a_i\Delta t 
\Leftrightarrow a_i\Delta t=\ln \int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{j\Delta r\Delta t}-\ln P(0,i+1) 
\Leftrightarrow a_i=\frac{\ln \int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{j\Delta r\Delta t}-\ln P(0,i+1)}{\Delta t}．
\end{eqnarray}&lt;/p&gt;

&lt;h2 id=&quot;hull-and-white-tree-implementation&quot;&gt;Hull and White Tree Implementation&lt;/h2&gt;

&lt;p&gt;It is given the simplified tree implementation mentioned above. The source code is written in matlab 2016b.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Full of below code is in &lt;a href=&quot;https://github.com/kyo1988/Kyo.github.io/blob/gh-pages/scripts%20for%20article/BuildHWF1.m&quot;&gt;my GitHub account&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-css&quot; data-lang=&quot;css&quot;&gt; 
&lt;span class=&quot;nf&quot;&gt;#container&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;left&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;margin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;-240px&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; 
    &lt;span class=&quot;nt&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:N-1&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;sigma&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)));&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:N-1&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:-1:-m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;sigma&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.^&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)./&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;M-k&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))./&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;pu&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;./(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).^&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)+(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.^&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)./&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;pd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;./(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).^&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)+(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.^&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)./&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;pm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;./(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).^&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.^&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:N-1&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt;  
    &lt;span class=&quot;nt&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:N-1&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;pu&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)));&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;pm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)));&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;pd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)));&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;3&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:-1:-m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 
                &lt;span class=&quot;nt&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:-1:-m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 
                    &lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)...&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;pu&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)...&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;pm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)==&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)...&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;pd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;P&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))./(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt; 
    &lt;span class=&quot;nt&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;2&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;:-1&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;:-m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)));&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;P&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)))./(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt; 
    &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:-1:-m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)+&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; 
            &lt;span class=&quot;nt&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).*(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)));&lt;/span&gt; 
        &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt; 
    &lt;span class=&quot;nt&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Hull, J. and A. White, 1994. “Numerical procedures for implementing term structure models I:Single-Factor Models,’’ Journal of Derivatives, 2, 1 (Fall 1994a) 7−16&lt;/li&gt;
  &lt;li&gt;Strickland, C. and Clewlow, L., 1998. Implementing Derivatives Models&lt;/li&gt;
  &lt;li&gt;Shreve, S., 2004. Stochastic Calculus for Finance II: Continuous-Time Models&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Wed, 09 Jun 2021 00:00:00 +0900</pubDate>
        <link>https://kyo1988.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html</link>
        <guid isPermaLink="true">https://kyo1988.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html</guid>
        
        <category>Business Finance</category>
        
        
        <category>Business</category>
        
        <category>Finance</category>
        
      </item>
    
      <item>
        <title>Derivation of Black-Scholes PDE and its analytical solution by arbitrage pricing theory</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory&quot; id=&quot;markdown-toc-derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory&quot;&gt;Derivation of Black-Scholes PDE and its analytical solution by arbitrage pricing theory&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#necessary-and-sufficient-condition-to-duplicate-the-portfolio-which-does-fully-hedge-the-option-sell-position&quot; id=&quot;markdown-toc-necessary-and-sufficient-condition-to-duplicate-the-portfolio-which-does-fully-hedge-the-option-sell-position&quot;&gt;Necessary and sufficient condition to duplicate the portfolio, which does fully hedge the option sell position&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#reference&quot; id=&quot;markdown-toc-reference&quot;&gt;Reference&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory&quot;&gt;Derivation of Black-Scholes PDE and its analytical solution by arbitrage pricing theory&lt;/h1&gt;

&lt;p&gt;In general, when the underlying asset price is given by a stochastic differential equation, the price of the derivative product is given by a partial differential equation. In this paper, it will be derived from the Black-Scholes PDE corresponding to the derivative (here, option) price valuation of the underlying asset (here, stock) modeled as the geometric Brownian motion. The valuation of an option is given by determining the initial funding needed to fully hedge the selling position of the option. Since the determined initial fund is the amount required to build a duplicate portfolio, it is called the no arbitrage price at time zero of the option. The price valuation method that duplicates options in stock market and money market account transactions is called arbitrage pricing theory (APT).&lt;/p&gt;

&lt;p&gt;Suppose it is given a portfolio valued at $X(t)$ at any time $t$. Here, the composition of the given portfolio is as follows.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;money-market account with interest rate $r$&lt;/li&gt;
  &lt;li&gt;A stock modeled by the geometric Brownian motion expressed by the following equation&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;\begin{eqnarray}\label{stockPrice}
dS(t)=\alpha S(t)dt+\sigma S(t)dW(t)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Here, it is assumed that the investor who holds the given portfolio holds the stock in the unit of $\Delta(t)$ at any time $t$. At this time, it is assumed that the number of shares held $\Delta(t)$ is an ‘adapted stochastic process’. The remainder of the portfolio excluding the investment in stocks, $X(t)-\Delta(t)S(t)$, is invested in the money market account.
Here, the small change $dX(t)$ of the portfolio value $X(t)$ at any time $t$ results in the following two factors.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Profit from holding shares $\Delta(t)dS(t)$&lt;/li&gt;
  &lt;li&gt;Profit from holding cash $r(X(t)-\Delta(t)S(t))dt$&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;That is, the small change in portfolio value $dX(t)$ is given by the following equation.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{portDiff}
dX(t)=\Delta(t)dS(t)+r(X(t)-\Delta(t)S(t))dt．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;The equation \eqref{portDiff} is expanded as follows from the stochastic differential equation \eqref{stockPrice} of a given stock price.
\begin{eqnarray}\label{portDiff2}
dX(t)=\Delta(t)dS(t)+r(X(t)-\Delta(t)S(t))dt　
=\Delta(t)( \alpha S(t)dt+\sigma S(t)dW(t) )+r(X(t)-\Delta(t)S(t))dt
=rX(t)dt+\Delta(t)( \alpha -r )S(t)dt+\Delta(t)\sigma S(t)dW(t)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Here, the three terms appearing in the small change $dX(t) in portfolio value $\eqref{portDiff2} expanded by the given stock price of the stochastic differential equation \eqref{stockPrice} can be interpreted as follows.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;$rX(t)dt$: A term that reflects the profit from the expected rate of return of the portfolio $r$&lt;/li&gt;
  &lt;li&gt;$\Delta(t)( \alpha -r )S(t)dt$: A term that reflects the risk premium on equity investments $\alpha-r$&lt;/li&gt;
  &lt;li&gt;$\Delta(t)\sigma S(t)dW(t)$: Volatility term proportional to the size of equity investment&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Then, consider the discounted stock price $\mathrm{e}^{-rt} S(t)$ and the discounted portfolio value $\mathrm{e}^{-rt}X(t)$. In order to analyze these price processes, it should be noted that they are different from ordinary analysis due to the nature of the geometric Brownian motion that appeared as a model of stock prices. This property means that Brownian motion has a non-zero quadratic variation, which, as it will be seen later, is the source of the volatility term of the Black-Scholes PDE.
In other words, to differentiate an expression expressed in the form of $f(W(t))$ with $f(x)$ as a differentiable function and $W(t)$ as the Brown motion. If Brown motion $W(t)$ is differentiable, the following equation holds from ordinary analysis by the chain rule of the composite function.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
\frac{d}{dt}f(W(t))=f’(W(t))W’(t) \Leftrightarrow df(W(t))=f’(W(t))W’(t)dt=f’(W(t))dW(t)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;However, since Brownian motion accumulates a quadratic variation of 1 per unit time $(dWdW = dt)$, the derivative of $f(W(t))$ has a correction term shown in the following equation.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{ItoFormDiff}
df(W(t))=f’(W(t))dW(t)+\frac{1}{2}f’‘(W(t))dt．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;The formula \eqref{ItoFormDiff} is called Ito’s formula in differential form. The equation \eqref{ItoFormDiff} is an equation obtained by differentiating Ito’s formula \eqref{ItoForm} for the Brownian motion shown below.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Ito’s formula for Brownian motion&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Partial differentiation of $f(t, x)$, $f_ {t}(t, x)$, $f_{x}(t, x)$, $f_ {xx}(t, x)$ is defined and continuous. Let $W(t)$ be the Brownian motion. At this time, the following equation holds for all $T \geq0$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{ItoForm}
f(T，W(T))=f(0，W(0))+\int_{0}^{T}f_{t}(t，W(t))dt+\int_{0}^{T}f_{x}(t，W(t))dW(t)+\frac{1}{2}\int_{0}^{T}f_{xx}(t，W(t))dt．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Where the third term of the expression \eqref{ItoForm} $\int_{0}^{T}f_{x}(t, W(t)) dW(t)$ is called Ito integral, and the second and fourth terms are Lebesgue integrals for variables of time. Ito’s formula can be extended to general stochastic processes including the Brown process, excluding jump process. This stochastic process is called the Ito process $dX(t)=a(t)dW(t)+b(t)dt$, which accumulate the quadratic variation of $a^{2}(t)$ per unit time. It is assumed that $a(t)$ and $b(t)$ are adapted stochastic processes.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Ito’s formula for the Ito process&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Let $X(t)$ be the Ito process, and $f(t, x)$ be the partial derivative $f_{t}(t, x)$, $f_{x}(t, x)$, $f_{xx}(t, x)$ be a defined and continuous function, and let $W(t)$ be Brownian motion. At this time, the following equation holds for all $T \geq 0$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{ItoFormII}
f(T，X(T))=f(0，X(0))+\int_{0}^{T}f_{t}(t，X(t))dt+\int_{0}^{T}f_{x}(t，X(t))dX(t)+\frac{1}{2}\int_{0}^{T}f_{xx}(t，X(t))a^{2}(t)dt．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore, the derivative of the discounted stock price $\mathrm{e}^{-rt} S(t)$ is $f(t, x) = \mathrm{e}^{-rt} x$ which is gotten to apply Ito’s formula \eqref{ItoForm}. In the following, it is used that $f_{t} (t, x )=-r \mathrm{e}^{-rt} x$, $ f_{x}  (t, x )=\, mathrm{e}^{-rt}$, $f_{xx} (t, x )=0 $.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{DiscountStockPrice}
d( \mathrm{e}^{-rt}S(t) )=df(t，S(t)) =f_{t}(t，S(t))dt+f_{x}(t，S(t))dS(t)+f_{xx}(t，S(t))dt=-r\mathrm{e}^{-rt}S(t)dt+\mathrm{e}^{-rt}dS(t) =-r\mathrm{e}^{-rt}S(t)dt+\mathrm{e}^{-rt}( \alpha S(t)dt+\sigma S(t)dW(t))=(\alpha-r)\mathrm{e}^{-rt}S(t)dt+\sigma\mathrm{e}^{-rt}S(t)dW(t)
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Similarly, the derivative of the discounted portfolio value $\mathrm{e}^{-rt} X(t)$ is given by&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{DiscountPort}
d( \mathrm{e}^{-rt}X(t) )=df(t，X(t))=f_{t}(t，X(t))dt+f_{x}(t，X(t))dX(t)+\frac{1}{2}f_{xx}(t，X(t))dt=-r\mathrm{e}^{-rt}X(t)dt+\mathrm{e}^{-rt}dX(t) =-r\mathrm{e}^{-rt}X(t)dt+\mathrm{e}^{-rt}( \Delta(t)dS(t)+r(X(t)-\Delta(t)S(t))dt)=\Delta(t)(\alpha-r)\mathrm{e}^{-rt}S(t)dt+\Delta(t)\sigma\mathrm{e}^{-rt}S(t)dW(t)=\Delta(t)d(\mathrm{e}^{-rt}S(t))．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;In this way, the formula \eqref{DiscountPort} is obtained by the discounted stock price $S(t)$ and the portfolio value $X(t)$ at the discount rate $\mathrm{e}^{-rt}$ with the interest rate $r$ of the money market account. The formula \eqref{DiscountPort} indicates that small change in the discount portfolio value $d(\mathrm{e}^{-rt}X(t))$ depends only on a small change in the discounted stock price $d(\mathrm{e}^{-rt}S(t))$.&lt;/p&gt;

&lt;p&gt;Consider a European call option where the payment on the maturity date $T$ is $(S(T)-K )^{+}$. Here, the strike price $K$ is assumed to be a non-negative constant.
Fischer Black, Myron Scholes and Robert Cox Merton argued that the value of European call option on maturity $T$ with payment $(S(T) -K )^{+}$ at any time $t$ depends on the length of time to maturity, the value of the stock price $S(t)$ at time $t$, the model parameters $r, \sigma$ and the strike price $K$.&lt;/p&gt;

&lt;p&gt;Since the model parameters $r, \sigma$ and the strike price $K$ are assumed to be constants, among the variables that affect the price evaluation of the European call option, only the time $t$ and the stock price $S(t)$ are  changed.&lt;/p&gt;

&lt;p&gt;Here, according to the inference of Fischer Black et al, let the value of the European call option be $c(t, x)$ when the stock price is $S(t) = x$ at time $t$. Since the stock price $S(t)$ follows the stochastic differential equation \eqref{stockPrice}, the value of the European call option is also stochastic.&lt;/p&gt;

&lt;p&gt;Therefore, the value of the European call option is the stochastic process $c(t, S(t))$ obtained by replacing the stochastic process $S(t)$ with the parameter $x$. At the initial time, the future stock price $S(t)$ is unknown because it is probabilistic, then the value $c(t, S(t))$ of the future European call option is also unknown. Therefore, if the function $c(t, x)$ is determined, the value of the future European call option $c(t, S(t))$ is expressed by the future stock price $S(t)$.&lt;/p&gt;

&lt;p&gt;To duplicate a portfolio which does full hedge the option sell position, it is required to fit the value of the duplicate portfolio $X(t)$ at any time $t\in[0, T]$ in the value of future European call options $c(t, S(t))$ starting with a certain initial fund of $X(0)$ and investing in the stock market and money market accounts.&lt;/p&gt;

&lt;p&gt;The necessary and sufficient conditions for constructing this replication portfolio are $\ mathrm{e}^{-rt}X(t)=\mathrm{e}^{-rt} c(t, S (t))$ for any time $t \in[0, T]$. To show that the necessary and sufficient conditions are met,&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{IsCopyPort}
d(\mathrm{e}^{-rt}X(t))=d(\mathrm{e}^{-rt}c(t，S(t)))，t\in[0，T)
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;And show that $X(0) = c(0, S(0))$ holds. In fact, the following equation is obtained by integrating the equation \eqref{IsCopyPort} from 0 to $t$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
\mathrm{e}^{-rt}X(t)-X(0)=\mathrm{e}^{-rt}c(t，S(t))-c(0，S(0))，t\in[0，T)
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;At this time, if $X(0)=c(0,S(0))$, then it is obtained the necessary and sufficient conditional expression $\mathrm{e}^{-rt}X(t)=\mathrm{e}^{-rt}c(t,S(t))$.&lt;/p&gt;

&lt;h2 id=&quot;necessary-and-sufficient-condition-to-duplicate-the-portfolio-which-does-fully-hedge-the-option-sell-position&quot;&gt;Necessary and sufficient condition to duplicate the portfolio, which does fully hedge the option sell position&lt;/h2&gt;

&lt;p&gt;To expand the right-hand side \eqref{IsCopyPort}, it is required to calculate the derivative of discount option price $\mathrm{e}^{-rt} c(t, S (t, S) t))$. To do this, it is needed to calculate the derivative of the option price $c(t, S(t))$. From Ito’s formula for the Ito process \eqref{ItoFormII} and the given stock price stochastic differential equation \eqref{stockPrice}&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
dc(t，S(t))=c_{t}(t，S(t))dt+c_{x}(t，S(t))dS(t)+\frac{1}{2}c_{xx}(t，S(t))(\sigma S(t))^{2}dt=c_{t}(t，S(t))dt+c_{x}(t，S(t))( \alpha S(t)dt+\sigma S(t)dW(t) )+\frac{1}{2}c_{xx}(t，S(t))(\sigma S(t))^{2}dt=( c_{t}(t，S(t))dt+\alpha c_{x}(t，S(t))+\frac{1}{2}\sigma^{2} S^{2}(t)c_{xx}(t，S(t)))dt+\sigma S(t)c_{x}(t，S(t))dW(t)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;It is calculated the derivative of discount option price $\mathrm{e}^{-rt} c (t)$ by Ito’s formula \eqref{ItoFormII} for the Ito process as $f(t, x)=\mathrm{e}^{-rt}x,S(t))$. In the following, it is used that $f_{t}(t,x)=-r\mathrm{e}^{-rt}x$, $f_{x}(t,x)=\mathrm{e}^{-rt}$, $f_{xx}(t,x)=0$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{expandCallDis}
d(\mathrm{e}^{-rt}c(t，S(t)))=df(t，c(t，S(t)))=f_{t}(t，c(t，S(t)))dt+f_{x}(t，c(t，S(t)))dc(t，S(t))+\frac{1}{2}f_{xx}(t，c(t，S(t)) (\sigma S(t)c_{x}(t，S(t)))^{2}dt=-r\mathrm{e}^{-rt}c(t，S(t))+\mathrm{e}^{-rt} dc(t，S(t))=\mathrm{e}^{-rt}(-rc(t，S(t))+c_{t}(t，S(t))+\alpha c_{x}(t，S(t))+\frac{1}{2}\sigma^{2} S^{2}(t)c_{xx}(t，S(t)))dt+\mathrm{e}^{-rt}\sigma S(t)c_{x}(t，S(t))dW(t)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;It is given the following equation to expand the right-hand side of \eqref{IsCopyPort} with the formula \eqref{expandCallDis} and the left-hand side with the formula \eqref{DiscountPort}.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{expandCopyPort}
\Delta(t)(\alpha-r)S(t)dt+\Delta(t)\sigma S(t)dW(t)=( -rc(t，S(t))+c_{t}(t，S(t))+\alpha c_{x}(t，S(t))+\frac{1}{2}\sigma^{2} S^{2}(t)c_{xx}(t，S(t)))dt+\sigma S(t)c_{x}(t，S(t))dW(t)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;If the expansion formula \eqref{expandCopyPort}, which is a necessary and sufficient condition for replicating a portfolio that completely hedges an option’s sell position, holds, the coefficients on both sides must be matched. Therefore, since the coefficients on both sides of $dW(t)$ are equal, the following equation is obtained.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{deltaHedging}
\Delta(t)=c_{x}(t，S(t))，t\in[0，T)
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;The number of shares held to fully hedge the option’s sell position at any time $t$ before maturity is the partial derivative of the option value at time $t$ with respect to the stock price $c_{x}(t, S(t))$. The relational expression \eqref{deltaHedging} of $\Delta(t)$ is called the delta-hedging rule because it is called the optional delta.&lt;/p&gt;

&lt;p&gt;Since the coefficients on both sides of $dt$ are also equal, the following equation holds for any time $t\in[0, T)$ from the relational expression \eqref{deltaHedging} of $\Delta(t)$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{expandCopyPortForT}
(\alpha-r)S(t)c_{x}(t，S(t))
=-rc(t，S(t))+c_{t}(t，S(t))+\alpha c_{x}(t，S(t))+\frac{1}{2}\sigma^{2} S^{2}(t)c_{xx}(t，S(t))
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Since $\alpha c_{x}(t,S(t))$ term appears on both sides of the expression \eqref{expandCopyPortForT} for any time $t\in[0, T)$, it is obtained the following equation to extract this term.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{PreBlackScholes}
rc(t，S(t))=c_{t}(t，S(t))+rS(t)c_{x}(t，S(t))+\frac{1}{2}\sigma^{2} S^{2}(t)c_{xx}(t，S(t))
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Here, if the value of the European call option when the stock price is $S(t) = x$ at time $t$ is $c(t, x)$, then it is obtained the partial differential equation of Black-Scholes from the equation \eqref{PreBlackScholes}.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{BlackScholes}
c_{t}(t，x)+rxc_{x}(t，x)\frac{1}{2}\sigma^{2} x^{2}c_{xx}(t，x)=rc(t，x)，t\in[0，T)，x\geq0
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;In addition to satisfying the equation \eqref{BlackScholes}, the function $c(t, x)$ must also satisfy the boundary conditions shown in the following equation.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{BoundaryCondtion}
c(T，x)=(x-K)^{+}，c(t，0)=0，\lim_{x \to \infty}[c(t，x)-(x-\mathrm{e}^{-r( T-t )}K)]=0
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;In fact, the first equation of the expression \eqref{BoundaryCondtion} follows from the definition of the European call option.&lt;/p&gt;

&lt;p&gt;The second equation is that when $x=0$ is substituted into the Black-Scholes partial differential equation \eqref{BlackScholes}, it is obtained the ordinary differential equation $c_{t}(t,0)=rc(t,0)$ for the function $c(t, 0)$ at time $t$ and then it is obtained its solution $c(t,0)=\mathrm{e}^{rt}$ is substituted $t=T$ for $c(0,0)$, which results in $c(T,0)=(0-K)^{+}=0$, $C(0,0)=0$.&lt;/p&gt;

&lt;p&gt;In the third equation, ‘Put/Call Parity’ holds because it is likely to end with ‘In the money’ for European call options for very large $x$ and the value of the forward contract is almost equal to $x-\mathrm{e}^{-r (Tt )}K$.&lt;/p&gt;

&lt;p&gt;In order to obtain an analytical solution of the Black-Scholes PDE \eqref{BlackScholes}, it is reduced by change of variables to a PDE whose exact solution is known. Therefore, two variables $u$ and $v$ are defined by the following equation, which are introduced for this purpose.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{val1}
u=\log \frac{x}{K}+(r-\frac{\sigma^{2}}{2})(T-t) 
v=T-t
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Here, using the variables $u$ and $v$ defined in the expression \eqref{val1}, the function $c(t, x)$ is converted into two functions $\mathrm{e}^{-rv}$ and $y (u, v )$ as shown in the following expression.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{val2}
c(t，x)=\mathrm{e}^{-rv}y(u，v)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Substituting the equation \eqref{val2} into the partial differential equation \eqref{BlackScholes} of Black-Scholes and rearranging it gives the following equation.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{HeatConductionEquation}
y_{u u}(u，v)-\frac{2}{\sigma^{2}}y_{v}(u，v)=0．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;The equation \eqref{HeatConductionEquation} is a known partial differential equation with an exact solution called the heat conduction equation. Here, the boundary condition is changed by variable transformation.&lt;/p&gt;

&lt;p&gt;$c(t，x)=$
$x-K\cdots x\geq K$
$0\cdots x \lt K$&lt;/p&gt;

&lt;p&gt;Note that the following conditions have changed.&lt;/p&gt;

&lt;p&gt;$y(u，0)=$
$K( \mathrm{e}^{u}-1 )\cdots u\geq 0$
$0\cdots u \lt 0$&lt;/p&gt;

&lt;p&gt;It is known that the heat conduction equation \eqref{HeatConductionEquation} is solved by the separation of variables method. The separation of variables method means that the solution $y(u,v)$ is expressed as the product of two functions $p(u)$ and $q(v)$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{val3}
y(u，v)=p(u)q(v)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Substituting the equation \eqref{val3} into the heat conduction equation \eqref{HeatConductionEquation} and rearranging it gives the following equation.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{SeparationVariables}
\frac{p_{u u}(u)}{p(u)}=\frac{2}{\sigma^{2}}\frac{q_{v}(v)}{q(v)}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Focusing on both sides of the obtained equation \eqref{SeparationVariables}, the left side is a function of only $u$ and the right side is a function of only $v$, then constants irrelevant to $u$ and $v$, which is $-k^{2}(0\leq k\lt \infty)$. Therefore, finding the solution of the heat conduction equation \eqref{HeatConductionEquation} results in the problem of solving the following two ordinary differential equations.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;$\dfrac{p_{u u}(u)}{p(u)}=-k^{2}$&lt;/li&gt;
  &lt;li&gt;$\dfrac{2}{\sigma^{2}}\dfrac{q_{v}(v)}{q(v)}=-k^{2}$&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The first equation is a second-order ordinary differential equation with constant coefficients, then if the coefficients are constants $C(k)$ and $D(k)$ with respect to constants $k$ irrelevant to $u$ and $v$, the solution is given by the following equation.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{ODE1Sol}
p(u)=C(k)\sin( ku ) +D(k)\cos( ku ) ．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Since the second equation is a variable separable ordinary differential equation, if the coefficients are the constant $E(k)$ for the constant $k$ irrelevant to $u$ and $v$, the solution is given by the following equation.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{ODE2Sol}
q(v)=E(k)\exp( -\frac{\sigma^{2}k^{2}}{2}v ) ．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Therefore, the solution $y (u, v )$ of the heat conduction equation \eqref{HeatConductionEquation} is a constant $k (0\leq k \lt \infty )$ irrelevant to $u$ and $v$. Then all are superposed to obtain the general solution shown in the following equation.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{HeatConductionEquationSol}
y(u，v)=\int_{0}^{+\infty}( C(k)\sin( ku ) +D(k)\cos( ku ) )\exp( -\frac{\sigma^{2}k^{2}}{2}v )dk．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Here, the coefficients $C(k)$ and $D(k)$ of the equation \eqref{HeatConductionEquationSol} are given by the following equation from Fourier’s integral theorem as $y(u,0)=g(a)$.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{FourierCoefficient}
C(k)=\frac{1}{\pi}\int_{-\infty}^{+\infty}g(a)\cos (ka) da
\end{eqnarray}
\begin{eqnarray}\label{FourierCoefficient2}
D(k)=\frac{1}{\pi}\int_{-\infty}^{+\infty}g(a)\sin (ka) da
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Substituting the obtained equation of coefficients \eqref{FourierCoefficient} and \eqref{FourierCoefficient2} into the solution \eqref{HeatConductionEquationSol} of the heat conduction equation \eqref{HeatConductionEquation} and rearranging it gives the following equation.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{HeatConductionEquationSol2}
y(u，v)=\dfrac{1}{\sigma \sqrt[]{\mathstrut 2 \pi v}} \int_{-\infty}^{+\infty}g(a)\exp( -\dfrac{1}{2}(\dfrac{a-u}{\sigma \sqrt[]{\mathstrut v}})^{2} ) da．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;For further analysis, the change of variables is performed again as follows. 
\begin{eqnarray}\label{}
w=\dfrac{a-u}{\sigma \sqrt[]{\mathstrut v}}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Note that the boundary conditions have changed to the following conditions due to the change of variables.&lt;/p&gt;

&lt;p&gt;$g(a)=g( u+\sigma \sqrt[]{\mathstrut v}w )=$&lt;/p&gt;

&lt;p&gt;$K( \mathrm{e}^{u+\sigma \sqrt[]{\mathstrut v}w}-1 )\cdots w\geq -\dfrac{u}{\sigma \sqrt[]{\mathstrut v}}$&lt;/p&gt;

&lt;p&gt;Or $0\cdots w \lt -\dfrac{u}{\sigma \sqrt[]{\mathstrut v}}$&lt;/p&gt;

&lt;p&gt;Focusing on the change of variables by $w$ and the changed boundary conditions, the equation \eqref{HeatConductionEquationSol2} is expanded as follows.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{HeatConductionEquationSol3}
y(u，v)=\dfrac{1}{\sqrt[]{\mathstrut 2 \pi}} \int_{-\dfrac{u}{\sigma \sqrt[]{\mathstrut v}}}^{+\infty}K( \exp(u+\sigma \sqrt[]{\mathstrut v}w)-1 )\exp( -\dfrac{w^{2}}{2} )dw
=\dfrac{1}{\sqrt[]{\mathstrut 2 \pi}} \int_{-\frac{u}{\sigma \sqrt[]{\mathstrut v}}}^{+\infty}K\exp(u+\sigma \sqrt[]{\mathstrut v}w-\dfrac{w^{2}}{2}) dw-\dfrac{1}{\sqrt[]{\mathstrut 2 \pi}} \int_{-\frac{u}{\sigma \sqrt[]{\mathstrut v}}}^{+\infty} K \exp(-\dfrac{w^{2}}{2})dw．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Furthermore, if the first term on the right side of the equation \eqref{HeatConductionEquationSol3} is replaced with $z = w- \sigma \sqrt[]{\mathstrut v}$ and the second term is replaced with $z = w$, the following equation is obtained.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label{HeatConductionEquationSol4}
y(u，v)=x\exp(rv) \dfrac{1}{ \sqrt[]{\mathstrut 2 \pi}} \int_{-\frac{u}{\sigma \sqrt[]{\mathstrut v}}^{+\infty}-\sigma \sqrt[]{\mathstrut v}}\exp( -\dfrac{z^{2}}{2} ) dz-K\dfrac{1}{ \sqrt[]{\mathstrut 2 \pi}} \int_{-\frac{u}{\sigma \sqrt[]{\mathstrut v}}}^{+\infty}\exp( -\dfrac{z^{2}}{2} ) dz
=x\exp(rv)N(\frac{u}{\sigma \sqrt[]{\mathstrut v}}+\sigma \sqrt[]{\mathstrut v})-KN( \frac{u}{\sigma \sqrt[]{\mathstrut v}})．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Finally, by substituting the obtained equation \eqref{HeatConductionEquationSol4} into the solution of the Black-Scholes PDE \eqref{val2} is obtained as an analytical solution of the Black-Scholes PDE, which is a function that satisfies the Black-Scholes PDE.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}\label
c(t，x)=xN(\frac{u}{\sigma \sqrt[]{\mathstrut v}} + \sigma \sqrt[]{\mathstrut v} ) -K \exp(-rv)N(\frac{u}{\sigma \sqrt[]{\mathstrut v}})
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;However,&lt;/p&gt;

&lt;p&gt;$u=\log \frac{x}{K}+(r-\frac{\sigma^{2}}{2})(T-t)$&lt;/p&gt;

&lt;p&gt;$v=T-t$&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Shreve, S., 2004. Stochastic Calculus for Finance II: Continuous-Time Models&lt;/li&gt;
  &lt;li&gt;Ishimura, S., 2008. Black Shoals differential equations for finance and securities (In Japanese)&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Thu, 03 Jun 2021 00:00:00 +0900</pubDate>
        <link>https://kyo1988.github.io/business/finance/2021/06/03/derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory.html</link>
        <guid isPermaLink="true">https://kyo1988.github.io/business/finance/2021/06/03/derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory.html</guid>
        
        <category>Business Finance</category>
        
        
        <category>Business</category>
        
        <category>Finance</category>
        
      </item>
    
      <item>
        <title>Derivation of yield curve construction formula with tenor basis spread</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#derivation-of-yield-curve-construction-formula-with-tenor-basis-spread&quot; id=&quot;markdown-toc-derivation-of-yield-curve-construction-formula-with-tenor-basis-spread&quot;&gt;Derivation of yield curve construction formula with tenor basis spread&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#reference&quot; id=&quot;markdown-toc-reference&quot;&gt;Reference&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;derivation-of-yield-curve-construction-formula-with-tenor-basis-spread&quot;&gt;Derivation of yield curve construction formula with tenor basis spread&lt;/h1&gt;

&lt;p&gt;If LIBOR is truly risk-free, the swap of 3-month LIBOR and 6-month LIBOR should be tradable with zero spread. However, LIBOR takes into account the credit risk of banks, and tenor swaps are exactly the transactions that swap the risk of 3-month LIBOR and 6-month LIBOR. After the financial crisis, the risk of bankruptcy, that is, the difference in tenor, was conscious, and when swap 3-month LIBOR and 6-month LIBOR, the 3-month LIBOR side began to trade with a non-negligible spread.&lt;/p&gt;

&lt;p&gt;After all, after supplementing the discount factor and tenor spread in 0.25 year increments, the future 3-month LIBOR can be calculated as follows (Nakahara, 2013).&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
L_{forward}^{3MWorld}(t,t_{i},t_{i+0.25})=\frac{1-DF(t,t_{i+0.25})-TS^{3M-6M}(t,t_{i+0.25})\times\sum_{j=1}^{4i+1}{DF(t,t_{\frac{j}{4}})\times\frac{1}{4}}}{DF(t,t_{i+0.25})\times\frac{1}{4}}+\frac{-\sum_{j=1}^{4i}{L_{forward}^{3MWorld}(t,t_{\frac{j-1}{4}},t_{\frac{j}{4}})\times DF(t,t_{\frac{j}{4}})\times\frac{1}{4}}}{DF(t,t_{i+0.25})\times\frac{1}{4}}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;However,&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;$L(t,T)$: Observable LIBOR at time point $t$ maturity $T$&lt;/li&gt;
  &lt;li&gt;$L_{forward}^{3MWorld}(t,t_{0},t_{0.25})=L(t,t_{0.25})$&lt;/li&gt;
  &lt;li&gt;$L_{forward}^{3MWorld}(t,t_{i},t_{i+0.25})$: A 3-month LIBOR with a reset date of $t_{i}$ and a maturity of $t_{i+0.25}$ as seen from the point in time $t$&lt;/li&gt;
  &lt;li&gt;$TS^{3M-6M}(t,T)$: Tenor spread when swapping 6-month LIBOR for 3-month LIBOR at time $t$ and maturity $T$&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In this article, we try to derive the equation (1). 
At this time, the evaluation formula of the JPY tenor swap is expressed as follows (Takahashi, 2010)．&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
\sum_{n=1}^{N}\delta_{n}(E_{t}[L(T_{n-1},T_{n}+\tau_{N}]P_{t,T_{n}})=\sum_{m=1}^{M}\delta_{m}E_{t}[L(T_{m-1},T_{m}]P_{t,T_{m}}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;However,&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;$N=2M$&lt;/li&gt;
  &lt;li&gt;$L(T_{n-1},T_{n})$: LIBOR with a reset date of $T_{n-1}$ and a maturity of $T_{n}$&lt;/li&gt;
  &lt;li&gt;$P_{t,T_{n}}$: Zero coupon bond price with maturity of $t$ at time $ T_{n}$&lt;/li&gt;
  &lt;li&gt;$\delta_{n}$: Interest calculation period&lt;/li&gt;
  &lt;li&gt;$\tau_{N}$: Tenor spread when swapping 6-month LIBOR for 3-month LIBOR at time $t$ and maturity of $T (= T_{N} = T_{M})$&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Now, we want to derive 3 months LIBOR, that is, $E_{t}[L(T_{N-1}, T_{N}]$, therefore expand the left side of the expression (2) as follows.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
\sum_{n=1}^{N}\delta_{n}(E_{t}[L(T_{n-1},T_{n}+\tau_{N}]P_{t,T_{n}})=\sum_{n=1}^{N-1}\delta_{n}(E_{t}[L(T_{n-1},T_{n})]P_{t,T_{n}}+\delta_{N}E_{t}[L(T_{N-1},T_{N})]P_{t,T_{N}}+\sum_{n=1}^{N}\delta_{n}\tau_{N}P_{t,T_{n}}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;On the other hand, the relationship between Libor and the discount rate is&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
E_{t}[L(T_{m-1},T_{m})]=\frac{1}{\delta_{n}}\left(\frac{P_{t,T_{m-1}}}{P_{t,T_{n}}}-1\right)．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;Since it is represented by, the left side of the expression \label{tenor} can be expanded as follows.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
\sum_{m=1}^{M}\delta_{m}E_{t}[L(T_{m-1},T_{m}]P_{t,T_{m}}=P_{t,T_{0}}-P_{t,T_{M}}=1-P_{t,T_{M}}．
\end{eqnarray}&lt;/p&gt;

&lt;p&gt;After all, JPY 3 months LIBOR, ie $E_{t} [L(T_{N-1},T_{N}]$, is given below.&lt;/p&gt;

&lt;p&gt;\begin{eqnarray}
E_{t}[L(T_{N-1},T_{N}]=\frac{1-P_{t,T_{M}}-\sum_{n=1}^{N}\delta_{n}\tau_{N}P_{t,T_{n}}}{\delta_{N}P_{t,T_{N}}}+\frac{-\sum_{n=1}^{N-1}\delta_{n}(E_{t}[L(T_{n-1},T_{n})]P_{t,T_{n}}}{\delta_{N}P_{t,T_{N}}}．
\end{eqnarray}&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Nakahara, G.，2013. LIBOR and OIS discount that can be seen in EXCEL (In Japanese)&lt;/li&gt;
  &lt;li&gt;Fujii, M.，Shimada, Y. and Takahashi, A.，2010. “A Note on Construction of Multiple Swap Curves with and without Collateral”， FSA Research Review Vol.6(March 2010)．&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Mon, 31 May 2021 00:00:00 +0900</pubDate>
        <link>https://kyo1988.github.io/business/finance/2021/05/31/derivation-of-yield-curve-construction-formula-with-tenor-basis-spread.html</link>
        <guid isPermaLink="true">https://kyo1988.github.io/business/finance/2021/05/31/derivation-of-yield-curve-construction-formula-with-tenor-basis-spread.html</guid>
        
        <category>Business Finance</category>
        
        
        <category>Business</category>
        
        <category>Finance</category>
        
      </item>
    
  </channel>
</rss>
