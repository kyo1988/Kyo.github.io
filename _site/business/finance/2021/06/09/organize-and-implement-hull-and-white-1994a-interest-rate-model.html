<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width initial-scale=1">
<meta property="og:title" content="Organize and implement Hull and White (1994a) interest rate model">

<title>Organize and implement Hull and White (1994a) interest rate model</title>
<meta property="og:description" content="This is a modified version of the report for semminar at a financial consulting firm in 2018.">
<meta property="og:url" content="https://kyo1988.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html">
<meta property="og:site_name" content="Kyo Harada — Visage AI / Data Scientist">
<meta property="og:locale" content="ja_JP">

<meta property="article:author" content="https://www.linkedin.com/in/KyoHarada" />

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@kyoHarada">
<meta name="twitter:creator" content="@kyoHarada">
<meta name="twitter:title" content="Organize and implement Hull and White (1994a) interest rate model">
<meta name="twitter:description" content="This is a modified version of the report for semminar at a financial consulting firm in 2018.">
<meta name="twitter:url" content="https://kyo1988.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html">

<meta name="keywords" content="Data Scientist, AI, CoreML, Finance, EDINET, RAG, LLM, Consulting">

<meta name="google-site-verification" content="kZFzSU3m_vE_Y0Ja60lWjUOKkeGpV7Ch3CvfLeP8Di4" />

<link rel="icon" href="/Kyo.github.io/images/IMG_0168.ico">
<link rel="stylesheet" href="/Kyo.github.io/css/main.css">
<link rel="canonical" href="https://kyo1988.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html">
<link rel="alternate" type="application/atom+xml" title="Kyo Harada — Visage AI / Data Scientist" href="https://kyo1988.github.io/feed.xml" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<script async defer src="//assets.pinterest.com/js/pinit.js"></script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T222J2Q');</script>
<!-- End Google Tag Manager -->

</head>
<!-- <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-196500796-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-196500796-1');
</script> -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    },
    CommonHTML: { matchFontHeight: false },
    displayAlign: "left",
    displayIndent: "2em",
    TeX: {
      equationNumbers: { autoNumber: "AMS" },
    }
  });
</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS_CHTML"></script>
<!-- <link type="application/atom+xml" rel="alternate" href="https://kyo1988.github.io/Kyo.github.io/atom.xml" title="Kyo Harada — Visage AI / Data Scientist" /> -->
<!-- <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Organize and implement Hull and White (1994a) interest rate model | Kyo Harada — Visage AI / Data Scientist</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Organize and implement Hull and White (1994a) interest rate model" />
<meta name="author" content="Kyo Harada" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="This is a modified version of the report for semminar at a financial consulting firm in 2018." />
<meta property="og:description" content="This is a modified version of the report for semminar at a financial consulting firm in 2018." />
<link rel="canonical" href="https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html" />
<meta property="og:url" content="https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html" />
<meta property="og:site_name" content="Kyo Harada — Visage AI / Data Scientist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-09T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Organize and implement Hull and White (1994a) interest rate model" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kyo Harada"},"dateModified":"2021-06-09T00:00:00+09:00","datePublished":"2021-06-09T00:00:00+09:00","description":"This is a modified version of the report for semminar at a financial consulting firm in 2018.","headline":"Organize and implement Hull and White (1994a) interest rate model","mainEntityOfPage":{"@type":"WebPage","@id":"https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html"},"url":"https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html"}</script>
<!-- End Jekyll SEO tag -->
 -->

<body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T222J2Q"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="container">

  <header class="site-header">

  <div class="wrapper">

    <h1 class="site-title"><a href="/Kyo.github.io">Kyo Harada — Visage AI / Data Scientist</a></h1>
    <h3 class="site-meta">Founder & Data Scientist building on-device AI for skin analytics and finance-grade data products.</h3>

    <nav class="site-nav">
<!--       <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a> -->
      <div class="trigger">
        
        
        <a class="page-link" href="/Kyo.github.io/">Home</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/about/">About</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/about/">About</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/archives/">Archives</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/case-studies/">Case Studies</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/categories/">Categories</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/tags/">Tags</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/guestbook/">Guestbook</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/xml/feed.xml">Subscribe</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/DataScience/">DataScience</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/visualization/">Visualization</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/marketing/">Marketing</a>
        
        
        
        
        
        <a class="page-link" href="/Kyo.github.io/Investment/">Investment</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/Travel/">Travel</a>
        
        
        
        
        
        <a class="page-link" href="/Kyo.github.io/newsletter/">Newsletter</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/press-kit/">Press Kit</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/xml/sitemap.xml">Sitemap</a>
        
        
        
        <a class="page-link" href="/Kyo.github.io/work-with-me/">Work with me</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </div>
    </nav>

  </div>

</header>


  

  <div class="page-content">
    <div class="wrapper">
      <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Organize and implement Hull and White (1994a) interest rate model | Kyo Harada — Visage AI / Data Scientist</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Organize and implement Hull and White (1994a) interest rate model" />
<meta name="author" content="Kyo Harada" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="This is a modified version of the report for semminar at a financial consulting firm in 2018." />
<meta property="og:description" content="This is a modified version of the report for semminar at a financial consulting firm in 2018." />
<link rel="canonical" href="https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html" />
<meta property="og:url" content="https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html" />
<meta property="og:site_name" content="Kyo Harada — Visage AI / Data Scientist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-09T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Organize and implement Hull and White (1994a) interest rate model" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kyo Harada"},"dateModified":"2021-06-09T00:00:00+09:00","datePublished":"2021-06-09T00:00:00+09:00","description":"This is a modified version of the report for semminar at a financial consulting firm in 2018.","headline":"Organize and implement Hull and White (1994a) interest rate model","mainEntityOfPage":{"@type":"WebPage","@id":"https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html"},"url":"https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html"}</script>
<!-- End Jekyll SEO tag -->



<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Organize and implement Hull and White (1994a) interest rate model",
  "description": "",
  "datePublished": "2021-06-09T00:00:00+0900",
  "dateModified": "2021-06-09T00:00:00+0900",
  "author": {
    "@type": "Person",
    "name": "Kyo Harada",
    "sameAs": [
      "https://github.com/kyo1988",
      "https://www.visageaiconsulting.com/",
      "https://www.linkedin.com/in/KyoHarada"
    ]
  },
  "publisher": {
    "@type": "Organization",
    "name": "Visage AI Consulting"
  },
  "mainEntityOfPage": {"@type":"WebPage","@id":"https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html"}
}
</script>

<div class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 itemprop="name" class="post-title">Organize and implement Hull and White (1994a) interest rate model</h1>
    <meta itemprop="keywords" content="Business Finance" />
    <p class="post-meta">
    Posted in
    
    <a href="/Kyo.github.io/categories/#Business">Business</a>, 
    
    <a href="/Kyo.github.io/categories/#Finance">Finance</a>
    
    
    and tagged
    
    <a href="/Kyo.github.io/tags/#Business Finance" title="Business Finance">Business Finance</a>
    
    
    <time itemprop="datePublished" datetime="2021-06-09">
    on Jun 9, 2021
    </time>
    </p>
  </header>

  <article class="post-content" itemprop="articleBody">
    <ul id="markdown-toc">
  <li><a href="#organize-and-implement-hull-and-white-1994a-interest-rate-model" id="markdown-toc-organize-and-implement-hull-and-white-1994a-interest-rate-model">Organize and implement Hull and White (1994a) interest rate model</a>    <ul>
      <li><a href="#derivation-of-hull-and-white-1994a-interest-rate-model-solutions-and-boundary-conditions" id="markdown-toc-derivation-of-hull-and-white-1994a-interest-rate-model-solutions-and-boundary-conditions">Derivation of Hull and White (1994a) interest rate model solutions and boundary conditions</a></li>
      <li><a href="#hull-and-white-tree-formulation" id="markdown-toc-hull-and-white-tree-formulation">Hull and White Tree formulation</a></li>
      <li><a href="#hull-and-white-tree-implementation" id="markdown-toc-hull-and-white-tree-implementation">Hull and White Tree Implementation</a></li>
      <li><a href="#reference" id="markdown-toc-reference">Reference</a></li>
    </ul>
  </li>
</ul>

<h1 id="organize-and-implement-hull-and-white-1994a-interest-rate-model">Organize and implement Hull and White (1994a) interest rate model</h1>
<h2 id="derivation-of-hull-and-white-1994a-interest-rate-model-solutions-and-boundary-conditions">Derivation of Hull and White (1994a) interest rate model solutions and boundary conditions</h2>

<ul>
  <li>Definition [Hull and White(1994a) interest rate model]
\begin{eqnarray}\label{HullandWhite1994a}
dr(t)=(\theta(t)-ar(t))dt+\sigma d\tilde{W}(t) ．
\end{eqnarray}</li>
</ul>

<p>However, $\tilde{W}(t)$ is Brownian motion under the risk-neutral measure $\mathbb{P}$.
Also, $\theta (t)$, $a$, and $\sigma$ are positive-definite functions for time (Hull and White, 1994a).</p>

<ul>
  <li>Definition [Discount bond price evaluation formula]
\begin{eqnarray}\label{DiscountBondPrice}
B(t,T)=\tilde{\mathbb{E}}[e^{-\int_{t}^{T}R(s)ds}|{\cal F}(t)] ．
\end{eqnarray}</li>
</ul>

<p>Here, a discount bond is a contract in which $1$ is paid for a certain fixed maturity of $T$, and no payment is made before the maturity.</p>

<ul>
  <li>Definition [Yield from time $t$ to $T$]
\begin{eqnarray}
Y(t,T)=-\frac{1}{T-t}\log B(t,T)．
\end{eqnarray}</li>
</ul>

<p>This is equivalent to the following equation.</p>

<p>\begin{eqnarray}
B(t,T)=e^{-Y(t,T)(T-t)}．
\end{eqnarray}</p>

<p>Therefore, $B(T, T) =1$.</p>

<p>The random variable $e^{-\int_{t}^{T}R(s)ds}$ estimated in the equation \eqref{DiscountBondPrice} depends not only on $R(T)$ but also on the path. However, the path of $R$ to time $t$ depends only on $R(t)$ at time $t$. Therefore, since $R$ is a Markov process, the bond price $B(t, T)$ is considered to be a function of time $t$ and $R(t)$.</p>

<p>\begin{eqnarray}
B(t,T)=f(t,R(t))．
\end{eqnarray}</p>

<p>On the other hand, since the equation \eqref{DiscountBondPrice} is the expansion of $D(t)B(t,T)=\tilde{\Bbb{E}}[D(T)B(T,T))\lvert\cal{F}(t)]$, then $D(t)B(t,T)=D(t)f(t,T)$ is a martingale.</p>

<p>Therefore, in order for the no arbitrage condition to hold, the drift $(dt)$ term obtained by differentiating $D(t)f(t,T)$ must appear as $0$.</p>

<p>To find the derivative of $D(t)f(t,T)$, it is required first to find the discount process and its relational expression.</p>

<ul>
  <li>Definition [discount process]
\begin{eqnarray}
D(t)=e^{-\int_{0}^{t}R(s)ds}．
\end{eqnarray}</li>
</ul>

<p>Here, if $S(x)=e(-t)$ and $I(t)=\int_{0}^{t}R(s)ds$, then $D(t) = S(I(t))$.
At this time, since $dI(t)=R(t)dt$, $dI(t)dI (t)=0$ and $S’(x)=-S (x)$, $S’‘(x) =S(x)$ then from Ito’s lemma,</p>

<p>\begin{eqnarray}
dD(t)=dS(I(t)) 
=S’(I(t))dI(t)+\frac{1}{2}S’‘(I(t))dI(t)dI(t) 
=-S(I(t))dI(t) 
=-D(t)R(t)dt．
\end{eqnarray}</p>

<p>therefore,</p>

<p>\begin{eqnarray}
dD(t)=-D(t)R(t)dt．
\end{eqnarray}</p>

<p>If the interest rate process $R(t)$ in finding the derivative of $D(t)f(t,T)$ follows the equation \eqref{HullandWhite1994a}, then From $dtdt=0$, $dtd\tilde{W}=0$, $d\tilde{W}d\tilde{W}=dt$ and $drdr= \sigma^2dt$</p>

<p>\begin{eqnarray}
d(D(t)f(t,T))
=f(t,T)dD(t)+D(t)df(t,T)
=f(t,T)(-D(t)R(t))+D(t){f_t(t,T)dt+f_r(t,T)dr+\frac{1}{2}f_rr(t,T)drdr} 
=D(t)(-rf(t,T)+f_t(t,T)+\frac{1}{2}\sigma^2 f_rr(t,T)+(\theta(t)-ar(t))f_r(t,T))dt+D(t)\sigma f_r(t,T)d\tilde{W}(t)．
\end{eqnarray}</p>

<p>Therefore, $f(t, T))$ must be met.</p>

<p>\begin{eqnarray}\label{HullWhitePDE}
f_t(t,T)+\frac{1}{2}\sigma^{2} f_rr(t,T)+(\theta(t)-ar(t))f_r(t,T)=rf(t,T)
\end{eqnarray}</p>

<p>Also, since $1=B(T, T)=f(T, r)$, the terminal condition is obtained.</p>

<p>For all $r$,
\begin{eqnarray}
f(T,r)=1
\end{eqnarray}</p>

<p>Next, the partial differential equation of the equation \eqref{HullWhitePDE} is expanded to obtain an analytical solution.
If you set $f_t(t, T)=e^{-rC (t, T) -A (t, T)}$,</p>

<p>\begin{eqnarray}
f_t(t,r)=(-rC’(t,T)-A’(t,T))f(t,r)． 
f_r(t,r)=-C(t,T)f(t,r)． 
f_rr(t,r)=-C^{2}(t,T)f(t,r)．
\end{eqnarray}</p>

<p>Where $C’(t,T)=\frac{\partial C(t,T)}{\partial t}$，$A’(t,T)=\frac{\partial A(t,T)}{\partial t}$．
Therefore, the left side of the formula \eqref{HullWhitePDE} is</p>

<p>\begin{eqnarray}
f_t(t,T)+\frac{1}{2}\sigma f_rr(t,T)+(\theta(t)-ar(t))f_r(t,T) 
=(-rC’(t,T)-A’(t,T)+\frac{1}{2}\sigma^{2}C^{2}(t,T)-(\theta(t)-ar(t))C(t,T))f(t,r)．
\end{eqnarray}</p>

<p>Therefore, by transposing the right side to the left side and enclosing it with $r$, the following relational expression is obtained.</p>

<p>\begin{eqnarray}
((-C’(t,T)+aC(t,T)-1)r-A’(t,T)-\theta(t)C(t,T)+\frac{1}{2}\sigma^{2}C^{2}(t,T))f(t,r)=0．
\end{eqnarray}</p>

<p>From the assumption, $f_t(t, T)=e^{-rC(t, T)-A(t, T)}&gt;0$, and this relation must hold for all $r$, then this term for $r$ must be $0$.</p>

<p>\begin{eqnarray}
C’(t,T)=aC(t,T)-1．
A’(t,T)=-\theta(t)C(t,T)+\frac{1}{2}\sigma^{2}C^{2}(t,T)．
\end{eqnarray}</p>

<p>Furthermore, $C(T, T)=A’(T, T)=A(T, T)=0$ is required to hold for the terminal condition.</p>

<p>A function that satisfies $C’(t, T)=aC(t, T)-1$, $C(T, T)=0$</p>

<p>\begin{eqnarray}
C(t,T)=\int_{t}^{T}e^{-\int_{t}^{s}a(v)dv}ds．
\end{eqnarray}</p>

<p>It is shown that this is a unique solution to be obtained.</p>

<p>\begin{eqnarray}
\frac{d }{d s}(e^{-\int_{0}^{s}a(v)dv} C(s,T))
=e^{-\int_{0}^{s}a(v)dv}(-a(s)C(s,T)+C’(s,T) ) 
=e^{-\int_{0}^{s}a(v)dv}(-a(s)C(s,T)+aC(t,T)-1 ) 
=e^{-\int_{0}^{s}a(v)dv}．
\end{eqnarray}</p>

<p>Integrating both sides of this equation from $t$ to $T$</p>

<p>\begin{eqnarray}
e^{-\int_{0}^{T}a(v)dv}C(T,T)-e^{-\int_{0}^{t}a(v)dv}C(t,T)=-\int_{t}^{T}e^{-\int_{0}^{s}a(v)dv}ds 
\Leftrightarrow C(t,T)=e^{\int_{0}^{t}a(v)dv}\int_{t}^{T}e^{-\int_{0}^{s}a(v)dv}ds<br />
=\int_{t}^{T}e^{-\int_{t}^{s}a(v)dv}ds．
\end{eqnarray}</p>

<p>The expansion of this unique solution is as follows. However, $a(v)=a$ is set from the equation \eqref{HullandWhite1994a}.</p>

<p>\begin{eqnarray}
C(t,T)=\int_{t}^{T}e^{-\int_{t}^{s}a(v)dv}ds 
=\int_{t}^{T}e^{-as+at}ds 
=\frac{1}{a}(1-e^{-a(T-t)})．
\end{eqnarray}</p>

<p>Similarly, the function, that satisfies $A(T, T)=1$, $A’(t, T)=-\theta(t)C(t, T)+\frac{1}{2}\sigma^{2}C^{2}(t, T)$, is shown below as a unique solution.</p>

<p>\begin{eqnarray}
A(t,T)=\int_{t}^{T}(\theta(t)C(t,T)-\frac{1}{2}\sigma^{2}C^{2}(t,T) )ds．
\end{eqnarray}</p>

<p>Integrating both sides of this equation from $t$ to $T$
\begin{eqnarray}
A(T,T)-A(t,T)=-\int_{t}^{T}\theta(t)C(t,T)ds+\frac{1}{2}\int_{t}^{T}\sigma^{2}C^{2}(t,T)ds 
\Leftrightarrow A(t,T)=\int_{t}^{T}(\theta(t)C(t,T)-\frac{1}{2}\sigma^{2}C^{2}(t,T))ds．
\end{eqnarray}</p>

<p>The expansion of this unique solution is as follows. However, $a(v)=a$ is set from the equation \eqref{HullandWhite1994a}.</p>

<p>\begin{eqnarray}
A(t,T)=\int_{t}^{T}(\theta(t)C(t,T)-\frac{1}{2}\sigma^{2}C^{2}(t,T) )ds 
=\int_{t}^{T}(\frac{\theta(t)}{a}(1-e^{-a(T-t)})-\frac{1}{2}\sigma^{2}\frac{1}{a^2}(1-e^{-a(T-t)} )^{2} )ds 
=\frac{\sigma^{2}}{2a^3}(-a(T-t)+2(1-e^{-a(T-t)})-\frac{1}{2}(1-e^{-2a(T-t)})) 
+\frac{1}{a}\int_{t}^{T}\theta(s)(1-e^{-a(T-s)})ds．
\end{eqnarray}</p>

<p>Next, the parameter $\theta(t)$ in the equation \eqref{HullandWhite1994a} means the speed of mean reversion. It is required to match this parameter to the term structure of the quoted interest rate.</p>

<ul>
  <li>Definition [Instantaneous Forward Rate]
Let $f^{M}(0, T)$ be the instantaneous forward rate of the market at maturity $T$ at time $0$.
\begin{eqnarray}
f^{M}(0,T)=-\frac{\partial \ln B^{M}(0,T)}{\partial T}．
\end{eqnarray}
Here, $B^{M}(0, T)$ is the discount bond price quoted in the market at maturity $T$.</li>
</ul>

<p>Because it is $B(t,T)=f(t,r)=e^{-rC(t,T)-A(t,T)}$，</p>

<p>\begin{eqnarray}
\ln B(0,T)=-rC(0,T)-A(0,T) 
=-\frac{r}{a}(1-e^{-aT} ) 
-\frac{\sigma^{2}}{2a^3}(-aT+2(1-e^{-aT})-\frac{1}{2}(1-e^{-2aT})) 
+\frac{1}{a}\int_{0}^{T}\theta(s)(1-e^{-a(T-s)})ds 
\Leftrightarrow \frac{\partial \ln B^{M}(0,T)}{\partial T}=re^{-aT}+\frac{\sigma^{2}}{2a^3}(-a+2ae^{-aT}+e^{-2aT})+\int_{t}^{T}\theta(s)e^{-a(T-s)}ds 
\Leftrightarrow f^{M}(0,T)=re^{-aT}+\frac{\sigma^{2}}{2a^3}(-a+2ae^{-aT}+e^{-2aT})+\int_{t}^{T}\theta(s)e^{-a(T-s)}ds．
\end{eqnarray}</p>

<p>The following relationship is used to derive $\theta(T)$ from $f^{M}(0, T)$.</p>

<p>\begin{eqnarray}
H(t)=\int_{0}^{t}h(s,t)dsarrow H’(t)=\int_{0}^{t}\frac{\partial h(s,t)}{\partial t}ds+h(t,t)．
\end{eqnarray}</p>

<p>Here, $x(t)=re^{-at}+\int_{0}^{t}\theta(s)e^{-a(t-s)}ds$</p>

<p>\begin{eqnarray}
x’(t)=-a(re^{-at}+\int_{0}^{t}\theta(s)e^{-a(t-s)}ds)+\theta(t) 
x’(t)=-ax(t)+\theta(t) 
\Leftrightarrow \theta(t)=x’(t)+ax(t) 
arrow \theta(T)=x’(T)+ax(T)．
\end{eqnarray}</p>

<p>On the other hand, if it is set $g(t)=\frac{\sigma^2}{2a^2}(-1+2e^{-at}+e^{-2at})$</p>

<p>\begin{eqnarray}
f^{M}(0,T)=x(T)+g(T) 
\Leftrightarrow x(T)=f^{M}(0,T)-g(T)．
\end{eqnarray}</p>

<p>Therefore 
\begin{eqnarray}
\theta(T)=\frac{\partial f^{M}(0,T)}{\partial T}-\frac{\partial g(T)}{\partial T}+ax(t)．
\end{eqnarray}</p>

<p>Here, since it is $\frac{\partial g(T)}{\partial T}=-\frac{\sigma^2}{a}(e^{-aT}+e^{-2aT})$, the following equation is obtained after all.</p>

<p>\begin{eqnarray}
\theta(T)=\frac{\partial f^{M}(0,T)}{\partial T}+\frac{\sigma^2}{a}(e^{-aT}+e^{-2aT})+af^{M}(0,T)-\frac{\sigma^2}{2a^2}(-1+2e^{-at}+e^{-2at})．
\end{eqnarray}</p>

<h2 id="hull-and-white-tree-formulation">Hull and White Tree formulation</h2>

<p>In the following, to represent the interest rate model as the $3$ term tree, it is derived the relational expression between the parameters of the continuous time process and the parameters of the $3$ term process.</p>

<p>In the $3$ term process, it is expressed by $p_u$, $p_m$, and $p_d$, respectively, during the minute time $\Delta t$ as the interest rate rises by the spatial division width $\Delta x$, or stays at the same level, decreasing by $\Delta x$.</p>

<p>Furthermore, $\Delta t$ and $\Delta x$ cannot be selected independently and must satisfy the conditions for stability and convergence of the finite difference method $\Delta x=\sigma \sqrt{3\Delta t}$ (Hull and White, 1994).</p>

<p>Here, if the drift term of the formula \eqref{HullandWhite1994a} is set $\nu=\theta(t)-ar(t)$,</p>

<p>\begin{eqnarray}\label{averrageA}
\mathbb{E}[\Delta x]=p_u(\Delta x)+p_m(0)+p_d(-\Delta x)=\nu\Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceA}
\mathbb{E}[\Delta x^2]=p_u(\Delta x^2)+p_m(0)+p_d(-\Delta x^2)=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}
\begin{eqnarray}\label{SumProA}
p_u+p_m+p_d=1．
\end{eqnarray}</p>

<p>The expression \eqref{averrageA} and the expression \eqref{varianceA} are expanded as follows.</p>

<p>\begin{eqnarray}\label{averrageAA}
p_u\Delta x-p_d\Delta x=\nu \Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceAA}
p_u\Delta x^2-p_d\Delta x^2=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}</p>

<p>Multiply the expression \eqref{averrageAA} by $\Delta x$ and add the expression \eqref{varianceAA},</p>

<p>\begin{eqnarray}\label{puA}
2p_u\Delta x^2=\nu^2\Delta t^2+\sigma^2\Delta t+\nu \Delta t\Delta x 
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )．
\end{eqnarray}</p>

<p>Also, substituting the expression \eqref{puA} into the expression \eqref{averrageAA},</p>

<p>\begin{eqnarray}
p_u\Delta x-p_d\Delta x=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )\Delta x-p_d\Delta x 
\Leftrightarrow p_d\Delta x=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )\Delta x<br />
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )．
\end{eqnarray}</p>

<p>And if it is substituted the expression \eqref{puA} and the expression \eqref{puA} into the expression \eqref{SumProA}</p>

<p>\begin{eqnarray}\label{pmA}
p_u+p_m+p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )+p_m+\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} ) 
=\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+p_m 
\Leftrightarrow p_m=1-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}．
\end{eqnarray}</p>

<p>Hull And White (1994a) proposed a method for constructing an efficient and accurate short rate for the equation \eqref{HullandWhite1994a}. Also, it is assumed $\theta(t)=0$，$r(0)=0$.</p>

<p>\begin{eqnarray}
dr(t)=ar(t)dt+\sigma d\tilde{W}(t) ．
\end{eqnarray}</p>

<p>Therefore, note that $\nu=-ar$. In this simplified tree, the value of $r$ at the time $i\Delta t$ is $j\Delta t$. Since the tree is designed to reduce the amount of calculation, $j$ needs to be between $BottomNode[i]$ and $TopNode[i]$. The choice of which branching process to take at each node depends on the sign of $a$ and the size of $j$, and the range of change $\Delta x(=\Delta r)$ in the simplified $r$ process is chosen to match the expected value of $\mathbb{E}[\Delta x]$ and the variance $Var(\Delta x)$. Furthermore, when $a$ is positive, if $M$ is the expected value of the fluctuation range, when $j$ is the smallest integer larger than $-0.184/M$, the standard branching process is switched to the downward branching process. In order to maintain the symmetry, HW proposes to switch from the standard branching process to the upward branching process in the node $j$ with a negative sign for this node (Hull and White, 1994).</p>

<p>Here，
\begin{eqnarray}
\mathbb{E}[\Delta x]=\nu \Delta t 
=-ar\Delta t 
=Mr 
\Leftrightarrow M=-a\Delta t．
\end{eqnarray}</p>

<p>Also，
\begin{eqnarray}
Var(\Delta x)=\mathbb{E}[\Delta x^2]-(\mathbb{E}[\Delta x])^2 
=(\nu^2\Delta t^2+\sigma^2\Delta t)-(\nu \Delta t)^2 
=\sigma^2\Delta t．
\end{eqnarray}
It becomes. Here,$M^2=a^2\Delta t^2$，$r=j\Delta r$,</p>

<p>\begin{eqnarray}\label{ExForPb1}
\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}=\frac{(-ar)^2\Delta t^2+\sigma^2\Delta t}{ (\sigma \sqrt(3\Delta t))^2} 
=\frac{(-a\Delta t)^2r^2+\sigma^2\Delta t}{ 3\sigma^2 \Delta t} 
=\frac{M^2(j\Delta r)^2+\sigma^2\Delta t}{ 3\sigma^2 \Delta t} 
=\frac{1}{3}\frac{j^2 M^2 \Delta r^2+\sigma^2\Delta t}{ \sigma^2 \Delta t} 
=\frac{1}{3}\frac{j^2 M^2 \Delta r^2}{ \sigma^2 \Delta t}+\frac{1}{3} 
=\frac{1}{3}\frac{j^2 M^2 (3\sigma^2 \Delta t)}{ \sigma^2 \Delta t}+\frac{1}{3} 
=j^2M^2+\frac{1}{3}．
\end{eqnarray}</p>

<p>Therefore from the formula \eqref{ExForPb1},
\begin{eqnarray}
p_m=1-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=1-(j^2M^2+\frac{1}{3}) 
=\frac{2}{3}-j^2M^2．
\end{eqnarray}</p>

<p>On the other hand,
\begin{eqnarray}\label{ExForPb2}
\frac{\nu\Delta t}{\Delta x}=\frac{(-ar)\Delta t}{\sigma\sqrt(3\Delta t)} 
=\frac{-Mr}{\sigma\sqrt(3\Delta t)} 
=\frac{-jr\Delta r}{\sigma\sqrt(3\Delta t)} 
=\frac{-jr(\sigma\sqrt(3\Delta t))}{\sigma\sqrt(3\Delta t)} 
=-jM．
\end{eqnarray}</p>

<p>Therefore from the formula \eqref{ExForPb2},</p>

<p>\begin{eqnarray}
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} ) 
=\frac{1}{2}( j^2M^2+\frac{1}{3} -jM ) 
=\frac{1}{6}+\frac{j^2M^2-jM}{2}．
\end{eqnarray}</p>

<p>\begin{eqnarray}
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x}) 
=\frac{1}{2}(j^2M^2+\frac{1}{3}+jM) 
=\frac{1}{6}+\frac{j^2M^2+jM}{2}．
\end{eqnarray}</p>

<p>Next, it is derived from the probabilities corresponding to the upward branching process.</p>

<p>\begin{eqnarray}\label{averrageB}
\mathbb{E}[\Delta x]=p_u(2\Delta x)+p_m(\Delta x)+p_d(0)=\nu\Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceB}
\mathbb{E}[\Delta x^2]=p_u(2\Delta x)^2+p_m(\Delta x^2)+p_d(0)=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}
\begin{eqnarray}\label{SumProB}
p_u+p_m+p_d=1．
\end{eqnarray}</p>

<p>The expression \eqref{averrageB} and the expression \eqref{varianceB} are expanded as follows.</p>

<p>\begin{eqnarray}\label{averrageBB}
2p_u\Delta x+p_m\Delta x=\nu \Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceBB}
4p_u\Delta x^2+p_m\Delta x^2=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}</p>

<p>Subtracting the expression \eqref{averrageBB} from the expression \eqref{varianceBB} multiplied by $\Delta x$</p>

<p>\begin{eqnarray}\label{puB}
2p_u\Delta x^2=\nu^2\Delta t^2+\sigma^2\Delta t-\nu \Delta t\Delta x 
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )．
\end{eqnarray}</p>

<p>Also, if it is assigned the expression \eqref{puB} to the expression \eqref{averrageBB},
\begin{eqnarray}\label{pmB}
2p_u\Delta x+p_m\Delta x=\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x}+p_m\Delta x 
\Leftrightarrow p_m\Delta x=2\nu \Delta t-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}<br />
\Leftrightarrow p_m=\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}．
\end{eqnarray}</p>

<p>And if it is substituted the expression \eqref{puB} and the expression \eqref{pmB} into the expression \eqref{SumProB}
\begin{eqnarray}\label{pdB}
p_u+p_m+p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )+\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+p_d 
=\frac{3}{2}\frac{\nu \Delta t}{\Delta x}-\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+p_d 
\Leftrightarrow p_d=1-\frac{1}{2}( \frac{3\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} ) ．
\end{eqnarray}</p>

<p>Therefore from the formula \eqref{ExForPb1},
\begin{eqnarray}
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} ) 
=\frac{1}{2}( j^2M^2+\frac{1}{3}-(-jM)) 
=\frac{1}{6}-\frac{j^2M^2+jM}{2}．
\end{eqnarray}</p>

<p>\begin{eqnarray}
p_m=\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=-2jM-(j^2M^2+\frac{1}{3}) 
=\frac{1}{3}-j^2M^2-2jM．
\end{eqnarray}</p>

<p>\begin{eqnarray}
p_d=1-\frac{1}{2}( \frac{3\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} ) 
=1-frac{1}{2}( -3jM-j^2M^2-\frac{1}{3}) 
=\frac{7}{6}+\frac{j^2M^2+3jM}{2}．
\end{eqnarray}</p>

<p>Then, the probability corresponding to the downward branching process is derived.</p>

<p>\begin{eqnarray}\label{averrageC}
\mathbb{E}[\Delta x]=p_u(0)+p_m(-\Delta x)+p_d(-2\Delta x)=\nu\Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceC}
\mathbb{E}[\Delta x^2]=p_u(0)+p_m(-\Delta x)^2+p_d(-2\Delta x)^2=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}
\begin{eqnarray}\label{SumProC}
p_u+p_m+p_d=1．
\end{eqnarray}</p>

<p>The expression \eqref{averrageC} and the expression \eqref{varianceC} are expanded as follows.
\begin{eqnarray}\label{averrageCC}
-p_m\Delta x-2p_d\Delta x=\nu \Delta t．
\end{eqnarray}
\begin{eqnarray}\label{varianceCC}
p_m\Delta x^2+4p_d\Delta x^2=\sigma^2\Delta t+\nu^2\Delta t^2．
\end{eqnarray}</p>

<p>Add the expression \eqref{varianceCC} multiplied by $\Delta x$ and the expression \eqref{averrageCC},
\begin{eqnarray}\label{pdC}
2p_d\Delta x^2=\nu^2\Delta t^2+\sigma^2\Delta t+\nu \Delta t\Delta x 
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )．
\end{eqnarray}</p>

<p>Also, if it is assigned the expression \eqref{pdC} to the expression \eqref{averrageCC},
\begin{eqnarray}\label{pmC}
-p_m\Delta x-2p_d\Delta x=-p_m\Delta x-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} 
\Leftrightarrow -p_m\Delta x=2\nu \Delta t+\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}<br />
\Leftrightarrow p_m=-\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}．
\end{eqnarray}</p>

<p>And if it is substituted the expression \eqref{pdC} and the expression \eqref{pmC} into the expression \eqref{SumProC},
\begin{eqnarray}\label{puC}
p_u+p_m+p_d=p_u-\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} ) 
=p_u-\frac{3}{2}\frac{\nu \Delta t}{\Delta x}-\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
\Leftrightarrow p_u=1+\frac{3}{2}\frac{\nu \Delta t}{\Delta x}+\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}．
\end{eqnarray}</p>

<p>Therefore from the formula \eqref{ExForPb1},
\begin{eqnarray}
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} ) 
=\frac{1}{2}( j^2M^2+\frac{1}{3}-jM) 
=\frac{1}{6}-\frac{j^2M^2-jM}{2}．
\end{eqnarray}</p>

<p>\begin{eqnarray}
p_m=-\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=2jM-(j^2M^2+\frac{1}{3}) 
=-\frac{1}{3}-j^2M^2+2jM．
\end{eqnarray}</p>

<p>\begin{eqnarray}
p_u=1+\frac{3}{2}\frac{\nu \Delta t}{\Delta x}+\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=1+\frac{3}{2}(-jM)+\frac{1}{2}(j^2M^2+\frac{1}{3}) 
=\frac{7}{6}+\frac{j^2M^2-3jM}{2}．
\end{eqnarray}</p>

<p>Finally, the short rate process is introduced into the drift term $a_i$, which fluctuates with time. This drift term is chosen to be consistent with the discount bonds market quoted.
\begin{eqnarray}
P(0,i+1)=\int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{(-a_i+j\Delta r)\Delta t}．
\end{eqnarray}</p>

<p>Here, $Q_{i,j}$ is a security that pays $1$ when the node $(i,j)$ is reached, and pays nothing at other times.
Therefore, the drift term $ a_i $ is given as follows.</p>

<p>\begin{eqnarray}
\ln P(0,i+1)=\ln \int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{j\Delta r\Delta t}-a_i\Delta t 
\Leftrightarrow a_i\Delta t=\ln \int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{j\Delta r\Delta t}-\ln P(0,i+1) 
\Leftrightarrow a_i=\frac{\ln \int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{j\Delta r\Delta t}-\ln P(0,i+1)}{\Delta t}．
\end{eqnarray}</p>

<h2 id="hull-and-white-tree-implementation">Hull and White Tree Implementation</h2>

<p>It is given the simplified tree implementation mentioned above. The source code is written in matlab 2016b.</p>
<ul>
  <li>Full of below code is in <a href="https://github.com/kyo1988/Kyo.github.io/blob/gh-pages/scripts%20for%20article/BuildHWF1.m">my GitHub account</a></li>
</ul>

<figure class="highlight"><pre><code class="language-css" data-lang="css"> 
<span class="nf">#container</span> <span class="p">{</span> <span class="nl">float</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="m">-240px</span> <span class="m">0</span> <span class="m">0</span><span class="p">;</span> <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span> <span class="p">}</span> 
    <span class="nt">for</span> <span class="nt">i</span><span class="o">=</span><span class="err">1</span><span class="nd">:N-1</span> 
        <span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)=</span><span class="nt">sigma</span><span class="o">*</span><span class="nt">sqrt</span><span class="o">(</span><span class="err">3</span><span class="o">.*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">)));</span>
    <span class="nt">end</span>
    <span class="nt">for</span> <span class="nt">i</span><span class="o">=</span><span class="err">1</span><span class="nd">:N-1</span> 
        <span class="nt">for</span> <span class="nt">j</span><span class="o">=</span><span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nd">:-1:-m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span> 
            <span class="nt">M</span><span class="o">=</span><span class="nt">-j</span><span class="o">.*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">).*</span><span class="nt">a</span><span class="o">*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">));</span>
            <span class="nt">V</span><span class="o">=</span><span class="nt">sigma</span><span class="o">.^</span><span class="err">2</span><span class="o">.*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span> <span class="o">));</span>
            <span class="nt">k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">round</span><span class="o">((</span><span class="nt">j</span><span class="o">.*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">)+</span><span class="nt">M</span><span class="o">)./</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">));</span> 
            <span class="nt">alpha</span><span class="o">=(</span><span class="nt">j</span><span class="o">.*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">)+</span><span class="nt">M-k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">).*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">))./</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">);</span>
            <span class="nt">pu</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">V</span><span class="o">./(</span><span class="err">2</span><span class="o">.*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">).^</span><span class="err">2</span><span class="o">)+(</span><span class="nt">alpha</span><span class="o">.^</span><span class="err">2</span><span class="o">+</span><span class="nt">alpha</span><span class="o">)./</span><span class="err">2</span><span class="o">;</span>
            <span class="nt">pd</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">V</span><span class="o">./(</span><span class="err">2</span><span class="o">.*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">).^</span><span class="err">2</span><span class="o">)+(</span><span class="nt">alpha</span><span class="o">.^</span><span class="err">2</span><span class="nt">-alpha</span><span class="o">)./</span><span class="err">2</span><span class="o">;</span> 
            <span class="nt">pm</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="err">1</span><span class="nt">-V</span><span class="o">./(</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">).^</span><span class="err">2</span><span class="o">)</span><span class="nt">-alpha</span><span class="o">.^</span><span class="err">2</span><span class="o">;</span>
        <span class="nt">if</span> <span class="nt">j</span><span class="o">==</span><span class="nt">max</span><span class="o">(</span><span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">))</span> 
            <span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)=</span><span class="nt">k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span><span class="nt">i</span><span class="o">)+</span><span class="err">1</span><span class="o">;</span> 
        <span class="nt">end</span>
        <span class="nt">end</span>
    <span class="nt">end</span>
    <span class="nt">for</span> <span class="nt">i</span><span class="o">=</span><span class="err">1</span><span class="nd">:N-1</span>
        <span class="nt">for</span> <span class="nt">j</span><span class="o">=</span><span class="err">1</span><span class="nd">:m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span>
            <span class="nt">x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j-1</span><span class="o">,</span> <span class="nt">i</span><span class="o">)</span><span class="nt">-deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">);</span> 
            <span class="nt">x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i</span><span class="o">)+</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">);</span> 
        <span class="nt">end</span>
    <span class="nt">end</span>  
    <span class="nt">for</span> <span class="nt">i</span><span class="o">=</span><span class="err">1</span><span class="nd">:N-1</span> 
        <span class="nt">if</span> <span class="nt">i</span><span class="o">==</span><span class="err">2</span>
            <span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">2</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pu</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">)));</span> 
            <span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pm</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">)));</span> 
            <span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pd</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">)));</span> 
        <span class="nt">elseif</span> <span class="nt">i</span><span class="o">&gt;=</span><span class="err">3</span>
            <span class="nt">for</span> <span class="nt">j</span><span class="o">=</span><span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nd">:-1:-m</span><span class="o">(</span> <span class="nt">i</span> <span class="o">)</span> 
                <span class="nt">for</span> <span class="nt">jj</span><span class="o">=</span><span class="nt">m</span><span class="o">(</span><span class="nt">i-1</span><span class="o">)</span><span class="nd">:-1:-m</span><span class="o">(</span><span class="nt">i-1</span><span class="o">)</span> 
                    <span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)...</span>
                    <span class="o">+</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pu</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">))).*(</span><span class="nt">k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span><span class="nt">i-1</span><span class="o">)+</span><span class="err">1</span><span class="o">==</span><span class="nt">j</span><span class="o">)...</span>
                    <span class="o">+</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pm</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">))).*(</span><span class="nt">k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span><span class="nt">i-1</span><span class="o">)==</span><span class="nt">j</span><span class="o">)...</span>
                    <span class="o">+</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pd</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">))).*(</span><span class="nt">k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span><span class="nt">i-1</span><span class="o">)</span><span class="nt">-1</span><span class="o">==</span><span class="nt">j</span><span class="o">);</span>
                <span class="nt">end</span> 
            <span class="nt">end</span> 
        <span class="nt">end</span>
    <span class="nt">if</span> <span class="nt">i</span><span class="o">==</span><span class="err">1</span>
        <span class="nt">g</span><span class="o">(</span><span class="nt">i</span><span class="o">)=</span><span class="nt">-log</span><span class="o">(</span><span class="nt">P</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">))./(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">));</span> 
    <span class="nt">elseif</span> <span class="nt">i</span><span class="o">&gt;=</span><span class="err">2</span> 
        <span class="nt">sum</span><span class="o">=</span><span class="err">0</span><span class="o">;</span> 
        <span class="nt">for</span> <span class="nt">j</span><span class="o">=</span><span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span> <span class="nd">:-1</span> <span class="nd">:-m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span> 
            <span class="nt">sum</span><span class="o">=</span><span class="nt">sum</span><span class="o">+</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j</span><span class="o">,</span> <span class="nt">i</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j</span><span class="o">,</span> <span class="nt">i</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">)));</span> 
        <span class="nt">end</span> 
            <span class="nt">g</span><span class="o">(</span><span class="nt">i</span><span class="o">)=(</span><span class="nt">log</span><span class="o">(</span><span class="nt">sum</span><span class="o">)</span><span class="nt">-log</span><span class="o">(</span><span class="nt">P</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)))./(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">));</span> 
    <span class="nt">end</span>
        <span class="nt">for</span> <span class="nt">j</span><span class="o">=</span><span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nd">:-1:-m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span>
            <span class="nt">r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)+</span><span class="nt">g</span><span class="o">(</span><span class="nt">i</span><span class="o">);</span> 
            <span class="nt">d</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">)));</span> 
        <span class="nt">end</span> 
    <span class="nt">end</span></code></pre></figure>

<h2 id="reference">Reference</h2>
<ul>
  <li>Hull, J. and A. White, 1994. “Numerical procedures for implementing term structure models I:Single-Factor Models,’’ Journal of Derivatives, 2, 1 (Fall 1994a) 7−16</li>
  <li>Strickland, C. and Clewlow, L., 1998. Implementing Derivatives Models</li>
  <li>Shreve, S., 2004. Stochastic Calculus for Finance II: Continuous-Time Models</li>
</ul>

  </article>
  <hr />
</div>


<div>
  <h1>Related Posts</h1>
  <ul>
  
    <li><a href="/business/analyics/2021/06/18/SALES-FORECASTING-2.html">SALES FORECASTING 2</a></li>
  
    <li><a href="/business/finance/2021/06/03/derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory.html">Derivation of Black-Scholes PDE and its analytical solution by arbitrage pricing theory</a></li>
  
    <li><a href="/business/finance/2021/05/31/derivation-of-yield-curve-construction-formula-with-tenor-basis-spread.html">Derivation of yield curve construction formula with tenor basis spread</a></li>
  
    <li><a href="/business/finance/2021/05/26/vc-finance.html">Venture capital finance</a></li>
  
    <li><a href="/business/finance/marketing/2021/05/26/strategic-brand-management.html">Strategic brand management</a></li>
  
    <li><a href="/business/finance/2021/05/26/sources-of-finance.html">Sources of finance</a></li>
  
    <li><a href="/business/finance/start-up/2021/05/26/knowledge-leadership-in-a-global-economy.html">Knowledge Leadership in a Global Economy</a></li>
  
  </ul>
</div>


<section class="pager">
  <ul>
    
    <li class="previous"><a href="/Kyo.github.io/business/finance/2021/06/03/derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory.html" title="Derivation of Black-Scholes PDE and its analytical solution by arbitrage pricing theory">&larr; Older</a></li>
    
    
    <li class="next"><a href="/Kyo.github.io/business/analyics/2021/06/18/SALES-FORECASTING-2.html" title="SALES FORECASTING 2">Newer &rarr;</a></li>
    
  </ul>
</section>

<div id="disqus_thread"></div>

<script type="text/javascript">

  var disqus_developer = 1;

var disqus_shortname ='kyo';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  </div>
  <section class="pager">
  
  
</section>



  

  <footer class="site-footer">

  <p>Copyright &copy; <a href="/Kyo.github.io/">Kyo Harada — Visage AI / Data Scientist</a></p>
  <p>Powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a>
  on
  <a href="https://github.com/">Github</a>
  | Theme <a href="https://github.com/yulijia/freshman21/">Freshman21</a> Design by <a href="https://yulijia.net">Lijia Yu</a>

</footer>


</div>

<!-- Lazy loading script -->
<script src="/Kyo.github.io/assets/js/lazyfix.js"></script>

</body>

</html>
