<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="ja"><generator uri="https://jekyllrb.com/" version="3.10.0">Jekyll</generator><link href="https://kyo1988.github.io/Kyo.github.io/atom.xml" rel="self" type="application/atom+xml" /><link href="https://kyo1988.github.io/Kyo.github.io/" rel="alternate" type="text/html" hreflang="ja" /><updated>2025-09-18T11:37:18+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/atom.xml</id><title type="html">Kyo Harada â€” Visage AI / Data Scientist</title><subtitle>Founder &amp; Data Scientist building on-device AI for skin analytics and finance-grade data products.</subtitle><author><name>Kyo Harada</name></author><entry xml:lang="ja"><title type="html">RAGãƒŸãƒ‹ç›£æŸ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆç„¡æ–™DLï¼‰</title><link href="https://kyo1988.github.io/Kyo.github.io/2025/01/19/rag-audit-checklist.html" rel="alternate" type="text/html" title="RAGãƒŸãƒ‹ç›£æŸ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆç„¡æ–™DLï¼‰" /><published>2025-01-19T00:00:00+09:00</published><updated>2025-01-19T00:00:00+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/2025/01/19/rag-audit-checklist</id><content type="html" xml:base="https://kyo1988.github.io/Kyo.github.io/2025/01/19/rag-audit-checklist.html"><![CDATA[<div class="tldr">
  <strong>TL;DR</strong>
  <p>RAGã®å–„ã—æ‚ªã—ã¯å†ç¾æ€§Ã—ãƒªãƒ¼ãƒ³é‹ç”¨ã€‚ã¾ãšã¯ã“ã®A4ä¸€æšã‹ã‚‰ã€‚2é€±é–“ã§ç¾çŠ¶æŠŠæ¡â†’æ”¹å–„ææ¡ˆã¾ã§ã€‚</p>
</div>

<h2 id="è©•ä¾¡è¦³ç‚¹ã¨æœ€å°ã‚»ãƒƒãƒˆ">è©•ä¾¡è¦³ç‚¹ã¨æœ€å°ã‚»ãƒƒãƒˆ</h2>

<h3 id="1-ãƒ‡ãƒ¼ã‚¿å“è³ªdata-quality">1. ãƒ‡ãƒ¼ã‚¿å“è³ªï¼ˆData Qualityï¼‰</h3>
<ul>
  <li><strong>æ–‡æ›¸ã®ä¸€è²«æ€§</strong>: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»æ§‹é€ ã®çµ±ä¸€æ€§</li>
  <li><strong>é‡è¤‡æ’é™¤</strong>: åŒä¸€å†…å®¹ã®é‡è¤‡æ–‡æ›¸ã®ç‰¹å®š</li>
  <li><strong>æ›´æ–°é »åº¦</strong>: ãƒ‡ãƒ¼ã‚¿ã®é®®åº¦ã¨æ›´æ–°ãƒ—ãƒ­ã‚»ã‚¹</li>
  <li><strong>æ¨©é™ç®¡ç†</strong>: ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</li>
</ul>

<h3 id="2-æ¤œç´¢æ€§èƒ½retrieval-performance">2. æ¤œç´¢æ€§èƒ½ï¼ˆRetrieval Performanceï¼‰</h3>
<ul>
  <li><strong>æ¤œç´¢ç²¾åº¦</strong>: é–¢é€£æ–‡æ›¸ã®æ¤œç´¢ç‡ï¼ˆRecallï¼‰</li>
  <li><strong>æ¤œç´¢é©åˆæ€§</strong>: æ¤œç´¢çµæœã®é–¢é€£æ€§ï¼ˆPrecisionï¼‰</li>
  <li><strong>æ¤œç´¢é€Ÿåº¦</strong>: ã‚¯ã‚¨ãƒªå¿œç­”æ™‚é–“</li>
  <li><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong>: æ–‡æ›¸æ•°å¢—åŠ ã¸ã®å¯¾å¿œ</li>
</ul>

<h3 id="3-ç”Ÿæˆå“è³ªgeneration-quality">3. ç”Ÿæˆå“è³ªï¼ˆGeneration Qualityï¼‰</h3>
<ul>
  <li><strong>äº‹å®Ÿæ­£ç¢ºæ€§</strong>: ç”Ÿæˆå†…å®¹ã®äº‹å®Ÿé–¢ä¿‚ã®æ­£ç¢ºæ€§</li>
  <li><strong>ä¸€è²«æ€§</strong>: æ–‡è„ˆã¨ã®æ•´åˆæ€§</li>
  <li><strong>å®Œå…¨æ€§</strong>: å›ç­”ã®å®Œå…¨æ€§ã¨è©³ç´°åº¦</li>
  <li><strong>å®‰å…¨æ€§</strong>: æœ‰å®³ãƒ»ä¸é©åˆ‡ãªå†…å®¹ã®ç”Ÿæˆå›é¿</li>
</ul>

<h2 id="è©•ä¾¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰">è©•ä¾¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>

<div class="key-takeaways">
  <strong>Key Takeaways</strong>
  <ul>
    
    
      <li>æ¤œç´¢ç²¾åº¦: 80%ä»¥ä¸Š</li>
    
      <li>ç”Ÿæˆå“è³ª: 85%ä»¥ä¸Š</li>
    
      <li>å¿œç­”æ™‚é–“: 3ç§’ä»¥å†…</li>
    
      <li>ã‚³ã‚¹ãƒˆåŠ¹ç‡: $0.01/ã‚¯ã‚¨ãƒªä»¥ä¸‹</li>
    
      <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦: 4.0/5.0ä»¥ä¸Š</li>
    
  </ul>
</div>

<h2 id="ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›®">ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›®</h2>

<h3 id="ãƒ‡ãƒ¼ã‚¿ç®¡ç†">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />æ–‡æ›¸ã®å‰å‡¦ç†ãŒé©åˆ‡ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ã®å“è³ªãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ãƒ—ãƒ­ã‚»ã‚¹ãŒè‡ªå‹•åŒ–ã•ã‚Œã¦ã„ã‚‹</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒé©åˆ‡ã«è¡Œã‚ã‚Œã¦ã„ã‚‹</li>
</ul>

<h3 id="æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ">æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ </h3>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />é©åˆ‡ãªæ¤œç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />æ¤œç´¢çµæœã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒæœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />æ¤œç´¢ã‚¯ã‚¨ãƒªã®å‰å‡¦ç†ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />æ¤œç´¢çµæœã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹</li>
</ul>

<h3 id="ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ">ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ </h3>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ãŒæœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ç”Ÿæˆå†…å®¹ã®æ¤œè¨¼ãƒ—ãƒ­ã‚»ã‚¹ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡ã«è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ç”Ÿæˆå†…å®¹ã®ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹</li>
</ul>

<h2 id="æ”¹å–„ææ¡ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ">æ”¹å–„ææ¡ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h2>

<section class="qa">
  <h2>Q&amp;A</h2>
  
  <dl>
  
    
    
    
    
      <dt>ç¾çŠ¶ã®èª²é¡Œã¯ï¼Ÿ</dt>
      <dd>æ¤œç´¢ç²¾åº¦ãŒ70%ã¨ç›®æ¨™ã®80%ã‚’ä¸‹å›ã£ã¦ã„ã‚‹</dd>
    
  
    
    
    
    
      <dt>æ ¹æœ¬åŸå› ã¯ï¼Ÿ</dt>
      <dd>åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ã®æ€§èƒ½ä¸è¶³ã¨æ–‡æ›¸å‰å‡¦ç†ã®ä¸å‚™</dd>
    
  
    
    
    
    
      <dt>æ”¹å–„ç­–ã¯ï¼Ÿ</dt>
      <dd>åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°ã¨æ–‡æ›¸å‰å‡¦ç†ã®æœ€é©åŒ–</dd>
    
  
    
    
    
    
      <dt>æœŸå¾…åŠ¹æœã¯ï¼Ÿ</dt>
      <dd>æ¤œç´¢ç²¾åº¦85%å‘ä¸Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦4.2/5.0é”æˆ</dd>
    
  
  </dl>
</section>

<h2 id="ç„¡æ–™ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">ç„¡æ–™ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h2>

<p><strong>RAGç›£æŸ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆPDFï¼‰</strong>ã‚’ç„¡æ–™ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ï¼š</p>

<ul>
  <li>ğŸ“‹ <strong>A4ç‰ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</strong>: å°åˆ·ã—ã¦ä½¿ç”¨å¯èƒ½</li>
  <li>ğŸ“Š <strong>è©•ä¾¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</strong>: Excelå½¢å¼ã§æ•°å€¤ç®¡ç†</li>
  <li>ğŸ“ <strong>æ”¹å–„ææ¡ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</strong>: Wordå½¢å¼ã§ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ</li>
</ul>

<p><a href="https://forms.gle/REPLACE">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰</a> ï¼ˆGoogle Formsï¼‰</p>

<h2 id="ç›£æŸ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«">ç›£æŸ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h2>

<ul>
  <li><strong>Week 1</strong>: ç¾çŠ¶èª¿æŸ»ãƒ»ãƒ‡ãƒ¼ã‚¿åé›†</li>
  <li><strong>Week 2</strong>: åˆ†æãƒ»è©•ä¾¡ãƒ»æ”¹å–„ææ¡ˆä½œæˆ</li>
  <li><strong>Deliverable</strong>: è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ + æ”¹å–„ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</li>
</ul>

<h2 id="å‚è€ƒè³‡æ–™">å‚è€ƒè³‡æ–™</h2>

<ul>
  <li><a href="https://arxiv.org/abs/2312.10997">RAG Evaluation Best Practices</a></li>
  <li><a href="https://arxiv.org/abs/2312.10997">Retrieval-Augmented Generation Survey</a></li>
  <li><a href="https://github.com/huggingface/evaluate">LLM Evaluation Framework</a></li>
</ul>

<div class="cta">
  <h3>ç›¸è«‡ãƒ»è¦‹ç©ã‚Šã®ã”ä¾é ¼</h3>
  <p>å°ã•ãé€Ÿãã€æˆæœç‰©ãƒ™ãƒ¼ã‚¹ã§ã”ä¸€ç·’ã—ã¾ã™ã€‚</p>
  <p>
    <a class="btn" href="/work-with-me/">Work with me</a>
    <a class="btn ghost" href="/newsletter/">ç„¡æ–™ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼</a>
  </p>
</div>

<div class="related">
  <h3>æ¬¡ã«èª­ã‚€</h3>
  <ul>
  
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/edinet-db-howto.html">EDINET XBRLã§ä½œã‚‹æŠ•è³‡å®¶ç´šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</a></li>
        
      
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/coreml-optimization-playbook.html">CoreMLæœ€é©åŒ–ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ï¼ˆå—è¨—ï¼‰</a></li>
        
      
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/coreml-optimization-playbook-en.html">CoreML Optimization Playbook (Consulting)</a></li>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  </ul>
</div>]]></content><author><name>Kyo Harada</name></author><category term="LLM" /><category term="RAG" /><category term="Evaluation" /><category term="Case-Study" /><category term="AI" /><summary type="html"><![CDATA[2é€±é–“ã§ç¾çŠ¶æŠŠæ¡â†’æ”¹å–„ææ¡ˆã¾ã§ã€‚è©•ä¾¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä»˜ãã€‚RAGã®å–„ã—æ‚ªã—ã¯å†ç¾æ€§Ã—ãƒªãƒ¼ãƒ³é‹ç”¨ã€‚ã¾ãšã¯ã“ã®A4ä¸€æšã‹ã‚‰ã€‚]]></summary></entry><entry xml:lang="en"><title type="html">CoreML Optimization Playbook (Consulting)</title><link href="https://kyo1988.github.io/Kyo.github.io/2025/01/19/coreml-optimization-playbook-en.html" rel="alternate" type="text/html" title="CoreML Optimization Playbook (Consulting)" /><published>2025-01-19T00:00:00+09:00</published><updated>2025-01-19T00:00:00+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/2025/01/19/coreml-optimization-playbook-en</id><content type="html" xml:base="https://kyo1988.github.io/Kyo.github.io/2025/01/19/coreml-optimization-playbook-en.html"><![CDATA[<div class="tldr">
  <strong>TL;DR</strong>
  <p>Key design decisions for on-device optimization without quality loss in 3 minutes. Optimization sequence: quantization â†’ distillation â†’ architecture design.</p>
</div>

<h2 id="design-decision-framework">Design Decision Framework</h2>

<h3 id="1-quantization">1. Quantization</h3>
<ul>
  <li><strong>INT8 Quantization</strong>: 75% model size reduction with &lt;5% accuracy loss</li>
  <li><strong>Dynamic Quantization</strong>: Quantize only during inference, maintain FP32 during training</li>
  <li><strong>Static Quantization</strong>: Pre-calibration for higher compression rates</li>
</ul>

<h3 id="2-knowledge-distillation">2. Knowledge Distillation</h3>
<ul>
  <li><strong>Teacher-Student</strong>: Knowledge transfer from large to lightweight models</li>
  <li><strong>Temperature Parameter</strong>: Soft label generation with T=3-5</li>
  <li><strong>Loss Function</strong>: Hard labels + soft labels + feature maps</li>
</ul>

<h3 id="3-architecture-design">3. Architecture Design</h3>
<ul>
  <li><strong>MobileNet</strong>: Depthwise separable convolutions for computational reduction</li>
  <li><strong>EfficientNet</strong>: Compound scaling for efficiency maximization</li>
  <li><strong>SqueezeNet</strong>: Fire Module for parameter count reduction</li>
</ul>

<h2 id="evaluation-metrics">Evaluation Metrics</h2>

<div class="key-takeaways">
  <strong>Key Takeaways</strong>
  <ul>
    
    
      <li>Accuracy: Top-1/Top-5 Accuracy</li>
    
      <li>Inference Speed: FPS (Frames Per Second)</li>
    
      <li>Model Size: MB units</li>
    
      <li>Memory Usage: RAM/VRAM</li>
    
      <li>Battery Consumption: mAh/inference</li>
    
  </ul>
</div>

<h2 id="common-pitfalls-and-solutions">Common Pitfalls and Solutions</h2>

<h3 id="typical-failure-patterns">Typical Failure Patterns</h3>
<ol>
  <li><strong>Excessive Quantization</strong>: Significant accuracy degradation</li>
  <li><strong>Improper Distillation</strong>: Temperature setting errors</li>
  <li><strong>Architecture Mismatch</strong>: Task and model incompatibility</li>
</ol>

<h3 id="solutions">Solutions</h3>
<ul>
  <li><strong>Incremental Optimization</strong>: Apply one method at a time and measure effects</li>
  <li><strong>A/B Testing</strong>: Parallel comparison of multiple approaches</li>
  <li><strong>Real Device Validation</strong>: Test on actual devices, not simulators</li>
</ul>

<h2 id="deliverables">Deliverables</h2>

<section class="qa">
  <h2>Q&amp;A</h2>
  
  <dl>
  
    
    
    
    
      <dt>How to choose methods?</dt>
      <dd>Select based on accuracy requirements and constraints. Accuracy priority â†’ distillation, size priority â†’ quantization</dd>
    
  
    
    
    
    
      <dt>What are the evaluation metrics?</dt>
      <dd>Comprehensive evaluation across 5 axes: accuracy, speed, size, memory, battery</dd>
    
  
    
    
    
    
      <dt>What are the deliverables and timeline?</dt>
      <dd>Optimized model, implementation guide, performance report (2-6 weeks)</dd>
    
  
  </dl>
</section>

<h2 id="implementation-example">Implementation Example</h2>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// CoreML optimization implementation example</span>
<span class="kd">import</span> <span class="kt">CoreML</span>

<span class="kd">class</span> <span class="kt">OptimizedModelManager</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">loadOptimizedModel</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">MLModel</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">modelURL</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">url</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"optimized_model"</span><span class="p">,</span> <span class="nv">withExtension</span><span class="p">:</span> <span class="s">"mlmodelc"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">try</span><span class="p">?</span> <span class="kt">MLModel</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">modelURL</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">predict</span><span class="p">(</span><span class="nv">input</span><span class="p">:</span> <span class="kt">MLFeatureProvider</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">MLFeatureValue</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">model</span> <span class="o">=</span> <span class="nf">loadOptimizedModel</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="k">return</span> <span class="k">try</span><span class="p">?</span> <span class="n">model</span><span class="o">.</span><span class="nf">prediction</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">input</span><span class="p">)</span><span class="o">.</span><span class="nf">featureValue</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="s">"output"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://developer.apple.com/documentation/coreml">CoreML Documentation</a></li>
  <li><a href="https://developer.apple.com/machine-learning/models/">Model Optimization Guide</a></li>
  <li><a href="https://developer.apple.com/videos/">WWDC Sessions</a></li>
</ul>

<div class="cta">
  <h3>ç›¸è«‡ãƒ»è¦‹ç©ã‚Šã®ã”ä¾é ¼</h3>
  <p>å°ã•ãé€Ÿãã€æˆæœç‰©ãƒ™ãƒ¼ã‚¹ã§ã”ä¸€ç·’ã—ã¾ã™ã€‚</p>
  <p>
    <a class="btn" href="/work-with-me/">Work with me</a>
    <a class="btn ghost" href="/newsletter/">ç„¡æ–™ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼</a>
  </p>
</div>

<div class="related">
  <h3>æ¬¡ã«èª­ã‚€</h3>
  <ul>
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/rag-audit-checklist.html">RAGãƒŸãƒ‹ç›£æŸ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆç„¡æ–™DLï¼‰</a></li>
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/edinet-db-howto.html">EDINET XBRLã§ä½œã‚‹æŠ•è³‡å®¶ç´šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</a></li>
        
      
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/coreml-optimization-playbook.html">CoreMLæœ€é©åŒ–ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ï¼ˆå—è¨—ï¼‰</a></li>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  </ul>
</div>]]></content><author><name>Kyo Harada</name></author><category term="CoreML" /><category term="On-device" /><category term="Case-Study" /><category term="iOS" /><category term="Machine-Learning" /><summary type="html"><![CDATA[Decision-making for quantization/distillation/architecture design, evaluation metrics, and pitfalls. Key design decisions for on-device optimization without quality loss in 3 minutes.]]></summary></entry><entry xml:lang="ja"><title type="html">Founderâ€™s Log #01 â€” é€±å ±</title><link href="https://kyo1988.github.io/Kyo.github.io/2025/01/19/founders-log-01.html" rel="alternate" type="text/html" title="Founderâ€™s Log #01 â€” é€±å ±" /><published>2025-01-19T00:00:00+09:00</published><updated>2025-01-19T00:00:00+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/2025/01/19/founders-log-01</id><content type="html" xml:base="https://kyo1988.github.io/Kyo.github.io/2025/01/19/founders-log-01.html"><![CDATA[<div class="tldr">
  <strong>TL;DR</strong>
  <p>ä»Šé€±ã®æ±ºå®šï¼šJekyll 3äº’æ›ãƒ‘ãƒƒãƒã§ãƒ“ãƒ«ãƒ‰å®‰å®šåŒ–ã€‚æ•°å­—ã®å‹•ãï¼š20å›é€£ç¶šå¤±æ•—â†’æˆåŠŸã€‚æ¬¡é€±ã¯æ–°æ©Ÿèƒ½æ®µéšçš„å¾©æ´»ã€‚</p>
</div>

<h2 id="built">Built</h2>

<ul>
  <li><strong>Jekyll 3äº’æ›ãƒ‘ãƒƒãƒ</strong>: é…åˆ—å¼•æ•°includeã‚’åŒºåˆ‡ã‚Šæ–‡å­—æ–¹å¼ã«å¤‰æ›´</li>
  <li><strong>ãƒ“ãƒ«ãƒ‰å®‰å®šåŒ–</strong>: 20å›é€£ç¶šå¤±æ•—ã‚’è§£æ±ºã€GitHub Pagesã§æ­£å¸¸å‹•ä½œ</li>
  <li><strong>Liquidæ§‹æ–‡æœ€é©åŒ–</strong>: <code class="language-plaintext highlighter-rouge">absolute_url</code>ã€<code class="language-plaintext highlighter-rouge">strip_newlines</code>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å‰Šé™¤</li>
  <li><strong>JSON-LDå®Ÿè£…</strong>: Jekyll 3.10.0äº’æ›ã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿</li>
</ul>

<h2 id="learned">Learned</h2>

<ul>
  <li><strong>Jekyll 3.10.0ã®åˆ¶é™</strong>: GitHub Pagesã®åˆ¶ç´„ã‚’äº‹å‰èª¿æŸ»ã®é‡è¦æ€§</li>
  <li><strong>æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</strong>: æœ€å°æ§‹æˆâ†’æ©Ÿèƒ½å¾©æ´»ã®é †åºãŒé‡è¦</li>
  <li><strong>Liquidäº’æ›æ€§</strong>: é…åˆ—å¼•æ•°ã¯ä¸å®‰å®šã€åŒºåˆ‡ã‚Šæ–‡å­—ãŒç¢ºå®Ÿ</li>
</ul>

<h2 id="one-chart">One-chart</h2>

<figure>
  

<img src="https://res.cloudinary.com/djiyxp5ax/image/upload/f_auto,q_auto,w_1200/charts/build-success.png" alt="ãƒ“ãƒ«ãƒ‰æˆåŠŸã®æ¨ç§»" loading="lazy" />

  <figcaption>20å›é€£ç¶šå¤±æ•—ã‹ã‚‰å®‰å®šãƒ“ãƒ«ãƒ‰ã¸ã®æ”¹å–„ã€‚Jekyll 3äº’æ›ãƒ‘ãƒƒãƒã®åŠ¹æœã€‚</figcaption>
</figure>

<h2 id="qa">Q&amp;A</h2>

<section class="qa">
  <h2>Q&amp;A</h2>
  
  <dl>
  
    
    
    
    
      <dt>ç›®çš„ã¯ï¼Ÿ</dt>
      <dd>20å›é€£ç¶šãƒ“ãƒ«ãƒ‰å¤±æ•—ã®æ ¹æœ¬è§£æ±º</dd>
    
  
    
    
    
    
      <dt>ã©ã†è©•ä¾¡ï¼Ÿ</dt>
      <dd>ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰æˆåŠŸï¼‹GitHub Pagesè‡ªå‹•ãƒ“ãƒ«ãƒ‰æˆåŠŸ</dd>
    
  
    
    
    
    
      <dt>æ¬¡ã®ä¸€æ‰‹ã¯ï¼Ÿ</dt>
      <dd>æ–°æ©Ÿèƒ½ã®æ®µéšçš„å¾©æ´»ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ‹¡å……</dd>
    
  
  </dl>
</section>

<h2 id="sources">Sources</h2>

<ul>
  <li><a href="https://jekyllrb.com/docs/3.10.0/">Jekyll 3.10.0 Documentation</a></li>
  <li><a href="https://pages.github.com/versions/">GitHub Pages Jekyll Version</a></li>
  <li><a href="https://shopify.github.io/liquid/">Liquid Template Language</a></li>
</ul>

<div class="cta">
  <h3>ç›¸è«‡ãƒ»è¦‹ç©ã‚Šã®ã”ä¾é ¼</h3>
  <p>å°ã•ãé€Ÿãã€æˆæœç‰©ãƒ™ãƒ¼ã‚¹ã§ã”ä¸€ç·’ã—ã¾ã™ã€‚</p>
  <p>
    <a class="btn" href="/work-with-me/">Work with me</a>
    <a class="btn ghost" href="/newsletter/">ç„¡æ–™ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼</a>
  </p>
</div>

<div class="related">
  <h3>æ¬¡ã«èª­ã‚€</h3>
  <ul>
  
    
      
      
      
    
  
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/founders-log-01-en.html">Founder's Log #01 â€” Weekly Update</a></li>
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
  </ul>
</div>]]></content><author><name>Kyo Harada</name></author><category term="Log" /><category term="Founder" /><category term="Jekyll" /><category term="GitHub-Pages" /><summary type="html"><![CDATA[ä»Šé€±ã®Built / Learned / One-chart / One-linkã€‚Jekyll 3äº’æ›ãƒ‘ãƒƒãƒé©ç”¨ã¨ãƒ“ãƒ«ãƒ‰å®‰å®šåŒ–ã®æˆæœã‚’ã¾ã¨ã‚ã€‚]]></summary></entry><entry xml:lang="ja"><title type="html">EDINET XBRLã§ä½œã‚‹æŠ•è³‡å®¶ç´šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</title><link href="https://kyo1988.github.io/Kyo.github.io/2025/01/19/edinet-db-howto.html" rel="alternate" type="text/html" title="EDINET XBRLã§ä½œã‚‹æŠ•è³‡å®¶ç´šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹" /><published>2025-01-19T00:00:00+09:00</published><updated>2025-01-19T00:00:00+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/2025/01/19/edinet-db-howto</id><content type="html" xml:base="https://kyo1988.github.io/Kyo.github.io/2025/01/19/edinet-db-howto.html"><![CDATA[<div class="tldr">
  <strong>TL;DR</strong>
  <p>æŠ•è³‡å®¶ãŒä½¿ãˆã‚‹ç²’åº¦ã«ã™ã‚‹ãŸã‚ã®è¨­è¨ˆã¨é‹ç”¨ã®å®Ÿéš›ã€‚EDINET XBRLã‹ã‚‰æŠ•è³‡å®¶ç´šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹å®Œå…¨ã‚¬ã‚¤ãƒ‰ã€‚</p>
</div>

<h2 id="ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ">ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ</h2>

<h3 id="1-åŸºæœ¬ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ">1. åŸºæœ¬ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ </h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ä¼æ¥­ãƒã‚¹ã‚¿</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">companies</span> <span class="p">(</span>
    <span class="n">company_id</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">company_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">industry_code</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">listing_date</span> <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">created_at</span> <span class="nb">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span>
<span class="p">);</span>

<span class="c1">-- è²¡å‹™ãƒ‡ãƒ¼ã‚¿</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">financial_data</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">company_id</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">fiscal_year</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">fiscal_period</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">account_code</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">account_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
    <span class="n">amount</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">unit</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">created_at</span> <span class="nb">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">company_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">companies</span><span class="p">(</span><span class="n">company_id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h3 id="2-ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ">2. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ</h3>
<ul>
  <li><strong>è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹</strong>: (company_id, fiscal_year, account_code)</li>
  <li><strong>ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³</strong>: fiscal_yearã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åˆ†å‰²</li>
  <li><strong>åœ§ç¸®</strong>: InnoDBåœ§ç¸®ã§ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åŠ¹ç‡åŒ–</li>
</ul>

<h2 id="etlãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³">ETLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</h2>

<h3 id="1-ãƒ‡ãƒ¼ã‚¿å–å¾—">1. ãƒ‡ãƒ¼ã‚¿å–å¾—</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="n">ET</span>

<span class="k">class</span> <span class="nc">EDINETDownloader</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s">"https://disclosure.edinet-fsa.go.jp/api/v1"</span>
    
    <span class="k">def</span> <span class="nf">download_xbrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_id</span><span class="p">):</span>
        <span class="s">"""XBRLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"""</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">base_url</span><span class="si">}</span><span class="s">/documents/</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s">"</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">"type"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>  <span class="c1"># XBRLå½¢å¼
</span>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"X-API-KEY"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">api_key</span><span class="p">}</span>
        
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span>
        <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div>

<h3 id="2-ãƒ‡ãƒ¼ã‚¿å¤‰æ›">2. ãƒ‡ãƒ¼ã‚¿å¤‰æ›</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">XBRLParser</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">parse_financial_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xbrl_content</span><span class="p">):</span>
        <span class="s">"""XBRLã‹ã‚‰è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º"""</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="p">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xbrl_content</span><span class="p">)</span>
        <span class="n">financial_data</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># å‹˜å®šç§‘ç›®ã®æŠ½å‡º
</span>        <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">root</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">".//{http://www.xbrl.org/2003/instance}context"</span><span class="p">):</span>
            <span class="n">context_id</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
            <span class="n">period</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">extract_period</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">root</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">".//{http://www.xbrl.org/2003/instance}item"</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"contextRef"</span><span class="p">)</span> <span class="o">==</span> <span class="n">context_id</span><span class="p">:</span>
                    <span class="n">account_code</span> <span class="o">=</span> <span class="n">item</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span>
                    <span class="n">amount</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">text</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="p">.</span><span class="n">text</span> <span class="k">else</span> <span class="mi">0</span>
                    
                    <span class="n">financial_data</span><span class="p">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s">"context_id"</span><span class="p">:</span> <span class="n">context_id</span><span class="p">,</span>
                        <span class="s">"period"</span><span class="p">:</span> <span class="n">period</span><span class="p">,</span>
                        <span class="s">"account_code"</span><span class="p">:</span> <span class="n">account_code</span><span class="p">,</span>
                        <span class="s">"amount"</span><span class="p">:</span> <span class="n">amount</span>
                    <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">financial_data</span>
</code></pre></div></div>

<h2 id="æ¬ æå¯¾å‡¦">æ¬ æå¯¾å‡¦</h2>

<h3 id="1-ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°">1. ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</h3>
<div class="key-takeaways">
  <strong>Key Takeaways</strong>
  <ul>
    
    
      <li>æ¬ æå€¤ã®ç‰¹å®š: å‹˜å®šç§‘ç›®ã®å­˜åœ¨ç¢ºèª</li>
    
      <li>è£œå®Œæ–¹æ³•: å‰å¹´åŒæœŸå€¤ã¾ãŸã¯æ¥­ç•Œå¹³å‡å€¤</li>
    
      <li>ç•°å¸¸å€¤æ¤œå‡º: çµ±è¨ˆçš„ç•°å¸¸å€¤ã®ç‰¹å®šã¨é™¤å¤–</li>
    
      <li>ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§: è²¸å€Ÿå¯¾ç…§è¡¨ã®ãƒãƒ©ãƒ³ã‚¹ç¢ºèª</li>
    
  </ul>
</div>

<h3 id="2-å“è³ªç®¡ç†">2. å“è³ªç®¡ç†</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DataQualityChecker</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">check_balance_sheet_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="s">"""è²¸å€Ÿå¯¾ç…§è¡¨ã®ãƒãƒ©ãƒ³ã‚¹ç¢ºèª"""</span>
        <span class="n">assets</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">'account_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Assets'</span><span class="p">][</span><span class="s">'amount'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>
        <span class="n">liabilities</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">'account_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Liabilities'</span><span class="p">][</span><span class="s">'amount'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>
        <span class="n">equity</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">'account_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Equity'</span><span class="p">][</span><span class="s">'amount'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>
        
        <span class="n">balance</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">assets</span> <span class="o">-</span> <span class="p">(</span><span class="n">liabilities</span> <span class="o">+</span> <span class="n">equity</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">balance</span> <span class="o">&lt;</span> <span class="mf">0.01</span>  <span class="c1"># 1å††æœªæº€ã®å·®ã¯è¨±å®¹
</span>    
    <span class="k">def</span> <span class="nf">detect_outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s">'amount'</span><span class="p">):</span>
        <span class="s">"""ç•°å¸¸å€¤ã®æ¤œå‡º"""</span>
        <span class="n">Q1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">Q3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">IQR</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">-</span> <span class="n">Q1</span>
        <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">Q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>
        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>
        
        <span class="k">return</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">)]</span>
</code></pre></div></div>

<h2 id="ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¾‹">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¾‹</h2>

<h3 id="1-è²¡å‹™æŒ‡æ¨™ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰">1. è²¡å‹™æŒ‡æ¨™ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
<ul>
  <li><strong>åç›Šæ€§</strong>: ROE, ROA, å–¶æ¥­åˆ©ç›Šç‡</li>
  <li><strong>å®‰å…¨æ€§</strong>: è‡ªå·±è³‡æœ¬æ¯”ç‡, æµå‹•æ¯”ç‡</li>
  <li><strong>åŠ¹ç‡æ€§</strong>: ç·è³‡ç”£å›è»¢ç‡, å£²ä¸Šé«˜æˆé•·ç‡</li>
  <li><strong>å¸‚å ´è©•ä¾¡</strong>: PER, PBR, EV/EBITDA</li>
</ul>

<h3 id="2-æ¥­ç•Œæ¯”è¼ƒåˆ†æ">2. æ¥­ç•Œæ¯”è¼ƒåˆ†æ</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_industry_comparison</span><span class="p">(</span><span class="n">company_id</span><span class="p">,</span> <span class="n">industry_code</span><span class="p">):</span>
    <span class="s">"""æ¥­ç•Œæ¯”è¼ƒåˆ†æ"""</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s">"""
    SELECT 
        company_id,
        AVG(ROE) as avg_roe,
        AVG(ROA) as avg_roa,
        AVG(å–¶æ¥­åˆ©ç›Šç‡) as avg_operating_margin
    FROM financial_metrics 
    WHERE industry_code = %s
    GROUP BY company_id
    ORDER BY avg_roe DESC
    """</span>
    <span class="k">return</span> <span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">industry_code</span><span class="p">,))</span>
</code></pre></div></div>

<h2 id="é‹ç”¨ç›£è¦–">é‹ç”¨ç›£è¦–</h2>

<section class="qa">
  <h2>Q&amp;A</h2>
  
  <dl>
  
    
    
    
    
      <dt>ãƒ‡ãƒ¼ã‚¿æ›´æ–°é »åº¦ã¯ï¼Ÿ</dt>
      <dd>å››åŠæœŸã”ã¨ï¼ˆ3æœˆãƒ»6æœˆãƒ»9æœˆãƒ»12æœˆï¼‰ã®æ±ºç®—ç™ºè¡¨å¾Œ</dd>
    
  
    
    
    
    
      <dt>ç›£è¦–ã™ã¹ãæŒ‡æ¨™ã¯ï¼Ÿ</dt>
      <dd>ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸç‡ãƒ»å‡¦ç†æ™‚é–“ãƒ»ãƒ‡ãƒ¼ã‚¿å“è³ªã‚¹ã‚³ã‚¢</dd>
    
  
    
    
    
    
      <dt>éšœå®³æ™‚ã®å¯¾å¿œã¯ï¼Ÿ</dt>
      <dd>ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ãƒ»è‡ªå‹•å†è©¦è¡Œãƒ»æ‰‹å‹•å¾©æ—§æ‰‹é †</dd>
    
  
  </dl>
</section>

<h2 id="æˆæœç‰©">æˆæœç‰©</h2>

<ul>
  <li><strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</strong>: MySQL/PostgreSQLã§æ§‹ç¯‰</li>
  <li><strong>ETLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</strong>: Python + Airflowã§è‡ªå‹•åŒ–</li>
  <li><strong>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</strong>: Grafana + InfluxDBã§å¯è¦–åŒ–</li>
  <li><strong>API</strong>: RESTful APIã§ãƒ‡ãƒ¼ã‚¿æä¾›</li>
</ul>

<h2 id="å‚è€ƒè³‡æ–™">å‚è€ƒè³‡æ–™</h2>

<ul>
  <li><a href="https://disclosure.edinet-fsa.go.jp/api/v1/">EDINET API Documentation</a></li>
  <li><a href="https://www.xbrl.org/">XBRL Specification</a></li>
  <li><a href="https://pandas.pydata.org/">Financial Data Analysis</a></li>
</ul>

<div class="cta">
  <h3>ç›¸è«‡ãƒ»è¦‹ç©ã‚Šã®ã”ä¾é ¼</h3>
  <p>å°ã•ãé€Ÿãã€æˆæœç‰©ãƒ™ãƒ¼ã‚¹ã§ã”ä¸€ç·’ã—ã¾ã™ã€‚</p>
  <p>
    <a class="btn" href="/work-with-me/">Work with me</a>
    <a class="btn ghost" href="/newsletter/">ç„¡æ–™ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼</a>
  </p>
</div>

<div class="related">
  <h3>æ¬¡ã«èª­ã‚€</h3>
  <ul>
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/rag-audit-checklist.html">RAGãƒŸãƒ‹ç›£æŸ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆç„¡æ–™DLï¼‰</a></li>
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/coreml-optimization-playbook.html">CoreMLæœ€é©åŒ–ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ï¼ˆå—è¨—ï¼‰</a></li>
        
      
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/coreml-optimization-playbook-en.html">CoreML Optimization Playbook (Consulting)</a></li>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  </ul>
</div>]]></content><author><name>Kyo Harada</name></author><category term="EDINET" /><category term="Finance" /><category term="ETL" /><category term="Case-Study" /><category term="XBRL" /><category term="Database" /><summary type="html"><![CDATA[ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆã€ETLã€æ¬ æå¯¾å‡¦ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¾‹ã€‚æŠ•è³‡å®¶ãŒä½¿ãˆã‚‹ç²’åº¦ã«ã™ã‚‹ãŸã‚ã®è¨­è¨ˆã¨é‹ç”¨ã®å®Ÿéš›ã€‚]]></summary></entry><entry xml:lang="en"><title type="html">Founderâ€™s Log #01 â€” Weekly Update</title><link href="https://kyo1988.github.io/Kyo.github.io/2025/01/19/founders-log-01-en.html" rel="alternate" type="text/html" title="Founderâ€™s Log #01 â€” Weekly Update" /><published>2025-01-19T00:00:00+09:00</published><updated>2025-01-19T00:00:00+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/2025/01/19/founders-log-01-en</id><content type="html" xml:base="https://kyo1988.github.io/Kyo.github.io/2025/01/19/founders-log-01-en.html"><![CDATA[<div class="tldr">
  <strong>TL;DR</strong>
  <p>This week's decisions: Jekyll 3 compatibility patch for build stabilization. Numbers: 20 consecutive failures â†’ success. Next week: gradual feature restoration.</p>
</div>

<h2 id="built">Built</h2>

<ul>
  <li><strong>Jekyll 3 Compatibility Patch</strong>: Changed array parameter includes to delimiter-based approach</li>
  <li><strong>Build Stabilization</strong>: Resolved 20 consecutive failures, normal operation on GitHub Pages</li>
  <li><strong>Liquid Syntax Optimization</strong>: Removed absolute_url and strip_newlines filters</li>
  <li><strong>JSON-LD Implementation</strong>: Jekyll 3.10.0 compatible structured data</li>
</ul>

<h2 id="learned">Learned</h2>

<ul>
  <li><strong>Jekyll 3.10.0 Limitations</strong>: Importance of pre-investigating GitHub Pages constraints</li>
  <li><strong>Incremental Approach</strong>: Order of minimal configuration â†’ feature restoration is crucial</li>
  <li><strong>Liquid Compatibility</strong>: Array parameters are unstable, delimiters are reliable</li>
</ul>

<h2 id="one-chart">One-chart</h2>

<figure>
  

<img src="https://res.cloudinary.com/djiyxp5ax/image/upload/f_auto,q_auto,w_1200/charts/build-success.png" alt="Build success progression" loading="lazy" />

  <figcaption>Improvement from 20 consecutive failures to stable builds. Effect of Jekyll 3 compatibility patch.</figcaption>
</figure>

<h2 id="qa">Q&amp;A</h2>

<section class="qa">
  <h2>Q&amp;A</h2>
  
  <dl>
  
    
    
    
    
      <dt>What was the goal?</dt>
      <dd>Resolve the root cause of 20 consecutive build failures</dd>
    
  
    
    
    
    
      <dt>How was it evaluated?</dt>
      <dd>Local build success + GitHub Pages automatic build success</dd>
    
  
    
    
    
    
      <dt>What's the next step?</dt>
      <dd>Gradual restoration of new features and content expansion</dd>
    
  
  </dl>
</section>

<h2 id="sources">Sources</h2>

<ul>
  <li><a href="https://jekyllrb.com/docs/3.10.0/">Jekyll 3.10.0 Documentation</a></li>
  <li><a href="https://pages.github.com/versions/">GitHub Pages Jekyll Version</a></li>
  <li><a href="https://shopify.github.io/liquid/">Liquid Template Language</a></li>
</ul>

<div class="cta">
  <h3>ç›¸è«‡ãƒ»è¦‹ç©ã‚Šã®ã”ä¾é ¼</h3>
  <p>å°ã•ãé€Ÿãã€æˆæœç‰©ãƒ™ãƒ¼ã‚¹ã§ã”ä¸€ç·’ã—ã¾ã™ã€‚</p>
  <p>
    <a class="btn" href="/work-with-me/">Work with me</a>
    <a class="btn ghost" href="/newsletter/">ç„¡æ–™ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼</a>
  </p>
</div>

<div class="related">
  <h3>æ¬¡ã«èª­ã‚€</h3>
  <ul>
  
    
      
      
      
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/founders-log-01.html">Founder's Log #01 â€” é€±å ±</a></li>
        
      
    
  
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
  </ul>
</div>]]></content><author><name>Kyo Harada</name></author><category term="Log" /><category term="Founder" /><category term="Jekyll" /><category term="GitHub-Pages" /><summary type="html"><![CDATA[This week's Built / Learned / One-chart / One-link. Jekyll 3 compatibility patch application and build stabilization achievements.]]></summary></entry><entry xml:lang="ja"><title type="html">CoreMLæœ€é©åŒ–ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ï¼ˆå—è¨—ï¼‰</title><link href="https://kyo1988.github.io/Kyo.github.io/2025/01/19/coreml-optimization-playbook.html" rel="alternate" type="text/html" title="CoreMLæœ€é©åŒ–ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ï¼ˆå—è¨—ï¼‰" /><published>2025-01-19T00:00:00+09:00</published><updated>2025-01-19T00:00:00+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/2025/01/19/coreml-optimization-playbook</id><content type="html" xml:base="https://kyo1988.github.io/Kyo.github.io/2025/01/19/coreml-optimization-playbook.html"><![CDATA[<div class="tldr">
  <strong>TL;DR</strong>
  <p>ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ã§å“è³ªã‚’è½ã¨ã•ãšè»½é‡åŒ–ã™ã‚‹è¨­è¨ˆåˆ¤æ–­ã®è¦ç‚¹ã‚’3åˆ†ã§ã€‚é‡å­åŒ–â†’è’¸ç•™â†’ã‚¢ãƒ¼ã‚­è¨­è¨ˆã®é †åºã§æœ€é©åŒ–ã€‚</p>
</div>

<h2 id="è¨­è¨ˆåˆ¤æ–­ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯">è¨­è¨ˆåˆ¤æ–­ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯</h2>

<h3 id="1-é‡å­åŒ–quantization">1. é‡å­åŒ–ï¼ˆQuantizationï¼‰</h3>
<ul>
  <li><strong>INT8é‡å­åŒ–</strong>: ç²¾åº¦æå¤±5%ä»¥å†…ã§ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º75%å‰Šæ¸›</li>
  <li><strong>å‹•çš„é‡å­åŒ–</strong>: æ¨è«–æ™‚ã®ã¿é‡å­åŒ–ã€å­¦ç¿’æ™‚ã¯FP32ç¶­æŒ</li>
  <li><strong>é™çš„é‡å­åŒ–</strong>: äº‹å‰ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚ˆã‚Šé«˜ã„åœ§ç¸®ç‡</li>
</ul>

<h3 id="2-è’¸ç•™knowledge-distillation">2. è’¸ç•™ï¼ˆKnowledge Distillationï¼‰</h3>
<ul>
  <li><strong>Teacher-Student</strong>: å¤§è¦æ¨¡ãƒ¢ãƒ‡ãƒ«â†’è»½é‡ãƒ¢ãƒ‡ãƒ«ã¸ã®çŸ¥è­˜è»¢ç§»</li>
  <li><strong>æ¸©åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</strong>: T=3-5ã§ã‚½ãƒ•ãƒˆãƒ©ãƒ™ãƒ«ç”Ÿæˆ</li>
  <li><strong>æå¤±é–¢æ•°</strong>: ãƒãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ« + ã‚½ãƒ•ãƒˆãƒ©ãƒ™ãƒ« + ç‰¹å¾´ãƒãƒƒãƒ—</li>
</ul>

<h3 id="3-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ">3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ</h3>
<ul>
  <li><strong>MobileNet</strong>: æ·±åº¦åˆ†é›¢ç•³ã¿è¾¼ã¿ã§è¨ˆç®—é‡å‰Šæ¸›</li>
  <li><strong>EfficientNet</strong>: è¤‡åˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã§åŠ¹ç‡æœ€å¤§åŒ–</li>
  <li><strong>SqueezeNet</strong>: Fire Moduleã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°å‰Šæ¸›</li>
</ul>

<h2 id="è©•ä¾¡æŒ‡æ¨™">è©•ä¾¡æŒ‡æ¨™</h2>

<div class="key-takeaways">
  <strong>Key Takeaways</strong>
  <ul>
    
    
      <li>ç²¾åº¦: Top-1/Top-5 Accuracy</li>
    
      <li>æ¨è«–é€Ÿåº¦: FPS (Frames Per Second)</li>
    
      <li>ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º: MBå˜ä½</li>
    
      <li>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: RAM/VRAM</li>
    
      <li>ãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»: mAh/æ¨è«–</li>
    
  </ul>
</div>

<h2 id="è½ã¨ã—ç©´ã¨å¯¾ç­–">è½ã¨ã—ç©´ã¨å¯¾ç­–</h2>

<h3 id="ã‚ˆãã‚ã‚‹å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³">ã‚ˆãã‚ã‚‹å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
<ol>
  <li><strong>éåº¦ãªé‡å­åŒ–</strong>: ç²¾åº¦å¤§å¹…ä½ä¸‹</li>
  <li><strong>ä¸é©åˆ‡ãªè’¸ç•™</strong>: æ¸©åº¦è¨­å®šãƒŸã‚¹</li>
  <li><strong>ã‚¢ãƒ¼ã‚­é¸æŠãƒŸã‚¹</strong>: ã‚¿ã‚¹ã‚¯ã¨ãƒ¢ãƒ‡ãƒ«ã®ä¸é©åˆ</li>
</ol>

<h3 id="å¯¾ç­–">å¯¾ç­–</h3>
<ul>
  <li><strong>æ®µéšçš„æœ€é©åŒ–</strong>: 1ã¤ãšã¤é©ç”¨ã—ã¦åŠ¹æœæ¸¬å®š</li>
  <li><strong>A/Bãƒ†ã‚¹ãƒˆ</strong>: è¤‡æ•°æ‰‹æ³•ã®ä¸¦è¡Œæ¯”è¼ƒ</li>
  <li><strong>å®Ÿæ©Ÿæ¤œè¨¼</strong>: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ã¯ãªãå®Ÿãƒ‡ãƒã‚¤ã‚¹ã§ãƒ†ã‚¹ãƒˆ</li>
</ul>

<h2 id="æˆæœç‰©ã‚»ãƒƒãƒˆ">æˆæœç‰©ã‚»ãƒƒãƒˆ</h2>

<section class="qa">
  <h2>Q&amp;A</h2>
  
  <dl>
  
    
    
    
    
      <dt>ã©ã®æ‰‹æ³•ã‚’ã©ã†é¸ã¶ï¼Ÿ</dt>
      <dd>ç²¾åº¦è¦æ±‚ã¨åˆ¶ç´„ã‹ã‚‰é€†ç®—ã—ã¦é¸æŠã€‚ç²¾åº¦å„ªå…ˆâ†’è’¸ç•™ã€ã‚µã‚¤ã‚ºå„ªå…ˆâ†’é‡å­åŒ–</dd>
    
  
    
    
    
    
      <dt>è©•ä¾¡æŒ‡æ¨™ã¯ï¼Ÿ</dt>
      <dd>ç²¾åº¦ãƒ»é€Ÿåº¦ãƒ»ã‚µã‚¤ã‚ºãƒ»ãƒ¡ãƒ¢ãƒªãƒ»ãƒãƒƒãƒ†ãƒªãƒ¼ã®5è»¸ã§ç·åˆè©•ä¾¡</dd>
    
  
    
    
    
    
      <dt>ç´å“ç‰©ã¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ï¼Ÿ</dt>
      <dd>æœ€é©åŒ–ãƒ¢ãƒ‡ãƒ«ãƒ»å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ»æ€§èƒ½ãƒ¬ãƒãƒ¼ãƒˆï¼ˆ2-6é€±é–“ï¼‰</dd>
    
  
  </dl>
</section>

<h2 id="å®Ÿè£…ä¾‹">å®Ÿè£…ä¾‹</h2>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// CoreMLæœ€é©åŒ–ã®å®Ÿè£…ä¾‹</span>
<span class="kd">import</span> <span class="kt">CoreML</span>

<span class="kd">class</span> <span class="kt">OptimizedModelManager</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">loadOptimizedModel</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">MLModel</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">modelURL</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">url</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"optimized_model"</span><span class="p">,</span> <span class="nv">withExtension</span><span class="p">:</span> <span class="s">"mlmodelc"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">try</span><span class="p">?</span> <span class="kt">MLModel</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">modelURL</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">predict</span><span class="p">(</span><span class="nv">input</span><span class="p">:</span> <span class="kt">MLFeatureProvider</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">MLFeatureValue</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">model</span> <span class="o">=</span> <span class="nf">loadOptimizedModel</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="k">return</span> <span class="k">try</span><span class="p">?</span> <span class="n">model</span><span class="o">.</span><span class="nf">prediction</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">input</span><span class="p">)</span><span class="o">.</span><span class="nf">featureValue</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="s">"output"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="å‚è€ƒè³‡æ–™">å‚è€ƒè³‡æ–™</h2>

<ul>
  <li><a href="https://developer.apple.com/documentation/coreml">CoreML Documentation</a></li>
  <li><a href="https://developer.apple.com/machine-learning/models/">Model Optimization Guide</a></li>
  <li><a href="https://developer.apple.com/videos/">WWDC Sessions</a></li>
</ul>

<div class="cta">
  <h3>ç›¸è«‡ãƒ»è¦‹ç©ã‚Šã®ã”ä¾é ¼</h3>
  <p>å°ã•ãé€Ÿãã€æˆæœç‰©ãƒ™ãƒ¼ã‚¹ã§ã”ä¸€ç·’ã—ã¾ã™ã€‚</p>
  <p>
    <a class="btn" href="/work-with-me/">Work with me</a>
    <a class="btn ghost" href="/newsletter/">ç„¡æ–™ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼</a>
  </p>
</div>

<div class="related">
  <h3>æ¬¡ã«èª­ã‚€</h3>
  <ul>
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/rag-audit-checklist.html">RAGãƒŸãƒ‹ç›£æŸ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆç„¡æ–™DLï¼‰</a></li>
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/edinet-db-howto.html">EDINET XBRLã§ä½œã‚‹æŠ•è³‡å®¶ç´šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</a></li>
        
      
    
  
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/2025/01/19/coreml-optimization-playbook-en.html">CoreML Optimization Playbook (Consulting)</a></li>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  </ul>
</div>]]></content><author><name>Kyo Harada</name></author><category term="CoreML" /><category term="On-device" /><category term="Case-Study" /><category term="iOS" /><category term="Machine-Learning" /><summary type="html"><![CDATA[é‡å­åŒ–/è’¸ç•™/ã‚¢ãƒ¼ã‚­è¨­è¨ˆã®æ„æ€æ±ºå®šã€è©•ä¾¡æŒ‡æ¨™ã€è½ã¨ã—ç©´ã€‚ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ã§å“è³ªã‚’è½ã¨ã•ãšè»½é‡åŒ–ã™ã‚‹è¨­è¨ˆåˆ¤æ–­ã®è¦ç‚¹ã‚’3åˆ†ã§ã€‚]]></summary></entry><entry><title type="html">SALES FORECASTING 2</title><link href="https://kyo1988.github.io/Kyo.github.io/business/analyics/2021/06/18/SALES-FORECASTING-2.html" rel="alternate" type="text/html" title="SALES FORECASTING 2" /><published>2021-06-18T00:00:00+09:00</published><updated>2025-01-19T00:00:00+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/business/analyics/2021/06/18/SALES-FORECASTING-2</id><content type="html" xml:base="https://kyo1988.github.io/Kyo.github.io/business/analyics/2021/06/18/SALES-FORECASTING-2.html"><![CDATA[<ul id="markdown-toc">
  <li><a href="#sales-forecasting-2" id="markdown-toc-sales-forecasting-2">SALES FORECASTING 2</a>    <ul>
      <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
      <li><a href="#reference" id="markdown-toc-reference">Reference</a></li>
    </ul>
  </li>
</ul>

<p>This is a modified version of the report for Business Analyics in Bath Full Time MBA Class of 2020.</p>

<h1 id="sales-forecasting-2">SALES FORECASTING 2</h1>

<h2 id="introduction">Introduction</h2>
<p>In this section, it is assumed a pizza parlor business plan in the Bath University has lunched.  The vital issue of the plan is also done so to find one or two pizzas which might be appealed by the Bath University students based on the attributions such as type of topping and base.  Hence, it will be conducted an experiment to attempt diverse pizzas for the target consumers including the students.  However, there are some constrictions for the plan, one of which is the maximum budget of Â£100 to purchase the pizzas for this experiment.  One of the major tools to find the customer preferences can be conjoint analysis which assumed their preferences as a combination of the attributions having a certain degree <cite>(Janssens et al., 2008)</cite>.  Therefore, it should be decided that which attributions might be the most relevant to the purpose that is to find the most preferred among the students.  The consideration relevant to the attributions was started from the research suggesting 5 attributions which are the crust, topping, cheese type, cheese quality and price <cite>(Lilien and Rangaswamy, 2002)</cite>.  The crust has 3 levels which are thin, thick, pan.  Toppingâ€™s levels are pineapple, veggie, chicken, turkey.  The levels of cheese type are Romano, mixed, mozzarella.  These of cheese quality are 50g, 75g, 100g.  Â£4.99, Â£6.99, Â£8.99 are the level of price.  As a result, the total possible combinations of attribute levels are 324 (= 3 x 4 x 3 x 3 x 3).  All of them cannot be conducted due to the time and budget restrictions, however, some researchers argued the effective number of part worth parameters to be approximated from conjoint data, the number of which is less than the sum of all levels of each attribution (Wierenga, 2008).  Thus, if at most 16 (= 3 + 4 + 3 + 3 + 3) candidates are selected precisely, these alternatives can be represented all of the possible combinations of attribute levels (ibid).  The selection usually is done by SPSS from all of attribute levels and therefore, the data format to save 16 alternatives representing all possibilities should be suitable for the application.  Furthermore, the data structure of that should be 16 rows with at least 7 columns which are 5 attributions, the primary key and the preference score.  The most well-liked pizza should the maximum preference score (one hundred) and the minimum one (zero) should be rated to the least popular pizza.  Hence. Each pizza must have the preference score from 0 to 100.  Conjoint analysis assumes the preference score can be represented the weighted sum of the utilities for each attribution <cite>(Wierenga, 2008)</cite>.  This means after collecting the score from the customers being tested, the software (SPSS) can discover weights and utilities of each attributions.  In addition, the key is required to identify each rows, however, it is automatically inserted (see the leftist column of figure 1) when the data is inputted in the data format and then also accordingly the column named â€˜STATUSâ€™ with â€˜Designâ€™ as the value is inserted as a result of using the function to generate the orthogonal design <cite>(Janssens et al., 2008)</cite>.</p>

<p><img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1623989695/Figure_1_gtuehf.png" alt="Figure 1" title="Figure 1" /></p>

<p>Furthermore, although it should be tested 16 type of pizzas to collect the target customer preference as the score, there is the budged limitation which the pizzas only can be purchased less than 100 pounds.  This means if assumed the price of normal size pizza is 15 pounds, 6 pizzas are able to be bought for the experiment.  Supposed the shop selected to buy the pizzas can allow to consume at least 3 type of the alternatives among 16 of that in the same pizza, 18 different type of pizza is available for the test.  Therefore, all of alternatives are able to be examined with only 2 duplicates (16 = 18 - 2).  Because of the fact that 6 students are applicable for the evaluation, if each student can eat and rate all of alternatives to cut each piece into 6 parts, the preferable scores of them are able to be collected.  Figure 2 is assumed the result of the 16 alternative pizzas rating by 6 students (identified by id in the figure).  For instance, the column named â€˜sco1â€™ means the students (identified by id in the figure 2) rating score for the top row in the figure 1 (Card ID 1 row).</p>

<p><img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1623989696/Figure_2_k2ig2k.png" alt="Figure 2" title="Figure 2" /></p>

<p>The utilities of each attributions are estimated by the software, SPSS.  In Figure 3, it is seen apparently that the attribution â€˜thinâ€™ (assigned to â€˜Crustâ€™ level) has the highest utility (5.708) and the lowest utility (-4.010) is earned by the attribution â€˜pineappleâ€™ (belonged to â€˜Toppingâ€™ level). 
Utilities</p>

<p><img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1623989695/Figure_3_bghixu.png" alt="Figure 3" title="Figure 3" /></p>

<p>In addition, Figure 4 shows the averaged importance for each levels of the attributions which mean which levels can earn the highest utility.  In the figure, the level â€˜Toppingâ€™ has the highest one (22.503) and the lowest one (17.930) is gained by the level â€˜Priceâ€™.</p>

<p><img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1623989695/Figure_4_qdicuj.png" alt="Figure 4" title="Figure 4" /></p>

<p>Furthermore, Figure 5 indicates that both the Pearsonâ€™s R (.864) and the Kendallâ€™s tau (.639) which mean the correlations between the recognized and forecasted preferences are high (ibid).  both correlations also are likely to be significant (respectively .000 and .000) because less than .05 significance means the null hypothesis of a null correlation is quite unlikely to be acceptable (ibid). 
Correlations2</p>

<p><img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1623989695/Figure_5_qxihdw.png" alt="Figure 5" title="Figure 5" /></p>

<p>Finally, Figures 6 through 10, the relative utility levels are demonstrated for each attribute and In Figure 11, the mean importance is displayed for each attribute (ibid).  From Figures 6 through 11, it could be seen that the pizza parlor that offers their customers a thin of crust, Veggie of topping, Romano of cheese type, 50g of cheese quantity and pricing Â£8.99 might achieve the highest utility.</p>

<p><img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1598684071/%E5%9B%B36.png" alt="Figure 6" title="Figure 6" />
<img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1598684178/%E5%9B%B37.png" alt="Figure 7" title="Figure 7" />
<img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1598684256/%E5%9B%B38.png" alt="Figure 8" title="Figure 8" />
<img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1598684355/%E5%9B%B39.png" alt="Figure 9" title="Figure 9" />
<img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1598685868/%E5%9B%B310.png" alt="Figure 10" title="Figure 10" />
<img src="https://res.cloudinary.com/djiyxp5ax/image/upload/v1598685920/%E5%9B%B311.png" alt="Figure 11" title="Figure 11" /></p>

<h2 id="reference">Reference</h2>
<ul>
  <li>Brownlee, J., 2016. How to Check if Time Series Data is Stationary with Python [Online]. Available from: <a href="https://machinelearningmastery.com/time-series-data-stationary-python/">https://machinelearningmastery.com/time-series-data-stationary-python/</a> [Accessed 30 March 2020].</li>
  <li>Brownlee, J., 2017. Long Short-Term Memory Networks with Python</li>
  <li>Downey, A.B., 2011. Think Stats</li>
  <li>Janert, P.K., 2010. Data Analysis with Open Source Tools</li>
  <li>Janssens, W., Wijnen, K., Pelsmacker, P.D., Kenhove, P.V., 2008. Marketing Research with SPSS (FT Prentice Hall)</li>
  <li>Lilien, G.L. and Rangaswamy, A., 2002. Marketing Engineering: Computer Assisted Marketing Analysis and Planning</li>
  <li>Meulman, J.J. and Koopman, S.J., 2007. An Introduction to State Space Time Series Analysis</li>
  <li>Palachy, S., 2019. Detecting stationarity in time series data [Online]. Available from: <a href="https://towardsdatascience.com/detecting-stationarity-in-time-series-data-d29e0a21e638">https://towardsdatascience.com/detecting-stationarity-in-time-series-data-d29e0a21e638</a> [Accessed 30 March 2020].</li>
  <li>Prabhakaran, S., 2019. ARIMA Model â€“ Complete Guide to Time Series Forecasting in Python [Online]. Available from: <a href="https://www.machinelearningplus.com/time-series/arima-model-time-series-forecasting-python/">https://www.machinelearningplus.com/time-series/arima-model-time-series-forecasting-python/</a> [Accessed 30 March 2020].</li>
  <li>Prabhakaran, S., 2019. Time Series Analysis in Python â€“ A Comprehensive Guide with Examples [Online]. Available from: <a href="https://www.machinelearningplus.com/time-series/time-series-analysis-python/">https://www.machinelearningplus.com/time-series/time-series-analysis-python/</a> [Accessed 30 March 2020].</li>
  <li>SINGH, A., 2018. A Gentle Introduction to Handling a Non-Stationary Time Series in Python [Online]. Available from: <a href="https://www.analyticsvidhya.com/blog/2018/09/non-stationary-time-series-python/">https://www.analyticsvidhya.com/blog/2018/09/non-stationary-time-series-python/</a> [Accessed 30 March 2020].</li>
  <li>Taylor, S.J. and Letham, B., 2017. Forecasting at scale. PeerJ Preprints 5:e3190v2 <a href="https://doi.org/10.7287/peerj.preprints.3190v2">https://doi.org/10.7287/peerj.preprints.3190v2</a></li>
  <li>TensorFlow, 2020. Time series forecasting [Online]. Available from: <a href="https://www.tensorflow.org/tutorials/structured_data/time_series">https://www.tensorflow.org/tutorials/structured_data/time_series</a> [Accessed 30 March 2020].</li>
  <li>Tieleman, T. and Hinton, G., 2012. Lecture 6.5-rmsprop: Divide the Gradient by a Running Average of Its Recent Magnitude. COURSERA: Neural Networks for Machine Learning, 4, 26-31.</li>
  <li>Wierenga, B., 2008. Handbook of Marketing Decision Models</li>
</ul>

<div class="cta">
  <h3>ç›¸è«‡ãƒ»è¦‹ç©ã‚Šã®ã”ä¾é ¼</h3>
  <p>å°ã•ãé€Ÿãã€æˆæœç‰©ãƒ™ãƒ¼ã‚¹ã§ã”ä¸€ç·’ã—ã¾ã™ã€‚</p>
  <p>
    <a class="btn" href="/work-with-me/">Work with me</a>
    <a class="btn ghost" href="/newsletter/">ç„¡æ–™ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼</a>
  </p>
</div>

<div class="related">
  <h3>æ¬¡ã«èª­ã‚€</h3>
  <ul>
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        <li><a href="/Kyo.github.io/business/analyics/2021/05/08/sales-forecasting.html">SALES FORECASTING</a></li>
        
      
    
  
  </ul>
</div>]]></content><author><name>Kyo Harada</name></author><category term="Business" /><category term="Analyics" /><category term="Business Analyics" /><category term="Conjoint Analysis" /><category term="SPSS" /><category term="Marketing Research" /><summary type="html"><![CDATA[Conjoint analysis for pizza parlor business plan using SPSS. Customer preference modeling with budget constraints.]]></summary></entry><entry><title type="html">Organize and implement Hull and White (1994a) interest rate model</title><link href="https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html" rel="alternate" type="text/html" title="Organize and implement Hull and White (1994a) interest rate model" /><published>2021-06-09T00:00:00+09:00</published><updated>2021-06-09T00:00:00+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate%20model</id><content type="html" xml:base="https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/09/organize-and-implement-hull-and-white-1994a-interest-rate-model.html"><![CDATA[<ul id="markdown-toc">
  <li><a href="#organize-and-implement-hull-and-white-1994a-interest-rate-model" id="markdown-toc-organize-and-implement-hull-and-white-1994a-interest-rate-model">Organize and implement Hull and White (1994a) interest rate model</a>    <ul>
      <li><a href="#derivation-of-hull-and-white-1994a-interest-rate-model-solutions-and-boundary-conditions" id="markdown-toc-derivation-of-hull-and-white-1994a-interest-rate-model-solutions-and-boundary-conditions">Derivation of Hull and White (1994a) interest rate model solutions and boundary conditions</a></li>
      <li><a href="#hull-and-white-tree-formulation" id="markdown-toc-hull-and-white-tree-formulation">Hull and White Tree formulation</a></li>
      <li><a href="#hull-and-white-tree-implementation" id="markdown-toc-hull-and-white-tree-implementation">Hull and White Tree Implementation</a></li>
      <li><a href="#reference" id="markdown-toc-reference">Reference</a></li>
    </ul>
  </li>
</ul>

<h1 id="organize-and-implement-hull-and-white-1994a-interest-rate-model">Organize and implement Hull and White (1994a) interest rate model</h1>
<h2 id="derivation-of-hull-and-white-1994a-interest-rate-model-solutions-and-boundary-conditions">Derivation of Hull and White (1994a) interest rate model solutions and boundary conditions</h2>

<ul>
  <li>Definition [Hull and White(1994a) interest rate model]
\begin{eqnarray}\label{HullandWhite1994a}
dr(t)=(\theta(t)-ar(t))dt+\sigma d\tilde{W}(t) ï¼
\end{eqnarray}</li>
</ul>

<p>However, $\tilde{W}(t)$ is Brownian motion under the risk-neutral measure $\mathbb{P}$.
Also, $\theta (t)$, $a$, and $\sigma$ are positive-definite functions for time (Hull and White, 1994a).</p>

<ul>
  <li>Definition [Discount bond price evaluation formula]
\begin{eqnarray}\label{DiscountBondPrice}
B(t,T)=\tilde{\mathbb{E}}[e^{-\int_{t}^{T}R(s)ds}|{\cal F}(t)] ï¼
\end{eqnarray}</li>
</ul>

<p>Here, a discount bond is a contract in which $1$ is paid for a certain fixed maturity of $T$, and no payment is made before the maturity.</p>

<ul>
  <li>Definition [Yield from time $t$ to $T$]
\begin{eqnarray}
Y(t,T)=-\frac{1}{T-t}\log B(t,T)ï¼
\end{eqnarray}</li>
</ul>

<p>This is equivalent to the following equation.</p>

<p>\begin{eqnarray}
B(t,T)=e^{-Y(t,T)(T-t)}ï¼
\end{eqnarray}</p>

<p>Therefore, $B(T, T) =1$.</p>

<p>The random variable $e^{-\int_{t}^{T}R(s)ds}$ estimated in the equation \eqref{DiscountBondPrice} depends not only on $R(T)$ but also on the path. However, the path of $R$ to time $t$ depends only on $R(t)$ at time $t$. Therefore, since $R$ is a Markov process, the bond price $B(t, T)$ is considered to be a function of time $t$ and $R(t)$.</p>

<p>\begin{eqnarray}
B(t,T)=f(t,R(t))ï¼
\end{eqnarray}</p>

<p>On the other hand, since the equation \eqref{DiscountBondPrice} is the expansion of $D(t)B(t,T)=\tilde{\Bbb{E}}[D(T)B(T,T))\lvert\cal{F}(t)]$, then $D(t)B(t,T)=D(t)f(t,T)$ is a martingale.</p>

<p>Therefore, in order for the no arbitrage condition to hold, the drift $(dt)$ term obtained by differentiating $D(t)f(t,T)$ must appear as $0$.</p>

<p>To find the derivative of $D(t)f(t,T)$, it is required first to find the discount process and its relational expression.</p>

<ul>
  <li>Definition [discount process]
\begin{eqnarray}
D(t)=e^{-\int_{0}^{t}R(s)ds}ï¼
\end{eqnarray}</li>
</ul>

<p>Here, if $S(x)=e(-t)$ and $I(t)=\int_{0}^{t}R(s)ds$, then $D(t) = S(I(t))$.
At this time, since $dI(t)=R(t)dt$, $dI(t)dI (t)=0$ and $Sâ€™(x)=-S (x)$, $Sâ€™â€˜(x) =S(x)$ then from Itoâ€™s lemma,</p>

<p>\begin{eqnarray}
dD(t)=dS(I(t)) 
=Sâ€™(I(t))dI(t)+\frac{1}{2}Sâ€™â€˜(I(t))dI(t)dI(t) 
=-S(I(t))dI(t) 
=-D(t)R(t)dtï¼
\end{eqnarray}</p>

<p>therefore,</p>

<p>\begin{eqnarray}
dD(t)=-D(t)R(t)dtï¼
\end{eqnarray}</p>

<p>If the interest rate process $R(t)$ in finding the derivative of $D(t)f(t,T)$ follows the equation \eqref{HullandWhite1994a}, then From $dtdt=0$, $dtd\tilde{W}=0$, $d\tilde{W}d\tilde{W}=dt$ and $drdr= \sigma^2dt$</p>

<p>\begin{eqnarray}
d(D(t)f(t,T))
=f(t,T)dD(t)+D(t)df(t,T)
=f(t,T)(-D(t)R(t))+D(t){f_t(t,T)dt+f_r(t,T)dr+\frac{1}{2}f_rr(t,T)drdr} 
=D(t)(-rf(t,T)+f_t(t,T)+\frac{1}{2}\sigma^2 f_rr(t,T)+(\theta(t)-ar(t))f_r(t,T))dt+D(t)\sigma f_r(t,T)d\tilde{W}(t)ï¼
\end{eqnarray}</p>

<p>Therefore, $f(t, T))$ must be met.</p>

<p>\begin{eqnarray}\label{HullWhitePDE}
f_t(t,T)+\frac{1}{2}\sigma^{2} f_rr(t,T)+(\theta(t)-ar(t))f_r(t,T)=rf(t,T)
\end{eqnarray}</p>

<p>Also, since $1=B(T, T)=f(T, r)$, the terminal condition is obtained.</p>

<p>For all $r$,
\begin{eqnarray}
f(T,r)=1
\end{eqnarray}</p>

<p>Next, the partial differential equation of the equation \eqref{HullWhitePDE} is expanded to obtain an analytical solution.
If you set $f_t(t, T)=e^{-rC (t, T) -A (t, T)}$,</p>

<p>\begin{eqnarray}
f_t(t,r)=(-rCâ€™(t,T)-Aâ€™(t,T))f(t,r)ï¼ 
f_r(t,r)=-C(t,T)f(t,r)ï¼ 
f_rr(t,r)=-C^{2}(t,T)f(t,r)ï¼
\end{eqnarray}</p>

<p>Where $Câ€™(t,T)=\frac{\partial C(t,T)}{\partial t}$ï¼Œ$Aâ€™(t,T)=\frac{\partial A(t,T)}{\partial t}$ï¼
Therefore, the left side of the formula \eqref{HullWhitePDE} is</p>

<p>\begin{eqnarray}
f_t(t,T)+\frac{1}{2}\sigma f_rr(t,T)+(\theta(t)-ar(t))f_r(t,T) 
=(-rCâ€™(t,T)-Aâ€™(t,T)+\frac{1}{2}\sigma^{2}C^{2}(t,T)-(\theta(t)-ar(t))C(t,T))f(t,r)ï¼
\end{eqnarray}</p>

<p>Therefore, by transposing the right side to the left side and enclosing it with $r$, the following relational expression is obtained.</p>

<p>\begin{eqnarray}
((-Câ€™(t,T)+aC(t,T)-1)r-Aâ€™(t,T)-\theta(t)C(t,T)+\frac{1}{2}\sigma^{2}C^{2}(t,T))f(t,r)=0ï¼
\end{eqnarray}</p>

<p>From the assumption, $f_t(t, T)=e^{-rC(t, T)-A(t, T)}&gt;0$, and this relation must hold for all $r$, then this term for $r$ must be $0$.</p>

<p>\begin{eqnarray}
Câ€™(t,T)=aC(t,T)-1ï¼
Aâ€™(t,T)=-\theta(t)C(t,T)+\frac{1}{2}\sigma^{2}C^{2}(t,T)ï¼
\end{eqnarray}</p>

<p>Furthermore, $C(T, T)=Aâ€™(T, T)=A(T, T)=0$ is required to hold for the terminal condition.</p>

<p>A function that satisfies $Câ€™(t, T)=aC(t, T)-1$, $C(T, T)=0$</p>

<p>\begin{eqnarray}
C(t,T)=\int_{t}^{T}e^{-\int_{t}^{s}a(v)dv}dsï¼
\end{eqnarray}</p>

<p>It is shown that this is a unique solution to be obtained.</p>

<p>\begin{eqnarray}
\frac{d }{d s}(e^{-\int_{0}^{s}a(v)dv} C(s,T))
=e^{-\int_{0}^{s}a(v)dv}(-a(s)C(s,T)+Câ€™(s,T) ) 
=e^{-\int_{0}^{s}a(v)dv}(-a(s)C(s,T)+aC(t,T)-1 ) 
=e^{-\int_{0}^{s}a(v)dv}ï¼
\end{eqnarray}</p>

<p>Integrating both sides of this equation from $t$ to $T$</p>

<p>\begin{eqnarray}
e^{-\int_{0}^{T}a(v)dv}C(T,T)-e^{-\int_{0}^{t}a(v)dv}C(t,T)=-\int_{t}^{T}e^{-\int_{0}^{s}a(v)dv}ds 
\Leftrightarrow C(t,T)=e^{\int_{0}^{t}a(v)dv}\int_{t}^{T}e^{-\int_{0}^{s}a(v)dv}ds<br />
=\int_{t}^{T}e^{-\int_{t}^{s}a(v)dv}dsï¼
\end{eqnarray}</p>

<p>The expansion of this unique solution is as follows. However, $a(v)=a$ is set from the equation \eqref{HullandWhite1994a}.</p>

<p>\begin{eqnarray}
C(t,T)=\int_{t}^{T}e^{-\int_{t}^{s}a(v)dv}ds 
=\int_{t}^{T}e^{-as+at}ds 
=\frac{1}{a}(1-e^{-a(T-t)})ï¼
\end{eqnarray}</p>

<p>Similarly, the function, that satisfies $A(T, T)=1$, $Aâ€™(t, T)=-\theta(t)C(t, T)+\frac{1}{2}\sigma^{2}C^{2}(t, T)$, is shown below as a unique solution.</p>

<p>\begin{eqnarray}
A(t,T)=\int_{t}^{T}(\theta(t)C(t,T)-\frac{1}{2}\sigma^{2}C^{2}(t,T) )dsï¼
\end{eqnarray}</p>

<p>Integrating both sides of this equation from $t$ to $T$
\begin{eqnarray}
A(T,T)-A(t,T)=-\int_{t}^{T}\theta(t)C(t,T)ds+\frac{1}{2}\int_{t}^{T}\sigma^{2}C^{2}(t,T)ds 
\Leftrightarrow A(t,T)=\int_{t}^{T}(\theta(t)C(t,T)-\frac{1}{2}\sigma^{2}C^{2}(t,T))dsï¼
\end{eqnarray}</p>

<p>The expansion of this unique solution is as follows. However, $a(v)=a$ is set from the equation \eqref{HullandWhite1994a}.</p>

<p>\begin{eqnarray}
A(t,T)=\int_{t}^{T}(\theta(t)C(t,T)-\frac{1}{2}\sigma^{2}C^{2}(t,T) )ds 
=\int_{t}^{T}(\frac{\theta(t)}{a}(1-e^{-a(T-t)})-\frac{1}{2}\sigma^{2}\frac{1}{a^2}(1-e^{-a(T-t)} )^{2} )ds 
=\frac{\sigma^{2}}{2a^3}(-a(T-t)+2(1-e^{-a(T-t)})-\frac{1}{2}(1-e^{-2a(T-t)})) 
+\frac{1}{a}\int_{t}^{T}\theta(s)(1-e^{-a(T-s)})dsï¼
\end{eqnarray}</p>

<p>Next, the parameter $\theta(t)$ in the equation \eqref{HullandWhite1994a} means the speed of mean reversion. It is required to match this parameter to the term structure of the quoted interest rate.</p>

<ul>
  <li>Definition [Instantaneous Forward Rate]
Let $f^{M}(0, T)$ be the instantaneous forward rate of the market at maturity $T$ at time $0$.
\begin{eqnarray}
f^{M}(0,T)=-\frac{\partial \ln B^{M}(0,T)}{\partial T}ï¼
\end{eqnarray}
Here, $B^{M}(0, T)$ is the discount bond price quoted in the market at maturity $T$.</li>
</ul>

<p>Because it is $B(t,T)=f(t,r)=e^{-rC(t,T)-A(t,T)}$ï¼Œ</p>

<p>\begin{eqnarray}
\ln B(0,T)=-rC(0,T)-A(0,T) 
=-\frac{r}{a}(1-e^{-aT} ) 
-\frac{\sigma^{2}}{2a^3}(-aT+2(1-e^{-aT})-\frac{1}{2}(1-e^{-2aT})) 
+\frac{1}{a}\int_{0}^{T}\theta(s)(1-e^{-a(T-s)})ds 
\Leftrightarrow \frac{\partial \ln B^{M}(0,T)}{\partial T}=re^{-aT}+\frac{\sigma^{2}}{2a^3}(-a+2ae^{-aT}+e^{-2aT})+\int_{t}^{T}\theta(s)e^{-a(T-s)}ds 
\Leftrightarrow f^{M}(0,T)=re^{-aT}+\frac{\sigma^{2}}{2a^3}(-a+2ae^{-aT}+e^{-2aT})+\int_{t}^{T}\theta(s)e^{-a(T-s)}dsï¼
\end{eqnarray}</p>

<p>The following relationship is used to derive $\theta(T)$ from $f^{M}(0, T)$.</p>

<p>\begin{eqnarray}
H(t)=\int_{0}^{t}h(s,t)dsarrow Hâ€™(t)=\int_{0}^{t}\frac{\partial h(s,t)}{\partial t}ds+h(t,t)ï¼
\end{eqnarray}</p>

<p>Here, $x(t)=re^{-at}+\int_{0}^{t}\theta(s)e^{-a(t-s)}ds$</p>

<p>\begin{eqnarray}
xâ€™(t)=-a(re^{-at}+\int_{0}^{t}\theta(s)e^{-a(t-s)}ds)+\theta(t) 
xâ€™(t)=-ax(t)+\theta(t) 
\Leftrightarrow \theta(t)=xâ€™(t)+ax(t) 
arrow \theta(T)=xâ€™(T)+ax(T)ï¼
\end{eqnarray}</p>

<p>On the other hand, if it is set $g(t)=\frac{\sigma^2}{2a^2}(-1+2e^{-at}+e^{-2at})$</p>

<p>\begin{eqnarray}
f^{M}(0,T)=x(T)+g(T) 
\Leftrightarrow x(T)=f^{M}(0,T)-g(T)ï¼
\end{eqnarray}</p>

<p>Therefore 
\begin{eqnarray}
\theta(T)=\frac{\partial f^{M}(0,T)}{\partial T}-\frac{\partial g(T)}{\partial T}+ax(t)ï¼
\end{eqnarray}</p>

<p>Here, since it is $\frac{\partial g(T)}{\partial T}=-\frac{\sigma^2}{a}(e^{-aT}+e^{-2aT})$, the following equation is obtained after all.</p>

<p>\begin{eqnarray}
\theta(T)=\frac{\partial f^{M}(0,T)}{\partial T}+\frac{\sigma^2}{a}(e^{-aT}+e^{-2aT})+af^{M}(0,T)-\frac{\sigma^2}{2a^2}(-1+2e^{-at}+e^{-2at})ï¼
\end{eqnarray}</p>

<h2 id="hull-and-white-tree-formulation">Hull and White Tree formulation</h2>

<p>In the following, to represent the interest rate model as the $3$ term tree, it is derived the relational expression between the parameters of the continuous time process and the parameters of the $3$ term process.</p>

<p>In the $3$ term process, it is expressed by $p_u$, $p_m$, and $p_d$, respectively, during the minute time $\Delta t$ as the interest rate rises by the spatial division width $\Delta x$, or stays at the same level, decreasing by $\Delta x$.</p>

<p>Furthermore, $\Delta t$ and $\Delta x$ cannot be selected independently and must satisfy the conditions for stability and convergence of the finite difference method $\Delta x=\sigma \sqrt{3\Delta t}$ (Hull and White, 1994).</p>

<p>Here, if the drift term of the formula \eqref{HullandWhite1994a} is set $\nu=\theta(t)-ar(t)$,</p>

<p>\begin{eqnarray}\label{averrageA}
\mathbb{E}[\Delta x]=p_u(\Delta x)+p_m(0)+p_d(-\Delta x)=\nu\Delta tï¼
\end{eqnarray}
\begin{eqnarray}\label{varianceA}
\mathbb{E}[\Delta x^2]=p_u(\Delta x^2)+p_m(0)+p_d(-\Delta x^2)=\sigma^2\Delta t+\nu^2\Delta t^2ï¼
\end{eqnarray}
\begin{eqnarray}\label{SumProA}
p_u+p_m+p_d=1ï¼
\end{eqnarray}</p>

<p>The expression \eqref{averrageA} and the expression \eqref{varianceA} are expanded as follows.</p>

<p>\begin{eqnarray}\label{averrageAA}
p_u\Delta x-p_d\Delta x=\nu \Delta tï¼
\end{eqnarray}
\begin{eqnarray}\label{varianceAA}
p_u\Delta x^2-p_d\Delta x^2=\sigma^2\Delta t+\nu^2\Delta t^2ï¼
\end{eqnarray}</p>

<p>Multiply the expression \eqref{averrageAA} by $\Delta x$ and add the expression \eqref{varianceAA},</p>

<p>\begin{eqnarray}\label{puA}
2p_u\Delta x^2=\nu^2\Delta t^2+\sigma^2\Delta t+\nu \Delta t\Delta x 
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )ï¼
\end{eqnarray}</p>

<p>Also, substituting the expression \eqref{puA} into the expression \eqref{averrageAA},</p>

<p>\begin{eqnarray}
p_u\Delta x-p_d\Delta x=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )\Delta x-p_d\Delta x 
\Leftrightarrow p_d\Delta x=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )\Delta x<br />
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )ï¼
\end{eqnarray}</p>

<p>And if it is substituted the expression \eqref{puA} and the expression \eqref{puA} into the expression \eqref{SumProA}</p>

<p>\begin{eqnarray}\label{pmA}
p_u+p_m+p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )+p_m+\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} ) 
=\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+p_m 
\Leftrightarrow p_m=1-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}ï¼
\end{eqnarray}</p>

<p>Hull And White (1994a) proposed a method for constructing an efficient and accurate short rate for the equation \eqref{HullandWhite1994a}. Also, it is assumed $\theta(t)=0$ï¼Œ$r(0)=0$.</p>

<p>\begin{eqnarray}
dr(t)=ar(t)dt+\sigma d\tilde{W}(t) ï¼
\end{eqnarray}</p>

<p>Therefore, note that $\nu=-ar$. In this simplified tree, the value of $r$ at the time $i\Delta t$ is $j\Delta t$. Since the tree is designed to reduce the amount of calculation, $j$ needs to be between $BottomNode[i]$ and $TopNode[i]$. The choice of which branching process to take at each node depends on the sign of $a$ and the size of $j$, and the range of change $\Delta x(=\Delta r)$ in the simplified $r$ process is chosen to match the expected value of $\mathbb{E}[\Delta x]$ and the variance $Var(\Delta x)$. Furthermore, when $a$ is positive, if $M$ is the expected value of the fluctuation range, when $j$ is the smallest integer larger than $-0.184/M$, the standard branching process is switched to the downward branching process. In order to maintain the symmetry, HW proposes to switch from the standard branching process to the upward branching process in the node $j$ with a negative sign for this node (Hull and White, 1994).</p>

<p>Hereï¼Œ
\begin{eqnarray}
\mathbb{E}[\Delta x]=\nu \Delta t 
=-ar\Delta t 
=Mr 
\Leftrightarrow M=-a\Delta tï¼
\end{eqnarray}</p>

<p>Alsoï¼Œ
\begin{eqnarray}
Var(\Delta x)=\mathbb{E}[\Delta x^2]-(\mathbb{E}[\Delta x])^2 
=(\nu^2\Delta t^2+\sigma^2\Delta t)-(\nu \Delta t)^2 
=\sigma^2\Delta tï¼
\end{eqnarray}
It becomes. Here,$M^2=a^2\Delta t^2$ï¼Œ$r=j\Delta r$,</p>

<p>\begin{eqnarray}\label{ExForPb1}
\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}=\frac{(-ar)^2\Delta t^2+\sigma^2\Delta t}{ (\sigma \sqrt(3\Delta t))^2} 
=\frac{(-a\Delta t)^2r^2+\sigma^2\Delta t}{ 3\sigma^2 \Delta t} 
=\frac{M^2(j\Delta r)^2+\sigma^2\Delta t}{ 3\sigma^2 \Delta t} 
=\frac{1}{3}\frac{j^2 M^2 \Delta r^2+\sigma^2\Delta t}{ \sigma^2 \Delta t} 
=\frac{1}{3}\frac{j^2 M^2 \Delta r^2}{ \sigma^2 \Delta t}+\frac{1}{3} 
=\frac{1}{3}\frac{j^2 M^2 (3\sigma^2 \Delta t)}{ \sigma^2 \Delta t}+\frac{1}{3} 
=j^2M^2+\frac{1}{3}ï¼
\end{eqnarray}</p>

<p>Therefore from the formula \eqref{ExForPb1},
\begin{eqnarray}
p_m=1-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=1-(j^2M^2+\frac{1}{3}) 
=\frac{2}{3}-j^2M^2ï¼
\end{eqnarray}</p>

<p>On the other hand,
\begin{eqnarray}\label{ExForPb2}
\frac{\nu\Delta t}{\Delta x}=\frac{(-ar)\Delta t}{\sigma\sqrt(3\Delta t)} 
=\frac{-Mr}{\sigma\sqrt(3\Delta t)} 
=\frac{-jr\Delta r}{\sigma\sqrt(3\Delta t)} 
=\frac{-jr(\sigma\sqrt(3\Delta t))}{\sigma\sqrt(3\Delta t)} 
=-jMï¼
\end{eqnarray}</p>

<p>Therefore from the formula \eqref{ExForPb2},</p>

<p>\begin{eqnarray}
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} ) 
=\frac{1}{2}( j^2M^2+\frac{1}{3} -jM ) 
=\frac{1}{6}+\frac{j^2M^2-jM}{2}ï¼
\end{eqnarray}</p>

<p>\begin{eqnarray}
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x}) 
=\frac{1}{2}(j^2M^2+\frac{1}{3}+jM) 
=\frac{1}{6}+\frac{j^2M^2+jM}{2}ï¼
\end{eqnarray}</p>

<p>Next, it is derived from the probabilities corresponding to the upward branching process.</p>

<p>\begin{eqnarray}\label{averrageB}
\mathbb{E}[\Delta x]=p_u(2\Delta x)+p_m(\Delta x)+p_d(0)=\nu\Delta tï¼
\end{eqnarray}
\begin{eqnarray}\label{varianceB}
\mathbb{E}[\Delta x^2]=p_u(2\Delta x)^2+p_m(\Delta x^2)+p_d(0)=\sigma^2\Delta t+\nu^2\Delta t^2ï¼
\end{eqnarray}
\begin{eqnarray}\label{SumProB}
p_u+p_m+p_d=1ï¼
\end{eqnarray}</p>

<p>The expression \eqref{averrageB} and the expression \eqref{varianceB} are expanded as follows.</p>

<p>\begin{eqnarray}\label{averrageBB}
2p_u\Delta x+p_m\Delta x=\nu \Delta tï¼
\end{eqnarray}
\begin{eqnarray}\label{varianceBB}
4p_u\Delta x^2+p_m\Delta x^2=\sigma^2\Delta t+\nu^2\Delta t^2ï¼
\end{eqnarray}</p>

<p>Subtracting the expression \eqref{averrageBB} from the expression \eqref{varianceBB} multiplied by $\Delta x$</p>

<p>\begin{eqnarray}\label{puB}
2p_u\Delta x^2=\nu^2\Delta t^2+\sigma^2\Delta t-\nu \Delta t\Delta x 
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )ï¼
\end{eqnarray}</p>

<p>Also, if it is assigned the expression \eqref{puB} to the expression \eqref{averrageBB},
\begin{eqnarray}\label{pmB}
2p_u\Delta x+p_m\Delta x=\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x}+p_m\Delta x 
\Leftrightarrow p_m\Delta x=2\nu \Delta t-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}<br />
\Leftrightarrow p_m=\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}ï¼
\end{eqnarray}</p>

<p>And if it is substituted the expression \eqref{puB} and the expression \eqref{pmB} into the expression \eqref{SumProB}
\begin{eqnarray}\label{pdB}
p_u+p_m+p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} )+\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+p_d 
=\frac{3}{2}\frac{\nu \Delta t}{\Delta x}-\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+p_d 
\Leftrightarrow p_d=1-\frac{1}{2}( \frac{3\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} ) ï¼
\end{eqnarray}</p>

<p>Therefore from the formula \eqref{ExForPb1},
\begin{eqnarray}
p_u=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} ) 
=\frac{1}{2}( j^2M^2+\frac{1}{3}-(-jM)) 
=\frac{1}{6}-\frac{j^2M^2+jM}{2}ï¼
\end{eqnarray}</p>

<p>\begin{eqnarray}
p_m=\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=-2jM-(j^2M^2+\frac{1}{3}) 
=\frac{1}{3}-j^2M^2-2jMï¼
\end{eqnarray}</p>

<p>\begin{eqnarray}
p_d=1-\frac{1}{2}( \frac{3\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} ) 
=1-frac{1}{2}( -3jM-j^2M^2-\frac{1}{3}) 
=\frac{7}{6}+\frac{j^2M^2+3jM}{2}ï¼
\end{eqnarray}</p>

<p>Then, the probability corresponding to the downward branching process is derived.</p>

<p>\begin{eqnarray}\label{averrageC}
\mathbb{E}[\Delta x]=p_u(0)+p_m(-\Delta x)+p_d(-2\Delta x)=\nu\Delta tï¼
\end{eqnarray}
\begin{eqnarray}\label{varianceC}
\mathbb{E}[\Delta x^2]=p_u(0)+p_m(-\Delta x)^2+p_d(-2\Delta x)^2=\sigma^2\Delta t+\nu^2\Delta t^2ï¼
\end{eqnarray}
\begin{eqnarray}\label{SumProC}
p_u+p_m+p_d=1ï¼
\end{eqnarray}</p>

<p>The expression \eqref{averrageC} and the expression \eqref{varianceC} are expanded as follows.
\begin{eqnarray}\label{averrageCC}
-p_m\Delta x-2p_d\Delta x=\nu \Delta tï¼
\end{eqnarray}
\begin{eqnarray}\label{varianceCC}
p_m\Delta x^2+4p_d\Delta x^2=\sigma^2\Delta t+\nu^2\Delta t^2ï¼
\end{eqnarray}</p>

<p>Add the expression \eqref{varianceCC} multiplied by $\Delta x$ and the expression \eqref{averrageCC},
\begin{eqnarray}\label{pdC}
2p_d\Delta x^2=\nu^2\Delta t^2+\sigma^2\Delta t+\nu \Delta t\Delta x 
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} )ï¼
\end{eqnarray}</p>

<p>Also, if it is assigned the expression \eqref{pdC} to the expression \eqref{averrageCC},
\begin{eqnarray}\label{pmC}
-p_m\Delta x-2p_d\Delta x=-p_m\Delta x-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}-\frac{\nu \Delta t}{\Delta x} 
\Leftrightarrow -p_m\Delta x=2\nu \Delta t+\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}<br />
\Leftrightarrow p_m=-\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}ï¼
\end{eqnarray}</p>

<p>And if it is substituted the expression \eqref{pdC} and the expression \eqref{pmC} into the expression \eqref{SumProC},
\begin{eqnarray}\label{puC}
p_u+p_m+p_d=p_u-\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} ) 
=p_u-\frac{3}{2}\frac{\nu \Delta t}{\Delta x}-\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
\Leftrightarrow p_u=1+\frac{3}{2}\frac{\nu \Delta t}{\Delta x}+\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}ï¼
\end{eqnarray}</p>

<p>Therefore from the formula \eqref{ExForPb1},
\begin{eqnarray}
p_d=\frac{1}{2}(\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2}+\frac{\nu \Delta t}{\Delta x} ) 
=\frac{1}{2}( j^2M^2+\frac{1}{3}-jM) 
=\frac{1}{6}-\frac{j^2M^2-jM}{2}ï¼
\end{eqnarray}</p>

<p>\begin{eqnarray}
p_m=-\frac{2\nu \Delta t}{\Delta x}-\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=2jM-(j^2M^2+\frac{1}{3}) 
=-\frac{1}{3}-j^2M^2+2jMï¼
\end{eqnarray}</p>

<p>\begin{eqnarray}
p_u=1+\frac{3}{2}\frac{\nu \Delta t}{\Delta x}+\frac{1}{2}\frac{\nu^2\Delta t^2+\sigma^2\Delta t}{\Delta x^2} 
=1+\frac{3}{2}(-jM)+\frac{1}{2}(j^2M^2+\frac{1}{3}) 
=\frac{7}{6}+\frac{j^2M^2-3jM}{2}ï¼
\end{eqnarray}</p>

<p>Finally, the short rate process is introduced into the drift term $a_i$, which fluctuates with time. This drift term is chosen to be consistent with the discount bonds market quoted.
\begin{eqnarray}
P(0,i+1)=\int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{(-a_i+j\Delta r)\Delta t}ï¼
\end{eqnarray}</p>

<p>Here, $Q_{i,j}$ is a security that pays $1$ when the node $(i,j)$ is reached, and pays nothing at other times.
Therefore, the drift term $ a_i $ is given as follows.</p>

<p>\begin{eqnarray}
\ln P(0,i+1)=\ln \int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{j\Delta r\Delta t}-a_i\Delta t 
\Leftrightarrow a_i\Delta t=\ln \int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{j\Delta r\Delta t}-\ln P(0,i+1) 
\Leftrightarrow a_i=\frac{\ln \int_{j=BottomNode[i]}^{TopNode[i]}Q_{i,j}e^{j\Delta r\Delta t}-\ln P(0,i+1)}{\Delta t}ï¼
\end{eqnarray}</p>

<h2 id="hull-and-white-tree-implementation">Hull and White Tree Implementation</h2>

<p>It is given the simplified tree implementation mentioned above. The source code is written in matlab 2016b.</p>
<ul>
  <li>Full of below code is in <a href="https://github.com/kyo1988/Kyo.github.io/blob/gh-pages/scripts%20for%20article/BuildHWF1.m">my GitHub account</a></li>
</ul>

<figure class="highlight"><pre><code class="language-css" data-lang="css"> 
<span class="nf">#container</span> <span class="p">{</span> <span class="nl">float</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="m">-240px</span> <span class="m">0</span> <span class="m">0</span><span class="p">;</span> <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span> <span class="p">}</span> 
    <span class="nt">for</span> <span class="nt">i</span><span class="o">=</span><span class="err">1</span><span class="nd">:N-1</span> 
        <span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)=</span><span class="nt">sigma</span><span class="o">*</span><span class="nt">sqrt</span><span class="o">(</span><span class="err">3</span><span class="o">.*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">)));</span>
    <span class="nt">end</span>
    <span class="nt">for</span> <span class="nt">i</span><span class="o">=</span><span class="err">1</span><span class="nd">:N-1</span> 
        <span class="nt">for</span> <span class="nt">j</span><span class="o">=</span><span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nd">:-1:-m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span> 
            <span class="nt">M</span><span class="o">=</span><span class="nt">-j</span><span class="o">.*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">).*</span><span class="nt">a</span><span class="o">*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">));</span>
            <span class="nt">V</span><span class="o">=</span><span class="nt">sigma</span><span class="o">.^</span><span class="err">2</span><span class="o">.*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span> <span class="o">));</span>
            <span class="nt">k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">round</span><span class="o">((</span><span class="nt">j</span><span class="o">.*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">)+</span><span class="nt">M</span><span class="o">)./</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">));</span> 
            <span class="nt">alpha</span><span class="o">=(</span><span class="nt">j</span><span class="o">.*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">)+</span><span class="nt">M-k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">).*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">))./</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">);</span>
            <span class="nt">pu</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">V</span><span class="o">./(</span><span class="err">2</span><span class="o">.*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">).^</span><span class="err">2</span><span class="o">)+(</span><span class="nt">alpha</span><span class="o">.^</span><span class="err">2</span><span class="o">+</span><span class="nt">alpha</span><span class="o">)./</span><span class="err">2</span><span class="o">;</span>
            <span class="nt">pd</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">V</span><span class="o">./(</span><span class="err">2</span><span class="o">.*</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">).^</span><span class="err">2</span><span class="o">)+(</span><span class="nt">alpha</span><span class="o">.^</span><span class="err">2</span><span class="nt">-alpha</span><span class="o">)./</span><span class="err">2</span><span class="o">;</span> 
            <span class="nt">pm</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="err">1</span><span class="nt">-V</span><span class="o">./(</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">).^</span><span class="err">2</span><span class="o">)</span><span class="nt">-alpha</span><span class="o">.^</span><span class="err">2</span><span class="o">;</span>
        <span class="nt">if</span> <span class="nt">j</span><span class="o">==</span><span class="nt">max</span><span class="o">(</span><span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">))</span> 
            <span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)=</span><span class="nt">k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span><span class="nt">i</span><span class="o">)+</span><span class="err">1</span><span class="o">;</span> 
        <span class="nt">end</span>
        <span class="nt">end</span>
    <span class="nt">end</span>
    <span class="nt">for</span> <span class="nt">i</span><span class="o">=</span><span class="err">1</span><span class="nd">:N-1</span>
        <span class="nt">for</span> <span class="nt">j</span><span class="o">=</span><span class="err">1</span><span class="nd">:m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span>
            <span class="nt">x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j-1</span><span class="o">,</span> <span class="nt">i</span><span class="o">)</span><span class="nt">-deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">);</span> 
            <span class="nt">x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i</span><span class="o">)+</span><span class="nt">deltaX</span><span class="o">(</span><span class="nt">i</span><span class="o">);</span> 
        <span class="nt">end</span>
    <span class="nt">end</span>  
    <span class="nt">for</span> <span class="nt">i</span><span class="o">=</span><span class="err">1</span><span class="nd">:N-1</span> 
        <span class="nt">if</span> <span class="nt">i</span><span class="o">==</span><span class="err">2</span>
            <span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">2</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pu</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">)));</span> 
            <span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pm</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">)));</span> 
            <span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pd</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">)));</span> 
        <span class="nt">elseif</span> <span class="nt">i</span><span class="o">&gt;=</span><span class="err">3</span>
            <span class="nt">for</span> <span class="nt">j</span><span class="o">=</span><span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nd">:-1:-m</span><span class="o">(</span> <span class="nt">i</span> <span class="o">)</span> 
                <span class="nt">for</span> <span class="nt">jj</span><span class="o">=</span><span class="nt">m</span><span class="o">(</span><span class="nt">i-1</span><span class="o">)</span><span class="nd">:-1:-m</span><span class="o">(</span><span class="nt">i-1</span><span class="o">)</span> 
                    <span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)...</span>
                    <span class="o">+</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pu</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">))).*(</span><span class="nt">k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span><span class="nt">i-1</span><span class="o">)+</span><span class="err">1</span><span class="o">==</span><span class="nt">j</span><span class="o">)...</span>
                    <span class="o">+</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pm</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">))).*(</span><span class="nt">k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span><span class="nt">i-1</span><span class="o">)==</span><span class="nt">j</span><span class="o">)...</span>
                    <span class="o">+</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">pd</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span> <span class="nt">i-1</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i-1</span><span class="o">))).*(</span><span class="nt">k</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">jj</span><span class="o">,</span><span class="nt">i-1</span><span class="o">)</span><span class="nt">-1</span><span class="o">==</span><span class="nt">j</span><span class="o">);</span>
                <span class="nt">end</span> 
            <span class="nt">end</span> 
        <span class="nt">end</span>
    <span class="nt">if</span> <span class="nt">i</span><span class="o">==</span><span class="err">1</span>
        <span class="nt">g</span><span class="o">(</span><span class="nt">i</span><span class="o">)=</span><span class="nt">-log</span><span class="o">(</span><span class="nt">P</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">))./(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">));</span> 
    <span class="nt">elseif</span> <span class="nt">i</span><span class="o">&gt;=</span><span class="err">2</span> 
        <span class="nt">sum</span><span class="o">=</span><span class="err">0</span><span class="o">;</span> 
        <span class="nt">for</span> <span class="nt">j</span><span class="o">=</span><span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span> <span class="nd">:-1</span> <span class="nd">:-m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span> 
            <span class="nt">sum</span><span class="o">=</span><span class="nt">sum</span><span class="o">+</span><span class="nt">Q</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j</span><span class="o">,</span> <span class="nt">i</span><span class="o">).*</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="o">+</span><span class="nt">j</span><span class="o">,</span> <span class="nt">i</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">)));</span> 
        <span class="nt">end</span> 
            <span class="nt">g</span><span class="o">(</span><span class="nt">i</span><span class="o">)=(</span><span class="nt">log</span><span class="o">(</span><span class="nt">sum</span><span class="o">)</span><span class="nt">-log</span><span class="o">(</span><span class="nt">P</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)))./(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">));</span> 
    <span class="nt">end</span>
        <span class="nt">for</span> <span class="nt">j</span><span class="o">=</span><span class="nt">m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span><span class="nd">:-1:-m</span><span class="o">(</span><span class="nt">i</span><span class="o">)</span>
            <span class="nt">r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">x</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)+</span><span class="nt">g</span><span class="o">(</span><span class="nt">i</span><span class="o">);</span> 
            <span class="nt">d</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">)=</span><span class="nt">exp</span><span class="o">(</span><span class="nt">-r</span><span class="o">(</span><span class="nt">N</span><span class="o">+</span><span class="err">1</span><span class="nt">-j</span><span class="o">,</span> <span class="nt">i</span><span class="o">).*(</span><span class="nt">t</span><span class="o">(</span><span class="nt">i</span><span class="o">+</span><span class="err">1</span><span class="o">)</span><span class="nt">-t</span><span class="o">(</span><span class="nt">i</span><span class="o">)));</span> 
        <span class="nt">end</span> 
    <span class="nt">end</span></code></pre></figure>

<h2 id="reference">Reference</h2>
<ul>
  <li>Hull, J. and A. White, 1994. â€œNumerical procedures for implementing term structure models I:Single-Factor Models,â€™â€™ Journal of Derivatives, 2, 1 (Fall 1994a) 7âˆ’16</li>
  <li>Strickland, C. and Clewlow, L., 1998. Implementing Derivatives Models</li>
  <li>Shreve, S., 2004. Stochastic Calculus for Finance II: Continuous-Time Models</li>
</ul>]]></content><author><name>Kyo Harada</name></author><category term="Business" /><category term="Finance" /><category term="Business Finance" /><summary type="html"><![CDATA[This is a modified version of the report for semminar at a financial consulting firm in 2018.]]></summary></entry><entry><title type="html">Derivation of Black-Scholes PDE and its analytical solution by arbitrage pricing theory</title><link href="https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/03/derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory.html" rel="alternate" type="text/html" title="Derivation of Black-Scholes PDE and its analytical solution by arbitrage pricing theory" /><published>2021-06-03T00:00:00+09:00</published><updated>2021-06-03T00:00:00+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/03/derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory</id><content type="html" xml:base="https://kyo1988.github.io/Kyo.github.io/business/finance/2021/06/03/derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory.html"><![CDATA[<ul id="markdown-toc">
  <li><a href="#derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory" id="markdown-toc-derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory">Derivation of Black-Scholes PDE and its analytical solution by arbitrage pricing theory</a>    <ul>
      <li><a href="#necessary-and-sufficient-condition-to-duplicate-the-portfolio-which-does-fully-hedge-the-option-sell-position" id="markdown-toc-necessary-and-sufficient-condition-to-duplicate-the-portfolio-which-does-fully-hedge-the-option-sell-position">Necessary and sufficient condition to duplicate the portfolio, which does fully hedge the option sell position</a></li>
      <li><a href="#reference" id="markdown-toc-reference">Reference</a></li>
    </ul>
  </li>
</ul>

<h1 id="derivation-of-black-scholes-pde-and-its-analytical-solution-by-arbitrage-pricing-theory">Derivation of Black-Scholes PDE and its analytical solution by arbitrage pricing theory</h1>

<p>In general, when the underlying asset price is given by a stochastic differential equation, the price of the derivative product is given by a partial differential equation. In this paper, it will be derived from the Black-Scholes PDE corresponding to the derivative (here, option) price valuation of the underlying asset (here, stock) modeled as the geometric Brownian motion. The valuation of an option is given by determining the initial funding needed to fully hedge the selling position of the option. Since the determined initial fund is the amount required to build a duplicate portfolio, it is called the no arbitrage price at time zero of the option. The price valuation method that duplicates options in stock market and money market account transactions is called arbitrage pricing theory (APT).</p>

<p>Suppose it is given a portfolio valued at $X(t)$ at any time $t$. Here, the composition of the given portfolio is as follows.</p>

<ul>
  <li>money-market account with interest rate $r$</li>
  <li>A stock modeled by the geometric Brownian motion expressed by the following equation</li>
</ul>

<p>\begin{eqnarray}\label{stockPrice}
dS(t)=\alpha S(t)dt+\sigma S(t)dW(t)ï¼
\end{eqnarray}</p>

<p>Here, it is assumed that the investor who holds the given portfolio holds the stock in the unit of $\Delta(t)$ at any time $t$. At this time, it is assumed that the number of shares held $\Delta(t)$ is an â€˜adapted stochastic processâ€™. The remainder of the portfolio excluding the investment in stocks, $X(t)-\Delta(t)S(t)$, is invested in the money market account.
Here, the small change $dX(t)$ of the portfolio value $X(t)$ at any time $t$ results in the following two factors.</p>

<ul>
  <li>Profit from holding shares $\Delta(t)dS(t)$</li>
  <li>Profit from holding cash $r(X(t)-\Delta(t)S(t))dt$</li>
</ul>

<p>That is, the small change in portfolio value $dX(t)$ is given by the following equation.</p>

<p>\begin{eqnarray}\label{portDiff}
dX(t)=\Delta(t)dS(t)+r(X(t)-\Delta(t)S(t))dtï¼
\end{eqnarray}</p>

<p>The equation \eqref{portDiff} is expanded as follows from the stochastic differential equation \eqref{stockPrice} of a given stock price.
\begin{eqnarray}\label{portDiff2}
dX(t)=\Delta(t)dS(t)+r(X(t)-\Delta(t)S(t))dtã€€
=\Delta(t)( \alpha S(t)dt+\sigma S(t)dW(t) )+r(X(t)-\Delta(t)S(t))dt
=rX(t)dt+\Delta(t)( \alpha -r )S(t)dt+\Delta(t)\sigma S(t)dW(t)ï¼
\end{eqnarray}</p>

<p>Here, the three terms appearing in the small change $dX(t) in portfolio value $\eqref{portDiff2} expanded by the given stock price of the stochastic differential equation \eqref{stockPrice} can be interpreted as follows.</p>

<ul>
  <li>$rX(t)dt$: A term that reflects the profit from the expected rate of return of the portfolio $r$</li>
  <li>$\Delta(t)( \alpha -r )S(t)dt$: A term that reflects the risk premium on equity investments $\alpha-r$</li>
  <li>$\Delta(t)\sigma S(t)dW(t)$: Volatility term proportional to the size of equity investment</li>
</ul>

<p>Then, consider the discounted stock price $\mathrm{e}^{-rt} S(t)$ and the discounted portfolio value $\mathrm{e}^{-rt}X(t)$. In order to analyze these price processes, it should be noted that they are different from ordinary analysis due to the nature of the geometric Brownian motion that appeared as a model of stock prices. This property means that Brownian motion has a non-zero quadratic variation, which, as it will be seen later, is the source of the volatility term of the Black-Scholes PDE.
In other words, to differentiate an expression expressed in the form of $f(W(t))$ with $f(x)$ as a differentiable function and $W(t)$ as the Brown motion. If Brown motion $W(t)$ is differentiable, the following equation holds from ordinary analysis by the chain rule of the composite function.</p>

<p>\begin{eqnarray}
\frac{d}{dt}f(W(t))=fâ€™(W(t))Wâ€™(t) \Leftrightarrow df(W(t))=fâ€™(W(t))Wâ€™(t)dt=fâ€™(W(t))dW(t)ï¼
\end{eqnarray}</p>

<p>However, since Brownian motion accumulates a quadratic variation of 1 per unit time $(dWdW = dt)$, the derivative of $f(W(t))$ has a correction term shown in the following equation.</p>

<p>\begin{eqnarray}\label{ItoFormDiff}
df(W(t))=fâ€™(W(t))dW(t)+\frac{1}{2}fâ€™â€˜(W(t))dtï¼
\end{eqnarray}</p>

<p>The formula \eqref{ItoFormDiff} is called Itoâ€™s formula in differential form. The equation \eqref{ItoFormDiff} is an equation obtained by differentiating Itoâ€™s formula \eqref{ItoForm} for the Brownian motion shown below.</p>

<ul>
  <li>Itoâ€™s formula for Brownian motion</li>
</ul>

<p>Partial differentiation of $f(t, x)$, $f_ {t}(t, x)$, $f_{x}(t, x)$, $f_ {xx}(t, x)$ is defined and continuous. Let $W(t)$ be the Brownian motion. At this time, the following equation holds for all $T \geq0$.</p>

<p>\begin{eqnarray}\label{ItoForm}
f(Tï¼ŒW(T))=f(0ï¼ŒW(0))+\int_{0}^{T}f_{t}(tï¼ŒW(t))dt+\int_{0}^{T}f_{x}(tï¼ŒW(t))dW(t)+\frac{1}{2}\int_{0}^{T}f_{xx}(tï¼ŒW(t))dtï¼
\end{eqnarray}</p>

<p>Where the third term of the expression \eqref{ItoForm} $\int_{0}^{T}f_{x}(t, W(t)) dW(t)$ is called Ito integral, and the second and fourth terms are Lebesgue integrals for variables of time. Itoâ€™s formula can be extended to general stochastic processes including the Brown process, excluding jump process. This stochastic process is called the Ito process $dX(t)=a(t)dW(t)+b(t)dt$, which accumulate the quadratic variation of $a^{2}(t)$ per unit time. It is assumed that $a(t)$ and $b(t)$ are adapted stochastic processes.</p>

<ul>
  <li>Itoâ€™s formula for the Ito process</li>
</ul>

<p>Let $X(t)$ be the Ito process, and $f(t, x)$ be the partial derivative $f_{t}(t, x)$, $f_{x}(t, x)$, $f_{xx}(t, x)$ be a defined and continuous function, and let $W(t)$ be Brownian motion. At this time, the following equation holds for all $T \geq 0$.</p>

<p>\begin{eqnarray}\label{ItoFormII}
f(Tï¼ŒX(T))=f(0ï¼ŒX(0))+\int_{0}^{T}f_{t}(tï¼ŒX(t))dt+\int_{0}^{T}f_{x}(tï¼ŒX(t))dX(t)+\frac{1}{2}\int_{0}^{T}f_{xx}(tï¼ŒX(t))a^{2}(t)dtï¼
\end{eqnarray}</p>

<p>Therefore, the derivative of the discounted stock price $\mathrm{e}^{-rt} S(t)$ is $f(t, x) = \mathrm{e}^{-rt} x$ which is gotten to apply Itoâ€™s formula \eqref{ItoForm}. In the following, it is used that $f_{t} (t, x )=-r \mathrm{e}^{-rt} x$, $ f_{x}  (t, x )=\, mathrm{e}^{-rt}$, $f_{xx} (t, x )=0 $.</p>

<p>\begin{eqnarray}\label{DiscountStockPrice}
d( \mathrm{e}^{-rt}S(t) )=df(tï¼ŒS(t)) =f_{t}(tï¼ŒS(t))dt+f_{x}(tï¼ŒS(t))dS(t)+f_{xx}(tï¼ŒS(t))dt=-r\mathrm{e}^{-rt}S(t)dt+\mathrm{e}^{-rt}dS(t) =-r\mathrm{e}^{-rt}S(t)dt+\mathrm{e}^{-rt}( \alpha S(t)dt+\sigma S(t)dW(t))=(\alpha-r)\mathrm{e}^{-rt}S(t)dt+\sigma\mathrm{e}^{-rt}S(t)dW(t)
\end{eqnarray}</p>

<p>Similarly, the derivative of the discounted portfolio value $\mathrm{e}^{-rt} X(t)$ is given by</p>

<p>\begin{eqnarray}\label{DiscountPort}
d( \mathrm{e}^{-rt}X(t) )=df(tï¼ŒX(t))=f_{t}(tï¼ŒX(t))dt+f_{x}(tï¼ŒX(t))dX(t)+\frac{1}{2}f_{xx}(tï¼ŒX(t))dt=-r\mathrm{e}^{-rt}X(t)dt+\mathrm{e}^{-rt}dX(t) =-r\mathrm{e}^{-rt}X(t)dt+\mathrm{e}^{-rt}( \Delta(t)dS(t)+r(X(t)-\Delta(t)S(t))dt)=\Delta(t)(\alpha-r)\mathrm{e}^{-rt}S(t)dt+\Delta(t)\sigma\mathrm{e}^{-rt}S(t)dW(t)=\Delta(t)d(\mathrm{e}^{-rt}S(t))ï¼
\end{eqnarray}</p>

<p>In this way, the formula \eqref{DiscountPort} is obtained by the discounted stock price $S(t)$ and the portfolio value $X(t)$ at the discount rate $\mathrm{e}^{-rt}$ with the interest rate $r$ of the money market account. The formula \eqref{DiscountPort} indicates that small change in the discount portfolio value $d(\mathrm{e}^{-rt}X(t))$ depends only on a small change in the discounted stock price $d(\mathrm{e}^{-rt}S(t))$.</p>

<p>Consider a European call option where the payment on the maturity date $T$ is $(S(T)-K )^{+}$. Here, the strike price $K$ is assumed to be a non-negative constant.
Fischer Black, Myron Scholes and Robert Cox Merton argued that the value of European call option on maturity $T$ with payment $(S(T) -K )^{+}$ at any time $t$ depends on the length of time to maturity, the value of the stock price $S(t)$ at time $t$, the model parameters $r, \sigma$ and the strike price $K$.</p>

<p>Since the model parameters $r, \sigma$ and the strike price $K$ are assumed to be constants, among the variables that affect the price evaluation of the European call option, only the time $t$ and the stock price $S(t)$ are  changed.</p>

<p>Here, according to the inference of Fischer Black et al, let the value of the European call option be $c(t, x)$ when the stock price is $S(t) = x$ at time $t$. Since the stock price $S(t)$ follows the stochastic differential equation \eqref{stockPrice}, the value of the European call option is also stochastic.</p>

<p>Therefore, the value of the European call option is the stochastic process $c(t, S(t))$ obtained by replacing the stochastic process $S(t)$ with the parameter $x$. At the initial time, the future stock price $S(t)$ is unknown because it is probabilistic, then the value $c(t, S(t))$ of the future European call option is also unknown. Therefore, if the function $c(t, x)$ is determined, the value of the future European call option $c(t, S(t))$ is expressed by the future stock price $S(t)$.</p>

<p>To duplicate a portfolio which does full hedge the option sell position, it is required to fit the value of the duplicate portfolio $X(t)$ at any time $t\in[0, T]$ in the value of future European call options $c(t, S(t))$ starting with a certain initial fund of $X(0)$ and investing in the stock market and money market accounts.</p>

<p>The necessary and sufficient conditions for constructing this replication portfolio are $\ mathrm{e}^{-rt}X(t)=\mathrm{e}^{-rt} c(t, S (t))$ for any time $t \in[0, T]$. To show that the necessary and sufficient conditions are met,</p>

<p>\begin{eqnarray}\label{IsCopyPort}
d(\mathrm{e}^{-rt}X(t))=d(\mathrm{e}^{-rt}c(tï¼ŒS(t)))ï¼Œt\in[0ï¼ŒT)
\end{eqnarray}</p>

<p>And show that $X(0) = c(0, S(0))$ holds. In fact, the following equation is obtained by integrating the equation \eqref{IsCopyPort} from 0 to $t$.</p>

<p>\begin{eqnarray}
\mathrm{e}^{-rt}X(t)-X(0)=\mathrm{e}^{-rt}c(tï¼ŒS(t))-c(0ï¼ŒS(0))ï¼Œt\in[0ï¼ŒT)
\end{eqnarray}</p>

<p>At this time, if $X(0)=c(0,S(0))$, then it is obtained the necessary and sufficient conditional expression $\mathrm{e}^{-rt}X(t)=\mathrm{e}^{-rt}c(t,S(t))$.</p>

<h2 id="necessary-and-sufficient-condition-to-duplicate-the-portfolio-which-does-fully-hedge-the-option-sell-position">Necessary and sufficient condition to duplicate the portfolio, which does fully hedge the option sell position</h2>

<p>To expand the right-hand side \eqref{IsCopyPort}, it is required to calculate the derivative of discount option price $\mathrm{e}^{-rt} c(t, S (t, S) t))$. To do this, it is needed to calculate the derivative of the option price $c(t, S(t))$. From Itoâ€™s formula for the Ito process \eqref{ItoFormII} and the given stock price stochastic differential equation \eqref{stockPrice}</p>

<p>\begin{eqnarray}
dc(tï¼ŒS(t))=c_{t}(tï¼ŒS(t))dt+c_{x}(tï¼ŒS(t))dS(t)+\frac{1}{2}c_{xx}(tï¼ŒS(t))(\sigma S(t))^{2}dt=c_{t}(tï¼ŒS(t))dt+c_{x}(tï¼ŒS(t))( \alpha S(t)dt+\sigma S(t)dW(t) )+\frac{1}{2}c_{xx}(tï¼ŒS(t))(\sigma S(t))^{2}dt=( c_{t}(tï¼ŒS(t))dt+\alpha c_{x}(tï¼ŒS(t))+\frac{1}{2}\sigma^{2} S^{2}(t)c_{xx}(tï¼ŒS(t)))dt+\sigma S(t)c_{x}(tï¼ŒS(t))dW(t)ï¼
\end{eqnarray}</p>

<p>It is calculated the derivative of discount option price $\mathrm{e}^{-rt} c (t)$ by Itoâ€™s formula \eqref{ItoFormII} for the Ito process as $f(t, x)=\mathrm{e}^{-rt}x,S(t))$. In the following, it is used that $f_{t}(t,x)=-r\mathrm{e}^{-rt}x$, $f_{x}(t,x)=\mathrm{e}^{-rt}$, $f_{xx}(t,x)=0$.</p>

<p>\begin{eqnarray}\label{expandCallDis}
d(\mathrm{e}^{-rt}c(tï¼ŒS(t)))=df(tï¼Œc(tï¼ŒS(t)))=f_{t}(tï¼Œc(tï¼ŒS(t)))dt+f_{x}(tï¼Œc(tï¼ŒS(t)))dc(tï¼ŒS(t))+\frac{1}{2}f_{xx}(tï¼Œc(tï¼ŒS(t)) (\sigma S(t)c_{x}(tï¼ŒS(t)))^{2}dt=-r\mathrm{e}^{-rt}c(tï¼ŒS(t))+\mathrm{e}^{-rt} dc(tï¼ŒS(t))=\mathrm{e}^{-rt}(-rc(tï¼ŒS(t))+c_{t}(tï¼ŒS(t))+\alpha c_{x}(tï¼ŒS(t))+\frac{1}{2}\sigma^{2} S^{2}(t)c_{xx}(tï¼ŒS(t)))dt+\mathrm{e}^{-rt}\sigma S(t)c_{x}(tï¼ŒS(t))dW(t)ï¼
\end{eqnarray}</p>

<p>It is given the following equation to expand the right-hand side of \eqref{IsCopyPort} with the formula \eqref{expandCallDis} and the left-hand side with the formula \eqref{DiscountPort}.</p>

<p>\begin{eqnarray}\label{expandCopyPort}
\Delta(t)(\alpha-r)S(t)dt+\Delta(t)\sigma S(t)dW(t)=( -rc(tï¼ŒS(t))+c_{t}(tï¼ŒS(t))+\alpha c_{x}(tï¼ŒS(t))+\frac{1}{2}\sigma^{2} S^{2}(t)c_{xx}(tï¼ŒS(t)))dt+\sigma S(t)c_{x}(tï¼ŒS(t))dW(t)ï¼
\end{eqnarray}</p>

<p>If the expansion formula \eqref{expandCopyPort}, which is a necessary and sufficient condition for replicating a portfolio that completely hedges an optionâ€™s sell position, holds, the coefficients on both sides must be matched. Therefore, since the coefficients on both sides of $dW(t)$ are equal, the following equation is obtained.</p>

<p>\begin{eqnarray}\label{deltaHedging}
\Delta(t)=c_{x}(tï¼ŒS(t))ï¼Œt\in[0ï¼ŒT)
\end{eqnarray}</p>

<p>The number of shares held to fully hedge the optionâ€™s sell position at any time $t$ before maturity is the partial derivative of the option value at time $t$ with respect to the stock price $c_{x}(t, S(t))$. The relational expression \eqref{deltaHedging} of $\Delta(t)$ is called the delta-hedging rule because it is called the optional delta.</p>

<p>Since the coefficients on both sides of $dt$ are also equal, the following equation holds for any time $t\in[0, T)$ from the relational expression \eqref{deltaHedging} of $\Delta(t)$.</p>

<p>\begin{eqnarray}\label{expandCopyPortForT}
(\alpha-r)S(t)c_{x}(tï¼ŒS(t))
=-rc(tï¼ŒS(t))+c_{t}(tï¼ŒS(t))+\alpha c_{x}(tï¼ŒS(t))+\frac{1}{2}\sigma^{2} S^{2}(t)c_{xx}(tï¼ŒS(t))
\end{eqnarray}</p>

<p>Since $\alpha c_{x}(t,S(t))$ term appears on both sides of the expression \eqref{expandCopyPortForT} for any time $t\in[0, T)$, it is obtained the following equation to extract this term.</p>

<p>\begin{eqnarray}\label{PreBlackScholes}
rc(tï¼ŒS(t))=c_{t}(tï¼ŒS(t))+rS(t)c_{x}(tï¼ŒS(t))+\frac{1}{2}\sigma^{2} S^{2}(t)c_{xx}(tï¼ŒS(t))
\end{eqnarray}</p>

<p>Here, if the value of the European call option when the stock price is $S(t) = x$ at time $t$ is $c(t, x)$, then it is obtained the partial differential equation of Black-Scholes from the equation \eqref{PreBlackScholes}.</p>

<p>\begin{eqnarray}\label{BlackScholes}
c_{t}(tï¼Œx)+rxc_{x}(tï¼Œx)\frac{1}{2}\sigma^{2} x^{2}c_{xx}(tï¼Œx)=rc(tï¼Œx)ï¼Œt\in[0ï¼ŒT)ï¼Œx\geq0
\end{eqnarray}</p>

<p>In addition to satisfying the equation \eqref{BlackScholes}, the function $c(t, x)$ must also satisfy the boundary conditions shown in the following equation.</p>

<p>\begin{eqnarray}\label{BoundaryCondtion}
c(Tï¼Œx)=(x-K)^{+}ï¼Œc(tï¼Œ0)=0ï¼Œ\lim_{x \to \infty}[c(tï¼Œx)-(x-\mathrm{e}^{-r( T-t )}K)]=0
\end{eqnarray}</p>

<p>In fact, the first equation of the expression \eqref{BoundaryCondtion} follows from the definition of the European call option.</p>

<p>The second equation is that when $x=0$ is substituted into the Black-Scholes partial differential equation \eqref{BlackScholes}, it is obtained the ordinary differential equation $c_{t}(t,0)=rc(t,0)$ for the function $c(t, 0)$ at time $t$ and then it is obtained its solution $c(t,0)=\mathrm{e}^{rt}$ is substituted $t=T$ for $c(0,0)$, which results in $c(T,0)=(0-K)^{+}=0$, $C(0,0)=0$.</p>

<p>In the third equation, â€˜Put/Call Parityâ€™ holds because it is likely to end with â€˜In the moneyâ€™ for European call options for very large $x$ and the value of the forward contract is almost equal to $x-\mathrm{e}^{-r (Tt )}K$.</p>

<p>In order to obtain an analytical solution of the Black-Scholes PDE \eqref{BlackScholes}, it is reduced by change of variables to a PDE whose exact solution is known. Therefore, two variables $u$ and $v$ are defined by the following equation, which are introduced for this purpose.</p>

<p>\begin{eqnarray}\label{val1}
u=\log \frac{x}{K}+(r-\frac{\sigma^{2}}{2})(T-t) 
v=T-t
\end{eqnarray}</p>

<p>Here, using the variables $u$ and $v$ defined in the expression \eqref{val1}, the function $c(t, x)$ is converted into two functions $\mathrm{e}^{-rv}$ and $y (u, v )$ as shown in the following expression.</p>

<p>\begin{eqnarray}\label{val2}
c(tï¼Œx)=\mathrm{e}^{-rv}y(uï¼Œv)ï¼
\end{eqnarray}</p>

<p>Substituting the equation \eqref{val2} into the partial differential equation \eqref{BlackScholes} of Black-Scholes and rearranging it gives the following equation.</p>

<p>\begin{eqnarray}\label{HeatConductionEquation}
y_{u u}(uï¼Œv)-\frac{2}{\sigma^{2}}y_{v}(uï¼Œv)=0ï¼
\end{eqnarray}</p>

<p>The equation \eqref{HeatConductionEquation} is a known partial differential equation with an exact solution called the heat conduction equation. Here, the boundary condition is changed by variable transformation.</p>

<p>$c(tï¼Œx)=$
$x-K\cdots x\geq K$
$0\cdots x \lt K$</p>

<p>Note that the following conditions have changed.</p>

<p>$y(uï¼Œ0)=$
$K( \mathrm{e}^{u}-1 )\cdots u\geq 0$
$0\cdots u \lt 0$</p>

<p>It is known that the heat conduction equation \eqref{HeatConductionEquation} is solved by the separation of variables method. The separation of variables method means that the solution $y(u,v)$ is expressed as the product of two functions $p(u)$ and $q(v)$.</p>

<p>\begin{eqnarray}\label{val3}
y(uï¼Œv)=p(u)q(v)ï¼
\end{eqnarray}</p>

<p>Substituting the equation \eqref{val3} into the heat conduction equation \eqref{HeatConductionEquation} and rearranging it gives the following equation.</p>

<p>\begin{eqnarray}\label{SeparationVariables}
\frac{p_{u u}(u)}{p(u)}=\frac{2}{\sigma^{2}}\frac{q_{v}(v)}{q(v)}ï¼
\end{eqnarray}</p>

<p>Focusing on both sides of the obtained equation \eqref{SeparationVariables}, the left side is a function of only $u$ and the right side is a function of only $v$, then constants irrelevant to $u$ and $v$, which is $-k^{2}(0\leq k\lt \infty)$. Therefore, finding the solution of the heat conduction equation \eqref{HeatConductionEquation} results in the problem of solving the following two ordinary differential equations.</p>

<ul>
  <li>$\dfrac{p_{u u}(u)}{p(u)}=-k^{2}$</li>
  <li>$\dfrac{2}{\sigma^{2}}\dfrac{q_{v}(v)}{q(v)}=-k^{2}$</li>
</ul>

<p>The first equation is a second-order ordinary differential equation with constant coefficients, then if the coefficients are constants $C(k)$ and $D(k)$ with respect to constants $k$ irrelevant to $u$ and $v$, the solution is given by the following equation.</p>

<p>\begin{eqnarray}\label{ODE1Sol}
p(u)=C(k)\sin( ku ) +D(k)\cos( ku ) ï¼
\end{eqnarray}</p>

<p>Since the second equation is a variable separable ordinary differential equation, if the coefficients are the constant $E(k)$ for the constant $k$ irrelevant to $u$ and $v$, the solution is given by the following equation.</p>

<p>\begin{eqnarray}\label{ODE2Sol}
q(v)=E(k)\exp( -\frac{\sigma^{2}k^{2}}{2}v ) ï¼
\end{eqnarray}</p>

<p>Therefore, the solution $y (u, v )$ of the heat conduction equation \eqref{HeatConductionEquation} is a constant $k (0\leq k \lt \infty )$ irrelevant to $u$ and $v$. Then all are superposed to obtain the general solution shown in the following equation.</p>

<p>\begin{eqnarray}\label{HeatConductionEquationSol}
y(uï¼Œv)=\int_{0}^{+\infty}( C(k)\sin( ku ) +D(k)\cos( ku ) )\exp( -\frac{\sigma^{2}k^{2}}{2}v )dkï¼
\end{eqnarray}</p>

<p>Here, the coefficients $C(k)$ and $D(k)$ of the equation \eqref{HeatConductionEquationSol} are given by the following equation from Fourierâ€™s integral theorem as $y(u,0)=g(a)$.</p>

<p>\begin{eqnarray}\label{FourierCoefficient}
C(k)=\frac{1}{\pi}\int_{-\infty}^{+\infty}g(a)\cos (ka) da
\end{eqnarray}
\begin{eqnarray}\label{FourierCoefficient2}
D(k)=\frac{1}{\pi}\int_{-\infty}^{+\infty}g(a)\sin (ka) da
\end{eqnarray}</p>

<p>Substituting the obtained equation of coefficients \eqref{FourierCoefficient} and \eqref{FourierCoefficient2} into the solution \eqref{HeatConductionEquationSol} of the heat conduction equation \eqref{HeatConductionEquation} and rearranging it gives the following equation.</p>

<p>\begin{eqnarray}\label{HeatConductionEquationSol2}
y(uï¼Œv)=\dfrac{1}{\sigma \sqrt[]{\mathstrut 2 \pi v}} \int_{-\infty}^{+\infty}g(a)\exp( -\dfrac{1}{2}(\dfrac{a-u}{\sigma \sqrt[]{\mathstrut v}})^{2} ) daï¼
\end{eqnarray}</p>

<p>For further analysis, the change of variables is performed again as follows. 
\begin{eqnarray}\label{}
w=\dfrac{a-u}{\sigma \sqrt[]{\mathstrut v}}ï¼
\end{eqnarray}</p>

<p>Note that the boundary conditions have changed to the following conditions due to the change of variables.</p>

<p>$g(a)=g( u+\sigma \sqrt[]{\mathstrut v}w )=$</p>

<p>$K( \mathrm{e}^{u+\sigma \sqrt[]{\mathstrut v}w}-1 )\cdots w\geq -\dfrac{u}{\sigma \sqrt[]{\mathstrut v}}$</p>

<p>Or $0\cdots w \lt -\dfrac{u}{\sigma \sqrt[]{\mathstrut v}}$</p>

<p>Focusing on the change of variables by $w$ and the changed boundary conditions, the equation \eqref{HeatConductionEquationSol2} is expanded as follows.</p>

<p>\begin{eqnarray}\label{HeatConductionEquationSol3}
y(uï¼Œv)=\dfrac{1}{\sqrt[]{\mathstrut 2 \pi}} \int_{-\dfrac{u}{\sigma \sqrt[]{\mathstrut v}}}^{+\infty}K( \exp(u+\sigma \sqrt[]{\mathstrut v}w)-1 )\exp( -\dfrac{w^{2}}{2} )dw
=\dfrac{1}{\sqrt[]{\mathstrut 2 \pi}} \int_{-\frac{u}{\sigma \sqrt[]{\mathstrut v}}}^{+\infty}K\exp(u+\sigma \sqrt[]{\mathstrut v}w-\dfrac{w^{2}}{2}) dw-\dfrac{1}{\sqrt[]{\mathstrut 2 \pi}} \int_{-\frac{u}{\sigma \sqrt[]{\mathstrut v}}}^{+\infty} K \exp(-\dfrac{w^{2}}{2})dwï¼
\end{eqnarray}</p>

<p>Furthermore, if the first term on the right side of the equation \eqref{HeatConductionEquationSol3} is replaced with $z = w- \sigma \sqrt[]{\mathstrut v}$ and the second term is replaced with $z = w$, the following equation is obtained.</p>

<p>\begin{eqnarray}\label{HeatConductionEquationSol4}
y(uï¼Œv)=x\exp(rv) \dfrac{1}{ \sqrt[]{\mathstrut 2 \pi}} \int_{-\frac{u}{\sigma \sqrt[]{\mathstrut v}}^{+\infty}-\sigma \sqrt[]{\mathstrut v}}\exp( -\dfrac{z^{2}}{2} ) dz-K\dfrac{1}{ \sqrt[]{\mathstrut 2 \pi}} \int_{-\frac{u}{\sigma \sqrt[]{\mathstrut v}}}^{+\infty}\exp( -\dfrac{z^{2}}{2} ) dz
=x\exp(rv)N(\frac{u}{\sigma \sqrt[]{\mathstrut v}}+\sigma \sqrt[]{\mathstrut v})-KN( \frac{u}{\sigma \sqrt[]{\mathstrut v}})ï¼
\end{eqnarray}</p>

<p>Finally, by substituting the obtained equation \eqref{HeatConductionEquationSol4} into the solution of the Black-Scholes PDE \eqref{val2} is obtained as an analytical solution of the Black-Scholes PDE, which is a function that satisfies the Black-Scholes PDE.</p>

<p>\begin{eqnarray}\label
c(tï¼Œx)=xN(\frac{u}{\sigma \sqrt[]{\mathstrut v}} + \sigma \sqrt[]{\mathstrut v} ) -K \exp(-rv)N(\frac{u}{\sigma \sqrt[]{\mathstrut v}})
\end{eqnarray}</p>

<p>However,</p>

<p>$u=\log \frac{x}{K}+(r-\frac{\sigma^{2}}{2})(T-t)$</p>

<p>$v=T-t$</p>

<h2 id="reference">Reference</h2>
<ul>
  <li>Shreve, S., 2004. Stochastic Calculus for Finance II: Continuous-Time Models</li>
  <li>Ishimura, S., 2008. Black Shoals differential equations for finance and securities (In Japanese)</li>
</ul>]]></content><author><name>Kyo Harada</name></author><category term="Business" /><category term="Finance" /><category term="Business Finance" /><summary type="html"><![CDATA[This is a modified version of the report for semminar at a financial consulting firm in 2016.]]></summary></entry><entry><title type="html">Derivation of yield curve construction formula with tenor basis spread</title><link href="https://kyo1988.github.io/Kyo.github.io/business/finance/2021/05/31/derivation-of-yield-curve-construction-formula-with-tenor-basis-spread.html" rel="alternate" type="text/html" title="Derivation of yield curve construction formula with tenor basis spread" /><published>2021-05-31T00:00:00+09:00</published><updated>2021-05-31T00:00:00+09:00</updated><id>https://kyo1988.github.io/Kyo.github.io/business/finance/2021/05/31/derivation-of-yield-curve-construction-formula-with-tenor-basis-spread</id><content type="html" xml:base="https://kyo1988.github.io/Kyo.github.io/business/finance/2021/05/31/derivation-of-yield-curve-construction-formula-with-tenor-basis-spread.html"><![CDATA[<ul id="markdown-toc">
  <li><a href="#derivation-of-yield-curve-construction-formula-with-tenor-basis-spread" id="markdown-toc-derivation-of-yield-curve-construction-formula-with-tenor-basis-spread">Derivation of yield curve construction formula with tenor basis spread</a>    <ul>
      <li><a href="#reference" id="markdown-toc-reference">Reference</a></li>
    </ul>
  </li>
</ul>

<h1 id="derivation-of-yield-curve-construction-formula-with-tenor-basis-spread">Derivation of yield curve construction formula with tenor basis spread</h1>

<p>If LIBOR is truly risk-free, the swap of 3-month LIBOR and 6-month LIBOR should be tradable with zero spread. However, LIBOR takes into account the credit risk of banks, and tenor swaps are exactly the transactions that swap the risk of 3-month LIBOR and 6-month LIBOR. After the financial crisis, the risk of bankruptcy, that is, the difference in tenor, was conscious, and when swap 3-month LIBOR and 6-month LIBOR, the 3-month LIBOR side began to trade with a non-negligible spread.</p>

<p>After all, after supplementing the discount factor and tenor spread in 0.25 year increments, the future 3-month LIBOR can be calculated as follows (Nakahara, 2013).</p>

<p>\begin{eqnarray}
L_{forward}^{3MWorld}(t,t_{i},t_{i+0.25})=\frac{1-DF(t,t_{i+0.25})-TS^{3M-6M}(t,t_{i+0.25})\times\sum_{j=1}^{4i+1}{DF(t,t_{\frac{j}{4}})\times\frac{1}{4}}}{DF(t,t_{i+0.25})\times\frac{1}{4}}+\frac{-\sum_{j=1}^{4i}{L_{forward}^{3MWorld}(t,t_{\frac{j-1}{4}},t_{\frac{j}{4}})\times DF(t,t_{\frac{j}{4}})\times\frac{1}{4}}}{DF(t,t_{i+0.25})\times\frac{1}{4}}ï¼
\end{eqnarray}</p>

<p>However,</p>

<ul>
  <li>$L(t,T)$: Observable LIBOR at time point $t$ maturity $T$</li>
  <li>$L_{forward}^{3MWorld}(t,t_{0},t_{0.25})=L(t,t_{0.25})$</li>
  <li>$L_{forward}^{3MWorld}(t,t_{i},t_{i+0.25})$: A 3-month LIBOR with a reset date of $t_{i}$ and a maturity of $t_{i+0.25}$ as seen from the point in time $t$</li>
  <li>$TS^{3M-6M}(t,T)$: Tenor spread when swapping 6-month LIBOR for 3-month LIBOR at time $t$ and maturity $T$</li>
</ul>

<p>In this article, we try to derive the equation (1). 
At this time, the evaluation formula of the JPY tenor swap is expressed as follows (Takahashi, 2010)ï¼</p>

<p>\begin{eqnarray}
\sum_{n=1}^{N}\delta_{n}(E_{t}[L(T_{n-1},T_{n}+\tau_{N}]P_{t,T_{n}})=\sum_{m=1}^{M}\delta_{m}E_{t}[L(T_{m-1},T_{m}]P_{t,T_{m}}ï¼
\end{eqnarray}</p>

<p>However,</p>

<ul>
  <li>$N=2M$</li>
  <li>$L(T_{n-1},T_{n})$: LIBOR with a reset date of $T_{n-1}$ and a maturity of $T_{n}$</li>
  <li>$P_{t,T_{n}}$: Zero coupon bond price with maturity of $t$ at time $ T_{n}$</li>
  <li>$\delta_{n}$: Interest calculation period</li>
  <li>$\tau_{N}$: Tenor spread when swapping 6-month LIBOR for 3-month LIBOR at time $t$ and maturity of $T (= T_{N} = T_{M})$</li>
</ul>

<p>Now, we want to derive 3 months LIBOR, that is, $E_{t}[L(T_{N-1}, T_{N}]$, therefore expand the left side of the expression (2) as follows.</p>

<p>\begin{eqnarray}
\sum_{n=1}^{N}\delta_{n}(E_{t}[L(T_{n-1},T_{n}+\tau_{N}]P_{t,T_{n}})=\sum_{n=1}^{N-1}\delta_{n}(E_{t}[L(T_{n-1},T_{n})]P_{t,T_{n}}+\delta_{N}E_{t}[L(T_{N-1},T_{N})]P_{t,T_{N}}+\sum_{n=1}^{N}\delta_{n}\tau_{N}P_{t,T_{n}}ï¼
\end{eqnarray}</p>

<p>On the other hand, the relationship between Libor and the discount rate is</p>

<p>\begin{eqnarray}
E_{t}[L(T_{m-1},T_{m})]=\frac{1}{\delta_{n}}\left(\frac{P_{t,T_{m-1}}}{P_{t,T_{n}}}-1\right)ï¼
\end{eqnarray}</p>

<p>Since it is represented by, the left side of the expression \label{tenor} can be expanded as follows.</p>

<p>\begin{eqnarray}
\sum_{m=1}^{M}\delta_{m}E_{t}[L(T_{m-1},T_{m}]P_{t,T_{m}}=P_{t,T_{0}}-P_{t,T_{M}}=1-P_{t,T_{M}}ï¼
\end{eqnarray}</p>

<p>After all, JPY 3 months LIBOR, ie $E_{t} [L(T_{N-1},T_{N}]$, is given below.</p>

<p>\begin{eqnarray}
E_{t}[L(T_{N-1},T_{N}]=\frac{1-P_{t,T_{M}}-\sum_{n=1}^{N}\delta_{n}\tau_{N}P_{t,T_{n}}}{\delta_{N}P_{t,T_{N}}}+\frac{-\sum_{n=1}^{N-1}\delta_{n}(E_{t}[L(T_{n-1},T_{n})]P_{t,T_{n}}}{\delta_{N}P_{t,T_{N}}}ï¼
\end{eqnarray}</p>

<h2 id="reference">Reference</h2>
<ul>
  <li>Nakahara, G.ï¼Œ2013. LIBOR and OIS discount that can be seen in EXCEL (In Japanese)</li>
  <li>Fujii, M.ï¼ŒShimada, Y. and Takahashi, A.ï¼Œ2010. â€œA Note on Construction of Multiple Swap Curves with and without Collateralâ€ï¼Œ FSA Research Review Vol.6(March 2010)ï¼</li>
</ul>]]></content><author><name>Kyo Harada</name></author><category term="Business" /><category term="Finance" /><category term="Business Finance" /><summary type="html"><![CDATA[This is a modified version of the report for semminar at a financial consulting firm in 2016.]]></summary></entry></feed>